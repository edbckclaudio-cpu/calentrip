(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476);function a({className:e="",...a}){return(0,t.jsx)("div",{className:`rounded-lg border border-zinc-200 bg-white p-4 shadow-sm dark:bg-black dark:border-zinc-800 ${e}`,...a})}function r({className:e="",...a}){return(0,t.jsx)("div",{className:`mb-3 ${e}`,...a})}function s({className:e="",...a}){return(0,t.jsx)("h3",{className:`text-lg font-semibold ${e}`,...a})}function n({className:e="",...a}){return(0,t.jsx)("div",{className:`${e}`,...a})}e.s(["Card",()=>a,"CardContent",()=>n,"CardHeader",()=>r,"CardTitle",()=>s])},93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r=(0,a.forwardRef)(function({className:e="",clearOnFocus:r=!1,...s},n){let[i,l]=(0,a.useState)(!1),c=(0,a.useRef)(void 0),{onFocus:d,onBlur:o,onChange:m,value:u}=s;return(0,t.jsx)("input",{ref:n,className:`w-full h-12 rounded-lg border border-zinc-300 bg-white px-3 text-sm placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-[#007AFF]/30 disabled:opacity-50 dark:bg-black dark:border-zinc-700 dark:text-zinc-100 ${e}`,...s,...void 0!==u?{value:i?"":u}:{},onFocus:e=>{c.current=u,l(r&&void 0!==u&&""!==String(u)),d?.(e)},onBlur:e=>{l(!1),o?.(e)},onChange:e=>{l(!1),m?.(e)}})});e.s(["Input",0,r])},30826,e=>{"use strict";let t=null,a=null,r="calentrip_db",s=null,n=!1,i=!1;function l(){try{console.warn("⚠️ MODO RECAPE: Rodando sem SQLite nativo")}catch{}return{async createConnection(){},open:async()=>({execute:async()=>{},run:async()=>{},query:async()=>void 0,close:async()=>{}})}}async function c(){if(s)return s;try{try{window.db_disabled&&(i=!0,a=l())}catch{}if(!a)try{let t=await e.A(53119);a=t.CapacitorSQLite??t}catch{i=!0;try{window.offline=!0}catch{}try{window.db_fallback=!0}catch{}a=l()}let t=a;return s={open:async(e,a=!1,r="no-encryption",s=1)=>{try{return await function(e,t=3e3){return Promise.race([e,new Promise((e,a)=>setTimeout(()=>a(Error("timeout")),t))])}(t.open({database:e,version:s,encrypted:a,mode:r}))}catch{try{console.warn("⚠️ MODO RECAPE: Rodando sem SQLite nativo")}catch{}i=!0;try{window.offline=!0}catch{}try{window.db_fallback=!0}catch{}return{execute:async()=>{},run:async()=>{},query:async()=>void 0,close:async()=>{}}}}}}catch{i=!0;try{window.offline=!0}catch{}try{window.db_fallback=!0}catch{}return a=l(),s={open:async()=>({execute:async()=>{},run:async()=>{},query:async()=>void 0,close:async()=>{}})}}}async function d(){if(!n)try{try{if(window.db_disabled){n=!0;return}}catch{}let e=await c();if(!e){n=!0;return}let t=await e.open(r,!1,"no-encryption",1);await t.execute(`
      CREATE TABLE IF NOT EXISTS trips (
        id TEXT PRIMARY KEY NOT NULL,
        title TEXT NOT NULL,
        date TEXT NOT NULL,
        passengers INTEGER,
        flightNotes TEXT,
        reachedFinalCalendar INTEGER DEFAULT 0,
        savedCalendarName TEXT,
        savedAt INTEGER
      );
    `),await t.execute(`
      CREATE TABLE IF NOT EXISTS events (
        event_id INTEGER PRIMARY KEY AUTOINCREMENT,
        trip_id TEXT NOT NULL,
        name TEXT NOT NULL,
        label TEXT,
        date TEXT NOT NULL,
        time TEXT,
        address TEXT,
        type TEXT,
        FOREIGN KEY (trip_id) REFERENCES trips(id) ON DELETE CASCADE
      );
    `),await t.execute(`
      CREATE TABLE IF NOT EXISTS attachments (
        att_id INTEGER PRIMARY KEY AUTOINCREMENT,
        trip_id TEXT NOT NULL,
        leg TEXT NOT NULL,
        name TEXT NOT NULL,
        type TEXT NOT NULL,
        size INTEGER NOT NULL,
        file_id TEXT NOT NULL,
        FOREIGN KEY (trip_id) REFERENCES trips(id) ON DELETE CASCADE
      );
    `);try{await t.execute("ALTER TABLE attachments ADD COLUMN category TEXT")}catch{}try{await t.execute("ALTER TABLE attachments ADD COLUMN ref TEXT")}catch{}await t.close(),n=!0}catch{n=!0}}async function o(){try{if(!t)try{let a=await e.A(40402);t=a.Preferences??a}catch{}let a=t?await t.get({key:"migration_complete"}):void 0;if("true"===(a?.value||""))return}catch{}try{let e=localStorage.getItem("calentrip:trips"),a=e?JSON.parse(e):[];if(!a.length){t&&await t.set({key:"migration_complete",value:"true"});return}let s=await c();if(!s){t&&await t.set({key:"migration_complete",value:"true"});return}let n=await s.open(r,!1,"no-encryption",1);for(let e of a){let t=JSON.stringify(e.flightNotes||[]),a=+!!e.reachedFinalCalendar,r=e.savedAt??Date.now();await n.run("INSERT OR REPLACE INTO trips (id, title, date, passengers, flightNotes, reachedFinalCalendar, savedCalendarName, savedAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[e.id,e.title,e.date,e.passengers,t,a,e.savedCalendarName||null,r]);let s=e.savedEvents||[];if(Array.isArray(s)&&s.length)for(let t of(await n.run("DELETE FROM events WHERE trip_id = ?",[e.id]),s))await n.run("INSERT INTO events (trip_id, name, label, date, time, address, type) VALUES (?, ?, ?, ?, ?, ?, ?)",[e.id,t.name||t.label||"Evento",t.label||null,t.date,t.time||null,t.address||null,t.type||null]);let i=e.attachments||[];if(Array.isArray(i)&&i.length)for(let t of(await n.run("DELETE FROM attachments WHERE trip_id = ?",[e.id]),i))await n.run("INSERT INTO attachments (trip_id, leg, name, type, size, file_id) VALUES (?, ?, ?, ?, ?, ?)",[e.id,t.leg,t.name,t.type,t.size,t.id||""])}await n.close(),t&&await t.set({key:"migration_complete",value:"true"})}catch{try{t&&await t.set({key:"migration_complete",value:"true"})}catch{}}}async function m(e){await d();let t=await c();if(!t||i){try{let t=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),a=[e,...t].slice(0,20);localStorage.setItem("calentrip:trips",JSON.stringify(a))}catch{}return}try{let a=await t.open(r,!1,"no-encryption",1);await a.run("INSERT OR REPLACE INTO trips (id, title, date, passengers, flightNotes, reachedFinalCalendar, savedCalendarName, savedAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[e.id,e.title,e.date,e.passengers,JSON.stringify(e.flightNotes||[]),+!!e.reachedFinalCalendar,e.savedCalendarName||null,Date.now()]),await a.close()}catch{i=!0;try{let t=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),a=[e,...t].slice(0,20);localStorage.setItem("calentrip:trips",JSON.stringify(a))}catch{}}}async function u(e,t){if(await d(),!await c()||i){try{let a=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),r=a.findIndex(t=>t.id===e);if(r>=0){let e=[...a];e[r]={...e[r],...t},localStorage.setItem("calentrip:trips",JSON.stringify(e))}}catch{}return}let a=[],s=[];if(void 0!==t.title&&(a.push("title = ?"),s.push(t.title)),void 0!==t.date&&(a.push("date = ?"),s.push(t.date)),void 0!==t.passengers&&(a.push("passengers = ?"),s.push(t.passengers)),void 0!==t.flightNotes&&(a.push("flightNotes = ?"),s.push(JSON.stringify(t.flightNotes||[]))),void 0!==t.reachedFinalCalendar&&(a.push("reachedFinalCalendar = ?"),s.push(+!!t.reachedFinalCalendar)),void 0!==t.savedCalendarName&&(a.push("savedCalendarName = ?"),s.push(t.savedCalendarName||null)),void 0!==t.savedAt&&(a.push("savedAt = ?"),s.push(t.savedAt)),!a.length)return;let n=`UPDATE trips SET ${a.join(", ")} WHERE id = ?`,l=await c(),o=await l.open(r,!1,"no-encryption",1);await o.run(n,[...s,e]),await o.close()}async function p(e,t){await d();let a=await c();if(!a||i){try{let a=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),r=a.findIndex(t=>t.id===e);if(r>=0){let e=[...a];e[r].savedEvents=t,localStorage.setItem("calentrip:trips",JSON.stringify(e))}}catch{}return}let s=await a.open(r,!1,"no-encryption",1);for(let a of(await s.run("DELETE FROM events WHERE trip_id = ?",[e]),t))await s.run("INSERT INTO events (trip_id, name, label, date, time, address, type) VALUES (?, ?, ?, ?, ?, ?, ?)",[e,a.name||a.label||"Evento",a.label||null,a.date,a.time||null,a.address||null,a.type||null]);await s.close()}async function h(){await d();let e=await c();if(!e||i)try{return[...JSON.parse(localStorage.getItem("calentrip:trips")||"[]")].sort((e,t)=>(e.date||"").localeCompare(t.date||""))}catch{return[]}let t=await e.open(r,!1,"no-encryption",1),a=await t.query("SELECT id, title, date, passengers, flightNotes, reachedFinalCalendar, savedCalendarName, savedAt FROM trips ORDER BY date DESC");await t.close();let s=[];for(let e of a?.values||[]){let[t,a,r,n,i,l,c,d]=e,o=(()=>{try{return JSON.parse(String(i||"[]"))}catch{return[]}})();s.push({id:t,title:a,date:r,passengers:Number(n||0),flightNotes:o,reachedFinalCalendar:!!l,savedCalendarName:c||void 0,savedAt:d||void 0})}return s}async function x(e){await d();let t=await c();if(!t||i)try{let t=JSON.parse(localStorage.getItem("calentrip:trips")||"[]").find(t=>t.id===e);return t?.savedEvents||[]}catch{return[]}let a=await t.open(r,!1,"no-encryption",1),s=await a.query("SELECT name, label, date, time, address, type FROM events WHERE trip_id = ? ORDER BY date ASC, time ASC",[e]);await a.close();let n=[];for(let e of s?.values||[]){let[t,a,r,s,i,l]=e;n.push({name:t,label:a||void 0,date:r,time:s||void 0,address:i||void 0,type:l||void 0})}return n}async function g(e){await d();let t=await c();if(!t||i){try{let t=JSON.parse(localStorage.getItem("calentrip:trips")||"[]").filter(t=>t.id!==e);localStorage.setItem("calentrip:trips",JSON.stringify(t))}catch{}return}let a=await t.open(r,!1,"no-encryption",1);await a.run("DELETE FROM events WHERE trip_id = ?",[e]),await a.run("DELETE FROM attachments WHERE trip_id = ?",[e]),await a.run("DELETE FROM trips WHERE id = ?",[e]),await a.close()}async function y(e,t){await d();let a=await c();if(!a||i){try{let a=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),r=a.findIndex(t=>t.id===e);if(r>=0){let e=[...a];e[r].attachments=t,localStorage.setItem("calentrip:trips",JSON.stringify(e))}}catch{}return}let s=await a.open(r,!1,"no-encryption",1);for(let a of(await s.run("DELETE FROM attachments WHERE trip_id = ?",[e]),t))await s.run("INSERT INTO attachments (trip_id, leg, name, type, size, file_id) VALUES (?, ?, ?, ?, ?, ?)",[e,a.leg,a.name,a.type,a.size,a.id]);await s.close()}async function f(e,t,a,s){await d();let n=await c();if(!n||i){try{let r=JSON.parse(localStorage.getItem("calentrip:trips")||"[]"),n=r.findIndex(t=>t.id===e);if(n>=0){let e=[...r],i=(e[n].attachments||[]).concat(s.map(e=>({category:t,ref:a,name:e.name,type:e.type,size:e.size,id:e.id})));e[n].attachments=i,localStorage.setItem("calentrip:trips",JSON.stringify(e))}}catch{}return}let l=await n.open(r,!1,"no-encryption",1);for(let r of s)await l.run("INSERT INTO attachments (trip_id, leg, name, type, size, file_id, category, ref) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[e,t,r.name,r.type,r.size,r.id,t,a]);await l.close()}async function b(e,t,a){await d();let s=await c();if(!s||i)try{let r=JSON.parse(localStorage.getItem("calentrip:trips")||"[]").find(t=>t.id===e);return(r?.attachments||[]).filter(e=>(!t||e.category===t||e.leg===t)&&(!a||e.ref===a)).map(e=>({name:e.name,type:e.type,size:e.size,id:e.id||""}))}catch{return[]}let n=await s.open(r,!1,"no-encryption",1),l="SELECT name, type, size, file_id FROM attachments WHERE trip_id = ?",o=[e];t&&(l+=" AND category = ?",o.push(t)),a&&(l+=" AND ref = ?",o.push(a));let m=await n.query(l,o);return await n.close(),(m?.values||[]).map(e=>{let[t,a,r,s]=e;return{name:t,type:a,size:Number(r||0),id:s}})}async function N(e,t){await d();let a=await c();if(!a||i)try{let a=JSON.parse(localStorage.getItem("calentrip:trips")||"[]").find(t=>t.id===e),r=a?.attachments||[],s=r.map(e=>({name:e.name,type:e.type,size:e.size,id:e.id||""}));return t?s.filter((e,a)=>r[a]?.leg===t):s}catch{return[]}let s=await a.open(r,!1,"no-encryption",1),n=await s.query(t?"SELECT name, type, size, file_id FROM attachments WHERE trip_id = ? AND leg = ?":"SELECT name, type, size, file_id FROM attachments WHERE trip_id = ?",t?[e,t]:[e]);return await s.close(),(n?.values||[]).map(e=>{let[t,a,r,s]=e;return{name:t,type:a,size:Number(r||0),id:s}})}e.s(["addTrip",()=>m,"getRefAttachments",()=>b,"getSavedTrips",()=>h,"getTripAttachments",()=>N,"getTripEvents",()=>x,"initDatabase",()=>d,"migrateFromLocalStorage",()=>o,"removeTrip",()=>g,"saveCalendarEvents",()=>p,"saveRefAttachments",()=>f,"saveTripAttachments",()=>y,"updateTrip",()=>u])},27766,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r=(0,a.forwardRef)(function({className:e="",clearOnFocus:r=!1,...s},n){let[i,l]=(0,a.useState)(!1),c=(0,a.useRef)(void 0),{onFocus:d,onBlur:o,onChange:m,value:u}=s;return(0,t.jsx)("input",{ref:n,type:"date",className:`w-full rounded-md border border-zinc-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black/20 dark:bg-black dark:border-zinc-700 dark:text-zinc-100 ${e}`,...s,value:i?"":u,onFocus:e=>{c.current=u,l(r&&void 0!==u&&""!==String(u)),d?.(e)},onBlur:e=>{l(!1),o?.(e)},onChange:e=>{l(!1),m?.(e)}})});e.s(["CalendarInput",0,r])},72003,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(45295),s=e.i(15288),n=e.i(19455),i=e.i(93479),l=e.i(27766),c=e.i(76639),d=e.i(18566),o=e.i(33499),m=e.i(73635),u=e.i(30826);function p(){let p,h,x,g,y,f,b,N,v,j,T,w,{tripSearch:E}=(0,r.useTrip)(),k=(0,d.useRouter)(),{t:C}=(0,o.useI18n)(),{show:S,dismiss:A}=(0,m.useToast)(),I=(0,d.usePathname)(),R=(0,a.useMemo)(()=>(E&&E.mode,""),[E]),[L,O]=(0,a.useState)(R),$=(0,a.useRef)(null),_=(0,a.useRef)(!1),z=(0,a.useCallback)((e,t)=>{$.current&&A($.current);let a=S(e,t);return $.current=a,a},[S,A]),[F,D]=(0,a.useState)(0),[B,M]=(0,a.useState)([]),[U,P]=(0,a.useState)(null),[H,J]=(0,a.useState)(null),[X,V]=(0,a.useState)(""),[G,W]=(0,a.useState)([]),[Y,q]=(0,a.useState)(null),[K,Q]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(!1),[et,ea]=(0,a.useState)(!1),er=(0,a.useRef)(null),[es,en]=(0,a.useState)(!1),[ei,el]=(0,a.useState)(()=>!(R||"").trim()),[ec,ed]=(0,a.useState)(()=>!!(R||"").trim()),[eo,em]=(0,a.useState)(!1),[eu,ep]=(0,a.useState)(!1),[eh,ex]=(0,a.useState)(!1),[eg,ey]=(0,a.useState)({maxH:240,transition:"opacity 250ms ease-out, max-height 250ms ease-out"}),[ef,eb]=(0,a.useState)({}),[eN,ev]=(0,a.useState)(null),[ej,eT]=(0,a.useState)(null),[ew,eE]=(0,a.useState)(null),[ek,eC]=(0,a.useState)({}),eS=(0,a.useMemo)(()=>{if(!B.length)return!1;let e=B.every(e=>!!(e.name&&e.address&&e.checked)),t=B.length<=1||B.slice(0,-1).every(e=>!!e.transportToNext);return e&&t},[B]);(0,a.useEffect)(()=>{try{let e=window.matchMedia("(max-width: 480px)").matches;ey({maxH:e?160:240,transition:e?"opacity 200ms ease-out, max-height 200ms ease-out":"opacity 250ms ease-out, max-height 250ms ease-out"})}catch{}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,a=t?.cities||[];a.length&&(M(a),D(a.length))}catch{}},[I]),(0,a.useEffect)(()=>{(async()=>{try{let e=(await (0,u.getSavedTrips)()).sort((e,t)=>Number(t.savedAt||0)-Number(e.savedAt||0))[0],t={};for(let a=0;a<B.length-1;a++){let r=B[a]?.transportToNext,s=Array.isArray(r?.files)?r.files.length:0,n=0;if(e){let t=`${B[a]?.name||""}->${B[a+1]?.name||""}`;n=(await (0,u.getRefAttachments)(e.id,"transport",t)).length}t[a]=s+n}eb(t);try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,a=t?.cities||[];a.length&&0===B.length?(M(a),D(a.length)):a.length&&a.length===B.length&&M(e=>e.map((e,t)=>({...e,transportToNext:a[t]?.transportToNext??e.transportToNext})))}catch{}}catch{}})()},[B,C]),(0,a.useEffect)(()=>{try{let e=window.matchMedia("(max-width: 480px)"),t=e=>{ey({maxH:e.matches?160:240,transition:e.matches?"opacity 200ms ease-out, max-height 200ms ease-out":"opacity 250ms ease-out, max-height 250ms ease-out"})};return e.addEventListener("change",t),()=>{try{e.removeEventListener("change",t)}catch{}}}catch{}},[]),(0,a.useEffect)(()=>{E&&"different"===E.mode&&ep(!0)},[E]),(0,a.useEffect)(()=>{B.length>0&&(ep(!1),ex(!1))},[B.length]);let eA=(0,a.useMemo)(()=>E?"same"===E.mode?E.departDate??"":E.outbound.date??"":"",[E]),eI=(0,a.useMemo)(()=>E?"same"===E.mode?E.returnDate??"":E.inbound.date??"":"",[E]);function eR(e,t){if(!e)return"";let a=new Date(e);if(Number.isNaN(a.getTime()))return e;a.setDate(a.getDate()+t);let r=e=>String(e).padStart(2,"0");return`${a.getFullYear()}-${r(a.getMonth()+1)}-${r(a.getDate())}`}let eL=(()=>{if(!E)return{checkin:"",checkout:""};let e="same"===E.mode?E.departDate??"":E.outbound.date??"",t="same"===E.mode?E.returnDate??"":E.inbound.date??"",a=0;try{"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(a=1)}catch{}return{checkin:a?eR(e,a):e,checkout:t}})();function eO(){if(ep(!1),ex(!1),!E||"different"!==E.mode)return;let e=Math.max(0,Math.min(8,Number(F)||0));if(0===e)return void M([]);let t=[];for(let a=0;a<e;a++){let r=0===a?eA||"":t[a-1]?.checkout||"",s=r;try{0===a&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(s=eR(r,1))}catch{}let n=a===e-1&&eI||"";t.push({name:"",checkin:s,checkout:n})}M(t),z(C("citiesConfigured")),q(0),Q("name"),ep(!1),ex(!1),z(C("fillFirstCityNameScrollHint"),{duration:6e3})}async function e$(t){if(V(t),!t)return void W([]);ee(!0);try{let{searchAirportsAsync:a}=await e.A(86687),r=t.trim(),s=[r];r.toLowerCase().startsWith("rom")&&s.push("roma","rome");let n=await Promise.all(s.map(e=>a(e))),i=[].concat(...n),l=new Set,c=[],d=i.map(e=>({city:e.city,name:`${e.city}, ${e.country} (${e.name})`,country:e.country})).filter(e=>{let t=`${(e.city||"").toLowerCase()}|${(e.country||"").toLowerCase()}`;return!l.has(t)&&(l.add(t),!!e.city)}).sort((e,t)=>{let a=c.includes(e.country)?-1:0,r=c.includes(t.country)?-1:0;return a-r});W(d);let o=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(r)}&format=json&limit=30&addressdetails=1`,m=await fetch(o,{headers:{Accept:"application/json"}}),u=(await m.json()).filter(e=>"place"===e.class&&("city"===e.type||"town"===e.type||"village"===e.type)).map(e=>{let t=e.address?.city||e.address?.town||e.address?.village||e.display_name.split(",")[0],a=e.address?.country||e.display_name.split(",").slice(-1)[0];return{city:t,name:e.display_name,country:a}}).filter(e=>{let t=`${(e.city||"").toLowerCase()}|${(e.country||"").toLowerCase()}`;return!(!e.city||l.has(t))&&(l.add(t),!0)}).sort((e,t)=>{let a=c.includes(e.country)?-1:0,r=c.includes(t.country)?-1:0;return a-r});W(e=>[...e,...u])}catch{}finally{ee(!1)}}function e_(e,t){M(a=>a.map((a,r)=>r===e?{...a,name:t}:a)),J(null),e===B.length-1&&(Q("stay"),z(C("lastCitySelectedGoToPurchase"),{duration:7e3}))}if((0,a.useEffect)(()=>{null!==Y&&("checkout"===K?z(C("chooseCheckoutDateHint"),{duration:5e3}):"stay"===K?z(C("clickBuyAccommodationHint"),{duration:5e3}):"name"===K&&z(C("typeCityNameScrollHint"),{duration:6e3}))},[Y,K,z,C]),(0,a.useEffect)(()=>{null!==U&&(_.current||(z(C("useLinksSaveDocsHint"),{key:"useLinksSaveDocsHint"}),_.current=!0))},[U,z,C]),(0,a.useEffect)(()=>{K&&(ep(!1),ex(!1))},[K]),(0,a.useEffect)(()=>{if(et)try{(I||"").includes("/entertainment/reservations")&&ea(!1)}catch{}},[I,et]),(0,a.useEffect)(()=>{try{if(!B.length)return;localStorage.setItem("calentrip_trip_summary",JSON.stringify({cities:B}))}catch{}(async()=>{try{if(!B.length)return;let e=await (0,u.getSavedTrips)(),t=e.sort((e,t)=>Number(t.savedAt||0)-Number(e.savedAt||0))[0]||null;try{let a=localStorage.getItem("calentrip:tripSearch"),r=a?JSON.parse(a):null;if(r){let a,s="same"===r.mode,n=s?r.origin:r.outbound?.origin,i=s?r.destination:r.outbound?.destination,l=s?r.departDate:r.outbound?.date,c=(a=r.passengers||{},Number(a.adults||0)+Number(a.children||0)+Number(a.infants||0)),d=n&&i?`${n} → ${i}`:"",o=e.find(e=>e.title===d&&e.date===l&&Number(e.passengers||0)===c)||null;o&&(t=o)}}catch{}if(!t)return;let a=[...(await (0,u.getTripEvents)(t.id)||[]).filter(e=>"stay"!==e.type&&"transport"!==e.type)];for(let e=0;e<B.length;e++){let t=B[e],r=t.name||`Cidade ${e+1}`,s=t.address||"(endereço não informado)";if(t.checkin){let n=0===e?"23:59":"17:00";try{0===e&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}a.push({name:"Check-in hospedagem",label:`Check-in hospedagem: ${r} • Endere\xe7o: ${s}`,date:t.checkin,time:n,type:"stay"})}t.checkout&&a.push({name:"Checkout hospedagem",label:`Checkout hospedagem: ${r} • Endere\xe7o: ${s}`,date:t.checkout,time:"08:00",type:"stay"})}for(let e=0;e<B.length-1;e++){let t=B[e],r=B[e+1],s=t.transportToNext;if(s){let n=`${C("transport")}: ${t.name||`${C("cityGeneric")} ${e+1}`} → ${r?.name||`${C("cityGeneric")} ${e+2}`} • ${(s.mode||"").toUpperCase()}`,i=t.checkout||r?.checkin||"",l=s.depTime||"11:00";a.push({name:C("transport"),label:n,date:i,time:l,type:"transport"})}}let r=new Set,s=a.filter(e=>{let t=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!r.has(t)&&(r.add(t),!0)});await (0,u.saveCalendarEvents)(t.id,s);try{let e={name:t.savedCalendarName||"",events:s};localStorage.setItem("calentrip:saved_calendar",JSON.stringify(e))}catch{}}catch{}})()},[B,C]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:show_summary");if("1"===e){if(en(!0),setTimeout(()=>en(!1),4e3),er.current)try{er.current.scrollIntoView({behavior:"smooth",block:"center"})}catch{}localStorage.removeItem("calentrip:show_summary")}}catch{}},[]),!E)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center px-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"mb-3",children:C("noTrips")}),(0,t.jsx)(n.Button,{onClick:()=>k.push("/flights/search"),children:C("searchFlights")})]})});let ez="same"===E.mode;return(0,t.jsx)("div",{className:"min-h-screen px-4 py-6 space-y-6",children:(0,t.jsxs)("div",{className:"container-page grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-base",children:"hotel"}),(0,t.jsx)("span",{children:C("advanceToStay")})]})}),(0,t.jsx)(s.CardContent,{children:ez?(0,t.jsxs)("div",{className:"space-y-3 max-w-md",children:[(()=>{try{let e="true"===localStorage.getItem("calentrip:arrivalNextDay_outbound");return(0,t.jsxs)("div",{className:"mt-2 flex items-start gap-2 rounded-md border border-amber-500 bg-amber-50 p-2 text-xs text-amber-900",style:{maxHeight:e?eg.maxH:0,opacity:+!!e,transition:eg.transition,overflow:"hidden"},"aria-hidden":!e,children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-amber-700",children:"warning"}),(0,t.jsx)("span",{children:C("stayCheckinNextDayNote")})]})}catch{return null}})(),(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Cidade para a hospedagem"}),(0,t.jsx)(i.Input,{placeholder:C("stayCityInputPlaceholder"),value:L,className:ei?"ring-4 ring-amber-500 animate-pulse":void 0,onChange:e=>{let t=e.target.value;O(t),E?.mode==="same"&&((t||"").trim()?(el(!1),ed(!0)):(el(!0),ed(!1)))}}),(0,t.jsx)("div",{children:(0,t.jsx)(n.Button,{type:"button",className:(ec?"ring-4 ring-amber-500 animate-pulse ":"")+"w-full sm:w-auto",onClick:()=>{let e=L||R;e?(M([{name:e,checkin:eL.checkin||"",checkout:eL.checkout||""}]),P(0),q(0),Q("address"),ed(!1),z(C("selectAccommodation"))):z(C("defineCityError"))},children:C("searchAccommodationButton")})})]}):(0,t.jsxs)("div",{className:"space-y-3 max-w-md",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Data de chegada"}),": ",eA||"—"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Data de retorno"}),": ",eI||"—"]})]}),(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Quantidade de cidades"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Input,{type:"number",min:1,max:8,value:F||"",className:eu?"ring-4 ring-amber-500":void 0,onChange:e=>{let t=Number(e.target.value)||0;D(t),E?.mode==="different"&&(t>0?(ep(!1),ex(!0)):(ep(!0),ex(!1)))}}),(0,t.jsx)(n.Button,{type:"button",role:"button",className:eh?"ring-4 ring-amber-500 animate-pulse":void 0,style:{touchAction:"manipulation"},onClick:()=>{ep(!1),ex(!1),eO()},onTouchStart:()=>{ep(!1),ex(!1),eO()},onTouchEnd:()=>{ep(!1),ex(!1),eO()},onPointerUp:()=>{ep(!1),ex(!1),eO()},children:"Check"})]}),B.length>0&&(0,t.jsx)("div",{className:"space-y-3",children:B.map((e,a)=>{let r;return(0,t.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,t.jsxs)("div",{className:"mb-2 text-sm font-semibold",children:["Cidade ",a+1]}),null,null,(r=0===a||!!(B[a-1]?.checked&&B[a-1]?.address),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,t.jsxs)("div",{className:"sm:col-span-1",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Nome da cidade"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(i.Input,{placeholder:C("stayCityInputPlaceholder"),value:e.name,disabled:!r,className:Y===a&&"name"===K?"ring-4 ring-amber-500 animate-pulse":void 0,onChange:e=>{let t=e.target.value;M(e=>e.map((e,r)=>r===a?{...e,name:t}:e)),r&&t.trim().length>=3&&(J(a),e$(t.trim())),Y===a&&t.trim()&&Q(a===B.length-1?"stay":"checkout")}})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Check-in"}),(0,t.jsx)(l.CalendarInput,{value:e.checkin,min:eA||void 0,max:eI||void 0,disabled:!r,onFocus:()=>{!e.checkin&&eA&&M(e=>e.map((e,t)=>t===a?{...e,checkin:eA}:e))},onChange:e=>M(t=>t.map((t,r)=>r===a?{...t,checkin:e.target.value}:t))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Check-out"}),(0,t.jsx)(l.CalendarInput,{value:e.checkout,min:e.checkin||eA||void 0,max:eI||void 0,disabled:!r||a===B.length-1,className:Y===a&&"checkout"===K?"ring-4 ring-amber-500 animate-pulse":void 0,onFocus:()=>{let t=e.checkin||eA;!e.checkout&&t&&M(e=>e.map((e,r)=>r===a?{...e,checkout:t}:e))},onChange:e=>{let t=e.target.value;M(e=>e.map((e,r)=>r===a?{...e,checkout:t}:e));let r=a+1;r<B.length&&M(e=>e.map((e,a)=>a===r?{...e,checkin:t||e.checkin}:e)),Y===a&&t&&Q("stay")}})]})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,t.jsx)(n.Button,{type:"button",disabled:!r||!(e.name&&(a===B.length-1||e.checkout)),className:Y===a&&"stay"===K?"ring-4 ring-amber-500 animate-pulse":void 0,onClick:()=>{z("Escolha a acomodação"),P(a),Q("address")},children:"Comprar hospedagem"}),a>=1?(0,t.jsx)(n.Button,{type:"button",variant:"secondary",disabled:!(B[a-1]?.name&&B[a]?.name&&B[a-1]?.checkout&&B[a]?.checkin&&B[a-1]?.checked&&B[a]?.checked),onClick:()=>{try{ev(a-1)}catch{}},children:"Transporte"}):null]})]}))]},a)})}),(0,t.jsx)(c.Dialog,{open:null!==H,onOpenChange:()=>J(null),children:(0,t.jsxs)("div",{className:"fixed inset-0 z-50 w-full md:inset-y-0 md:right-0 md:max-w-md rounded-none md:rounded-l-lg bg-white shadow-lg dark:bg-black border border-zinc-200 dark:border-zinc-800 flex flex-col h-screen",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(c.DialogHeader,{children:C("searchCityTitle")}),(0,t.jsx)(i.Input,{placeholder:C("typeCity"),value:X,onChange:e=>e$(e.target.value)})]}),(0,t.jsx)("div",{className:"px-4 pb-4 flex-1 overflow-y-auto",children:Z?(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:C("loading")}):0===G.length?(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:C("noSuggestionsFound")}):(0,t.jsx)("ul",{className:"max-h-64 overflow-auto divide-y",children:G.map((e,a)=>(0,t.jsx)("li",{children:(0,t.jsx)("button",{type:"button",className:"w-full px-3 py-2 text-left hover:bg-zinc-50",onClick:()=>e_(Number(H),e.city),children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:e.city}),(0,t.jsx)("div",{className:"text-xs text-zinc-600",children:e.country})]})})})},`${e.city}-${a}`))})}),(0,t.jsx)("div",{className:"sticky bottom-0 p-4 border-t bg-white dark:bg-black",children:(0,t.jsx)(n.Button,{type:"button",variant:"secondary",disabled:!X.trim(),onClick:()=>{let e=X.trim();e&&(e_(Number(H),e),z(C("cityDefinedManually")))},children:C("useTypedCityButton")})})]})}),null!==eN?(0,t.jsx)(c.Dialog,{open:!0,onOpenChange:()=>ev(null),children:(0,t.jsxs)("div",{className:"fixed inset-0 z-50 w-full md:inset-y-0 md:right-0 md:max-w-md rounded-none md:rounded-l-lg bg-white shadow-lg dark:bg-black border border-zinc-200 dark:border-zinc-800 flex flex-col h-screen",children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)(c.DialogHeader,{children:[C("transportBetween")," ",C("and")]})}),(0,t.jsx)("div",{className:"px-4 pb-4 flex-1 overflow-y-auto text-sm",children:(p=B[eN]?.name||`Cidade ${eN+1}`,h=B[eN+1]?.name||`Cidade ${eN+2}`,x=B[eN]?.checkout||"",g=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(p)}&destination=${encodeURIComponent(h)}`,y=new URLSearchParams({lang:"pt-BR",currency:"BRL"}),x&&y.set("date",x),f=`https://www.rome2rio.com/s/${encodeURIComponent(p)}/${encodeURIComponent(h)}`,b=y.toString()?`${f}?${y.toString()}`:f,N=B[eN]?.transportToNext||{mode:"air",dep:"",arr:"",depTime:"",arrTime:"",files:[]},v=e=>{M(t=>t.map((t,a)=>a===eN?{...t,transportToNext:{...t.transportToNext||{mode:"air",dep:"",arr:"",depTime:"",arrTime:"",files:[]},...e}}:t))},(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"font-medium",children:[p," → ",h]}),(0,t.jsxs)("div",{className:"text-zinc-600",children:["Data de busca: ",x||"—"]}),(0,t.jsxs)("div",{className:"rounded-md border p-2 text-xs",children:["Clique no link abaixo e escolha e compre como você vai da cidade ",eN+1," para a cidade ",eN+2,"."]}),(0,t.jsxs)("ul",{className:"space-y-1",children:[(0,t.jsx)("li",{children:(0,t.jsxs)("a",{className:"text-[#febb02] underline decoration-2 underline-offset-2 font-semibold hover:text-amber-700 flex items-center gap-1",href:b,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"alt_route"}),(0,t.jsx)("span",{children:"Opções de rota (Rome2Rio)"})]})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{className:"text-[#febb02] underline decoration-2 underline-offset-2 font-semibold hover:text-amber-700",href:g,target:"_blank",rel:"noopener noreferrer",children:"Google Maps"})})]}),(0,t.jsxs)("div",{className:"mt-2 rounded-lg border p-3",children:[(0,t.jsx)("div",{className:"font-semibold mb-2",children:"Dados do seu transporte comprado"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Modal"}),(0,t.jsxs)("select",{className:"w-full border rounded-md h-9 px-2",value:N.mode,onChange:e=>v({mode:e.target.value}),children:[(0,t.jsx)("option",{value:"air",children:"Avião"}),(0,t.jsx)("option",{value:"train",children:"Trem"}),(0,t.jsx)("option",{value:"bus",children:"Ônibus"}),(0,t.jsx)("option",{value:"car",children:"Carro"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Hora de partida"}),(0,t.jsx)(i.Input,{type:"tel",inputMode:"numeric",pattern:"[0-9]*",defaultValue:N.depTime||"",onChange:e=>v({depTime:e.target.value}),disabled:"car"===N.mode})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Hora de chegada"}),(0,t.jsx)(i.Input,{type:"tel",inputMode:"numeric",pattern:"[0-9]*",defaultValue:N.arrTime||"",onChange:e=>v({arrTime:e.target.value}),disabled:"car"===N.mode})]})]}),"air"===N.mode?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:C("origin")}),(0,t.jsx)(i.Input,{defaultValue:N.dep||"",onChange:e=>v({dep:e.target.value}),placeholder:"Digite a origem"})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:C("destination")}),(0,t.jsx)(i.Input,{defaultValue:N.arr||"",onChange:e=>v({arr:e.target.value}),placeholder:"Digite o destino"})]})]}):"train"===N.mode?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Estação de trem de origem"}),(0,t.jsx)(i.Input,{defaultValue:N.dep||"",onChange:e=>v({dep:e.target.value}),placeholder:"Digite a origem"})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Estação de trem de destino"}),(0,t.jsx)(i.Input,{defaultValue:N.arr||"",onChange:e=>v({arr:e.target.value}),placeholder:"Digite o destino"})]})]}):"bus"===N.mode?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Rodoviária de origem"}),(0,t.jsx)(i.Input,{defaultValue:N.dep||"",onChange:e=>v({dep:e.target.value}),placeholder:"Digite a origem"})]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Rodoviária de destino"}),(0,t.jsx)(i.Input,{defaultValue:N.arr||"",onChange:e=>v({arr:e.target.value}),placeholder:"Digite o destino"})]})]}):null,(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)(n.Button,{type:"button",onClick:async()=>{let t=document.createElement("input");t.type="file",t.accept="image/*,application/pdf",t.multiple=!0,t.onchange=async t=>{let a=Array.from(t.target.files||[]),r=await e.A(10202),s=await Promise.all(a.map(async e=>{let t=await r.saveFromFile(e);return{name:t.name,type:t.type,size:t.size,id:t.id}}));v({files:[...N.files||[],...s]})},t.click()},disabled:"car"===N.mode,className:"px-2 py-1 text-xs rounded-md gap-1",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"attach_file"}),(0,t.jsx)("span",{children:C("attachProofButton")})]})})]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(n.Button,{type:"button",onClick:()=>{v({mode:N.mode,dep:N.dep,arr:N.arr,depTime:N.depTime,arrTime:N.arrTime});try{localStorage.setItem("calentrip_trip_summary",JSON.stringify({cities:B}))}catch{}if(eN+1<B.length-1)z("Abrindo o transporte da próxima viagem para comprar e preencher.",{duration:7e3}),ev(eN+1);else{z("Indo para o resumo. Verifique as informações.",{duration:3e3}),ev(null),en(!0);try{localStorage.setItem("calentrip:show_summary","1")}catch{}try{setTimeout(()=>{try{er.current&&er.current.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},300)}catch{}}},children:"Salvar transporte"})})]}))})]})}):null]})})]}),null!==U&&(0,t.jsx)(c.Dialog,{open:!0,onOpenChange:()=>P(null),children:(0,t.jsxs)("div",{className:"fixed inset-y-0 right-0 z-50 w-full max-w-md rounded-l-lg bg-white p-4 shadow-lg dark:bg-black border border-zinc-200 dark:border-zinc-800",children:[(0,t.jsx)(c.DialogHeader,{children:C("accommodationDialogTitle")}),(0,t.jsxs)("div",{className:"p-1 space-y-2 text-sm",children:[(0,t.jsx)("div",{className:"font-semibold",children:B[U]?.name||`${C("cityGeneric")} ${(U??0)+1}`}),(0,t.jsxs)("div",{children:[C("checkinLabel"),": ",B[U]?.checkin||"—"]}),(0,t.jsxs)("div",{children:[C("checkoutLabel"),": ",B[U]?.checkout||"—"]}),(0,t.jsx)("div",{className:"mt-2 font-bold text-[#febb02]",children:C("accommodationLinksTitle")}),(0,t.jsx)("ul",{className:"space-y-1",children:(j=encodeURIComponent(B[U]?.name||""),T=B[U]?.checkin||"",w=B[U]?.checkout||"",[{name:"Booking",href:`https://www.booking.com/searchresults.html?ss=${j}&checkin=${T}&checkout=${w}`},{name:"Airbnb",href:`https://www.airbnb.com/s/${j}/homes?checkin=${T}&checkout=${w}`},{name:"Trivago",href:`https://www.trivago.com/?s=${j}&checkIn=${T}&checkOut=${w}`}]).map(e=>(0,t.jsx)("li",{children:(0,t.jsx)("a",{className:"text-[#febb02] underline decoration-2 underline-offset-2 font-semibold hover:text-amber-700",href:e.href,target:"_blank",rel:"noopener noreferrer",children:e.name})},e.name))}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:C("stayAddressLabel")}),(0,t.jsx)(i.Input,{placeholder:C("stayAddressPlaceholder"),value:B[U]?.address||"",className:Y===U&&"address"===K?"ring-4 ring-amber-500 animate-pulse":void 0,onChange:e=>{let t=e.target.value;M(e=>e.map((e,a)=>a===U?{...e,address:t}:e)),Y===U&&t.trim()&&Q("check")}}),(0,t.jsx)("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-900 dark:border-amber-300 dark:bg-amber-900/20 dark:text-amber-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-full border border-amber-300 bg-amber-100",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[14px] text-amber-800",children:"info"})}),(0,t.jsx)("span",{children:C("stayAddressInfo")})]})}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"mb-1 font-semibold",children:C("stayDocsTitle")}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{htmlFor:`stay-cam-${U??0}`,className:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-semibold bg-[#febb02] text-black hover:bg-[#ffcc3f] cursor-pointer",children:C("useCamera")}),(0,t.jsx)("input",{id:`stay-cam-${U??0}`,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:t=>{Promise.all(Array.from(t.target.files||[]).map(async t=>{let a=await e.A(10202),r=await a.saveFromFile(t);return{name:r.name,type:r.type,size:r.size,id:r.id}})).then(e=>{M(t=>t.map((t,a)=>a===U?{...t,stayFiles:[...t.stayFiles||[],...e]}:t))})}}),(0,t.jsxs)("label",{htmlFor:`stay-file-${U??0}`,className:"inline-flex items-center justify-center rounded-md px-2 py-1 text-xs gap-1 bg-[#febb02] text-black hover:bg-[#ffcc3f] cursor-pointer",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"attach_file"}),(0,t.jsx)("span",{children:C("attachProofButton")})]}),(0,t.jsx)(i.Input,{id:`stay-file-${U??0}`,className:"hidden",type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:t=>{Promise.all(Array.from(t.target.files||[]).map(async t=>{let a=await e.A(10202),r=await a.saveFromFile(t);return{name:r.name,type:r.type,size:r.size,id:r.id}})).then(e=>{M(t=>t.map((t,a)=>a===U?{...t,stayFiles:[...t.stayFiles||[],...e]}:t))})}})]}),B[U]?.stayFiles&&B[U].stayFiles.length?(0,t.jsx)("ul",{className:"mt-2 text-xs text-zinc-700 dark:text-zinc-300",children:B[U].stayFiles.map((e,a)=>(0,t.jsxs)("li",{children:[e.name," • ",Math.round(e.size/1024)," KB"]},`sf-${a}`))}):null]}),(0,t.jsx)("div",{className:"mt-2 flex justify-end",children:(0,t.jsx)(n.Button,{type:"button",className:Y===U&&"check"===K?"ring-4 ring-amber-500 pulse-ring":void 0,onClick:()=>{!function(e){let t=B[e];if(!t?.address)return z(C("provideStayAddressError"),{variant:"error"});M(t=>t.map((t,a)=>a===e?{...t,checked:!0}:t)),e<B.length-1&&z(C("fillNextCityAndProceedHint"),{duration:7e3});let a=B.every((t,a)=>a===e||t.checked);if(E?.mode==="same"&&a&&em(!0),a&&B.length>1){z(C("chooseTransportFirstSecondCity"),{duration:6e3});try{k.push("/transport/plan?i=0")}catch{}}let r=e+1;r<B.length?(q(r),Q("name")):(q(null),Q(null))}(U),P(null)},children:C("check")})})]})]})]})}),(0,t.jsxs)(s.Card,{className:eS?"border-2 border-[#34c759]":void 0,children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:C("staysTransportsSummaryTitle")}),eS?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-green-200 bg-green-50 px-2 py-0.5 text-xs text-green-700",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[14px]",children:"task_alt"}),C("reservedLabel")]}):null,(0,t.jsx)("span",{className:"ml-auto"}),(0,t.jsxs)(n.Button,{type:"button",variant:"outline",title:C("editLabel"),"aria-label":C("editLabel"),onClick:()=>k.push("/transport/plan"),children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] mr-1",children:"edit"}),(0,t.jsx)("span",{children:C("editTransportLabel")})]})]})}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{ref:er,className:(es?"ring-4 ring-amber-500 animate-pulse ":"")+"rounded-lg",children:[(0,t.jsxs)("ul",{className:"space-y-2 text-sm p-3",children:[B.map((e,a)=>(0,t.jsxs)("li",{className:e.checked&&e.address?"rounded border border-green-200 bg-green-50 p-2 text-zinc-900 dark:bg-green-900 dark:border-green-800 dark:text-green-100":void 0,children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[e.checked&&e.address?(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] text-green-700 dark:text-green-300",children:"task_alt"}):null,(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[C("accommodationDialogTitle"),": ",e.name||`${C("cityLabel")} ${a+1}`," • ",e.checkin||"—"," → ",e.checkout||"—"," • ",e.address||C("addressNotProvided"),(0,t.jsx)("span",{className:"material-symbols-outlined text-[14px] text-zinc-500",children:"edit"})]}),(0,t.jsxs)(n.Button,{type:"button",variant:"outline",title:C("editLabel"),"aria-label":C("editLabel"),className:"ml-2 h-7 px-2",onClick:()=>{P(a),q(a),Q("address")},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] mr-1",children:"edit"}),(0,t.jsx)("span",{children:C("editLabel")})]}),Array.isArray(e.stayFiles)&&e.stayFiles.length?(0,t.jsxs)(n.Button,{type:"button",variant:"outline",className:"ml-1 h-7 px-2",onClick:()=>eT(ej===a?null:a),children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] mr-1",children:"attach_file"}),(0,t.jsx)("span",{children:"Ver documentos"})]}):null]}),ej===a&&Array.isArray(e.stayFiles)&&e.stayFiles.length?(0,t.jsx)("ul",{className:"mt-1 text-xs text-zinc-700 dark:text-zinc-300",children:e.stayFiles.map((e,r)=>(0,t.jsxs)("li",{children:[e.name," • ",Math.round((e.size||0)/1024)," KB"]},`stay-doc-${a}-${r}`))}):null]},`stay-${a}`)),B.map((e,a)=>a<B.length-1?(0,t.jsxs)("li",{className:e.transportToNext?"rounded border border-green-200 bg-green-50 p-2 text-zinc-900 dark:bg-green-900 dark:border-green-800 dark:text-green-100":void 0,children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[e.transportToNext?(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] text-green-700 dark:text-green-300",children:"task_alt"}):null,(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:["Transporte: ",e.name||`Cidade ${a+1}`," → ",B[a+1]?.name||`Cidade ${a+2}`," • ",(e.transportToNext?.mode||"").toUpperCase(),e.transportToNext?.mode==="car"?"":` • ${e.transportToNext?.depTime||"—"} → ${e.transportToNext?.arrTime||"—"}`,` • Anexos: ${ef[a]??(e.transportToNext?.files||[]).length}`,(0,t.jsx)("span",{className:"material-symbols-outlined text-[14px] text-zinc-500",children:"edit"})]}),(0,t.jsxs)(n.Button,{type:"button",variant:"outline",title:C("editLabel"),"aria-label":C("editLabel"),className:"ml-2 h-7 px-2",onClick:()=>k.push(`/transport/plan?i=${a}`),children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] mr-1",children:"edit"}),(0,t.jsx)("span",{children:C("editLabel")})]}),ef[a]??(e.transportToNext?.files||[]).length?(0,t.jsxs)(n.Button,{type:"button",variant:"outline",className:"ml-1 h-7 px-2",onClick:async()=>{if(ew===a)return void eE(null);eE(a);try{let t=(await (0,u.getSavedTrips)()).sort((e,t)=>Number(t.savedAt||0)-Number(e.savedAt||0))[0],r=e.transportToNext,s=Array.isArray(r?.files)?r.files.map(e=>({name:e.name,size:e.size})):[],n=[];if(t){let r=`${e.name||""}->${B[a+1]?.name||""}`;n=(await (0,u.getRefAttachments)(t.id,"transport",r)).map(e=>({name:e.name,size:Number(e.size||0)}))}eC(e=>({...e,[a]:[...s,...n]}))}catch{}},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] mr-1",children:"attach_file"}),(0,t.jsx)("span",{children:"Ver documentos"})]}):null]}),ew===a&&ek[a]?.length?(0,t.jsx)("ul",{className:"mt-1 text-xs text-zinc-700 dark:text-zinc-300",children:ek[a].map((e,r)=>(0,t.jsxs)("li",{children:[e.name," • ",Math.round((e.size||0)/1024)," KB"]},`tr-doc-${a}-${r}`))}):null]},`tr-${a}`):null)]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end p-3 pt-0",children:(0,t.jsx)(n.Button,{type:"button",role:"button",className:eo?"ring-4 ring-amber-500 pulse-ring":void 0,style:{touchAction:"manipulation"},disabled:et,onClick:function(){if(!et){ea(!0);try{let e={cities:B.map(e=>({name:e.name,checkin:e.checkin,checkout:e.checkout,address:e.address,transportToNext:e.transportToNext?{mode:e.transportToNext.mode,dep:e.transportToNext.dep,arr:e.transportToNext.arr,depTime:e.transportToNext.depTime,arrTime:e.transportToNext.arrTime}:void 0}))};localStorage.setItem("calentrip_trip_summary",JSON.stringify(e))}catch{}try{k.push("/entertainment/reservations")}catch{}try{setTimeout(()=>{try{(window.location.pathname||"").includes("/entertainment/reservations")||(window.location.href="/entertainment/reservations")}catch{}},600)}catch{}(async()=>{try{let t=await e.A(66831),a=(await t.getSavedTrips()).sort((e,t)=>Number(t.savedAt||0)-Number(e.savedAt||0))[0];if(a){for(let e of B){let r=(e.stayFiles||[]).filter(e=>e.id).map(e=>({name:e.name,type:e.type,size:e.size,id:e.id}));if(r.length){let s=`${e.name||""}|${e.address||""}`;await t.saveRefAttachments(a.id,"stay",s,r)}}for(let e=0;e<B.length-1;e++){let r=B[e]?.transportToNext;if(r&&Array.isArray(r.files)&&r.files.length){let s=(r.files||[]).filter(e=>"id"in e&&!!e.id).map(e=>({name:e.name,type:e.type,size:e.size,id:e.id||""})),n=`${B[e]?.name||""}->${B[e+1]?.name||""}`;await t.saveRefAttachments(a.id,"transport",n,s)}}}}catch{}})();try{setTimeout(()=>ea(!1),2500)}catch{}}},children:et?(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("span",{className:"h-4 w-4 rounded-full border-2 border-zinc-300 border-t-[var(--brand)] animate-spin","aria-label":"Carregando"}),(0,t.jsx)("span",{children:C("proceedToEntertainment")})]}):C("proceedToEntertainment")})})]})})]})]})})}e.s(["default",()=>p])},53119,e=>{e.v(t=>Promise.all(["static/chunks/234e8831830d8296.js"].map(t=>e.l(t))).then(()=>t(51001)))},40402,e=>{e.v(t=>Promise.all(["static/chunks/da5d6c94d3bd3190.js"].map(t=>e.l(t))).then(()=>t(58981)))},10202,e=>{e.v(t=>Promise.all(["static/chunks/1d1636f154b915fd.js"].map(t=>e.l(t))).then(()=>t(87959)))},86687,e=>{e.v(t=>Promise.all(["static/chunks/4ceed54824c94356.js"].map(t=>e.l(t))).then(()=>t(62071)))},66831,e=>{e.v(e=>Promise.resolve().then(()=>e(30826)))}]);