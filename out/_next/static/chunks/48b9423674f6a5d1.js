(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46588,e=>{"use strict";var r=e.i(47167),t=e.i(82568),o=e.i(74870);let i=(0,t.registerPlugin)("Billing");async function n(){if("android"!==t.Capacitor.getPlatform())return!1;try{let e=await i.isReady();return!!e?.ready}catch{return!1}}async function a(e="premium_subscription_01"){if("android"!==t.Capacitor.getPlatform())return null;try{let r=await i.queryProduct({productId:e});return r?.found?r:null}catch{return null}}async function u(e="premium_subscription_01"){if("android"!==t.Capacitor.getPlatform())return{code:-1};try{return await i.purchaseTripPremium({productId:e})}catch{return{code:-1}}}async function c(e=15e3){return"android"!==t.Capacitor.getPlatform()?null:await new Promise(async r=>{let t=!1;i.addListener("purchase",e=>{t||(t=!0,r(e?.token||null))});try{let e=await i.getLastToken();if(!t&&e?.token){t=!0,r(e.token);return}}catch{}setTimeout(()=>{t||r(null)},e)})}async function l(e,t){let i=r.default.env.NEXT_PUBLIC_GOOGLE_PLAY_PRODUCT_ID||"premium_subscription_01";if(!await n()){if((t||"").toLowerCase().includes("demo")){let e=Date.now()+864e5;return(0,o.setGlobalPremium)(e),{ok:!0}}return{ok:!1,error:"billing"}}if(!await a(i))return{ok:!1,error:"product"};let l=await u(i);if("number"==typeof l?.code&&0!==l.code)return{ok:!1,error:"purchase"};let s=await c();if(!s)return{ok:!1,error:"token"};try{let r=await fetch("/api/entitlements/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:e,userId:t,purchaseToken:s,productId:i})}),n=await r.json();if(!n?.ok)return{ok:!1,error:"verify"};let a=await fetch("/api/entitlements/ack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({purchaseToken:s,productId:i})}),u=await a.json();if(!u?.ok)return{ok:!1,error:"ack"};let c=Date.now()+2592e6,l=await fetch("/api/entitlements/store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:"global",userId:t,expiresAt:c,orderId:n?.orderId||null,source:"google_play"})}),d=await l.json();if(!d?.ok)return{ok:!1,error:"store"};return(0,o.setGlobalPremium)(c),{ok:!0}}catch{return{ok:!1,error:"network"}}}e.s(["awaitPurchaseToken",()=>c,"completePurchaseForTrip",()=>l,"ensureProduct",()=>a,"isBillingReady",()=>n,"purchaseTripPremium",()=>u])}]);