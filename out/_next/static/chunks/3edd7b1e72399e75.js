(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33023,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(17255),r=e.i(57688),n=e.i(33499),o=e.i(74870),l=e.i(15288),s=e.i(19455),d=e.i(93479),c=e.i(67489),m=e.i(76639),u=e.i(73635),p=e.i(82568);let h=(0,p.registerPlugin)("CalendarPlugin",{web:{addEvents:async()=>({ok:!1,added:0,errors:["web"]}),requestPermissions:async()=>({granted:!1})}});function g(){try{return"android"===p.Capacitor.getPlatform()}catch{return!1}}var f=e.i(33022),$=e.i(30826),y=e.i(62071),b=e.i(76855);let x=e=>{try{return e?JSON.parse(e):null}catch{return null}};function v(e){let t=new URLSearchParams;t.set("lang",e.lang||"pt-BR"),t.set("currency",e.currency||"BRL"),e.date&&t.set("date",e.date),e.time&&t.set("time",e.time),e.passengers&&t.set("passengers",String(e.passengers)),e.originLat&&e.originLon&&(t.set("sLat",String(e.originLat)),t.set("sLng",String(e.originLon))),e.destLat&&e.destLon&&(t.set("dLat",String(e.destLat)),t.set("dLng",String(e.destLon)));let a=`https://www.rome2rio.com/s/${encodeURIComponent(e.originName)}/${encodeURIComponent(e.destName)}`,i=t.toString();return i?`${a}?${i}`:a}function N(){let N,S,j,k,T,[C,I]=(0,a.useState)([]),[D,A]=(0,a.useState)(!1),[E,U]=(0,a.useState)(!1),[M,R]=(0,a.useState)(null),[O,_]=(0,a.useState)(null),[P,z]=(0,a.useState)(!1),[F,L]=(0,a.useState)(!1),[B,V]=(0,a.useState)(!1),[G,J]=(0,a.useState)(null),[H,Z]=(0,a.useState)([]),[q,K]=(0,a.useState)(null),W=(0,a.useRef)({}),Y=(0,a.useRef)({}),[Q,X]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(null),{show:ea}=(0,u.useToast)(),ei=(0,a.useRef)(new Set),er=(0,a.useCallback)((e,t)=>{if(ei.current.has(e))return 0;ei.current.add(e);let a=ea(e,t);try{setTimeout(()=>{try{ei.current.delete(e)}catch{}},15e3)}catch{}return a},[ea]),[en,eo]=(0,a.useState)("default"),[el,es]=(0,a.useState)(!1),[ed,ec]=(0,a.useState)(!1),[em,eu]=(0,a.useState)(""),[ep,eh]=(0,a.useState)([]),[eg,ef]=(0,a.useState)(!1),[e$,ey]=(0,a.useState)(!1),[eb,ex]=(0,a.useState)(null),[ev,eN]=(0,a.useState)(null),[ew,eS]=(0,a.useState)(!1),[ej,ek]=(0,a.useState)(""),[eT,eC]=(0,a.useState)([]),[eI,eD]=(0,a.useState)([]),[eA,eE]=(0,a.useState)([]),eU=(0,a.useRef)({arrival:!1,return:!1}),[eM,eR]=(0,a.useState)(!1),[eO,e_]=(0,a.useState)(!1),[eP,ez]=(0,a.useState)(!1),[eF,eL]=(0,a.useState)([]),[eB,eV]=(0,a.useState)([]),[eG,eJ]=(0,a.useState)(!1),[eH,eZ]=(0,a.useState)([]),{data:eq,status:eK}=(0,i.useSession)(),{lang:eW,t:eY}=(0,n.useI18n)(),[eQ,eX]=(0,a.useState)(null),[e0,e1]=(0,a.useState)(null),[e2,e3]=(0,a.useState)(!1),[e6,e5]=(0,a.useState)(""),[e4,e8]=(0,a.useState)(""),[e7,e9]=(0,a.useState)(!1),[te,tt]=(0,a.useState)(null),[ta,ti]=(0,a.useState)(""),[tr,tn]=(0,a.useState)("");function to(){try{let e=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch");return e?JSON.parse(e):null}catch{return null}}let tl=(0,a.useCallback)(e=>{if((e.departureTime||"").trim())return(e.departureTime||"").trim();let t=to();if(!t)return;let a=e.leg;return"same"===t.mode?"outbound"===a?t.departTime||void 0:"inbound"===a&&t.returnTime||void 0:"outbound"===a?t.outbound?.time||void 0:"inbound"===a&&t.inbound?.time||void 0},[]);(0,a.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,a=Array.isArray(t?.cities)?t.cities:[],i=localStorage.getItem("calentrip:entertainment:records"),r=i?JSON.parse(i):[];if(!a.length&&(!Array.isArray(r)||!r.length))return;I(e=>{let t=[];a.forEach((e,i)=>{let r=e.name||`${eY("cityGeneric")} ${i+1}`,n=e.address||eY("addressNotProvided");e.checkin&&t.push({type:"stay",label:`${eY("stayCheckinLabel")}: ${r} • ${eY("addressLabel")}: ${n}`,date:e.checkin,time:"14:00",meta:{city:r,address:n,kind:"checkin"}}),e.checkout&&t.push({type:"stay",label:`${eY("stayCheckoutLabel")}: ${r} • ${eY("addressLabel")}: ${n}`,date:e.checkout,time:"11:00",meta:{city:r,address:n,kind:"checkout"}});let o=e.transportToNext,l=a[i+1];if(o&&l){let a=`${eY("transport")}: ${e.name||`${eY("cityGeneric")} ${i+1}`} → ${l?.name||`${eY("cityGeneric")} ${i+2}`} • ${(o.mode||"").toUpperCase()}`,r=e.checkout||l?.checkin||"",n=o.depTime||"11:00";t.push({type:"transport",label:a,date:r,time:n,meta:{...o,originAddress:e.address,originCity:e.name}})}}),(r||[]).forEach(e=>t.push({type:e.kind,label:"activity"===e.kind?`${eY("activityWord")}: ${e.title} (${e.cityName})`:`${eY("restaurantWord")}: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e}));let i=new Set;return[...e,...t].filter(e=>{let t="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!i.has(t)&&(i.add(t),!0)})})}catch{}})()},[eY]);let ts=(0,a.useCallback)(async()=>{try{let e=[],t=await (0,$.getSavedTrips)(),a=(0,f.getTrips)(),i=function(){try{let e=to();if(e){let i,r="same"===e.mode,n=r?e.origin:e.outbound?.origin,o=r?e.destination:e.outbound?.destination,l=r?e.departDate:e.outbound?.date,s=(i=e.passengers||{},Number(i.adults||0)+Number(i.children||0)+Number(i.infants||0)),d=n&&o?`${n} → ${o}`:"",c=t.find(e=>e.title===d&&e.date===l&&Number(e.passengers||0)===s)||null;if(c)return c;let m=a.find(e=>e.title===d&&e.date===l&&Number(e.passengers||0)===s)||null;if(m)return m}}catch{}return t.find(e=>e.reachedFinalCalendar)||(t.length?t[0]:a.length?a[0]:null)}(),r=i?.flightNotes||[],n=new Set;r.forEach(t=>{let a="outbound"===t.leg?eY("outboundFlight"):eY("inboundFlight"),i=`${t.leg}|${t.origin}|${t.destination}|${t.date}`;if(!n.has(i)){n.add(i);let r=tl(t)||(t.departureTime||"").trim(),o=t.arrivalTime||"";e.push({type:"flight",label:`${a}: ${t.date} • ${r}${o?` → ${o}${t.arrivalNextDay?" (+1d)":""}`:""} • ${t.origin} → ${t.destination}${t.flightNumber?` • ${t.flightNumber}`:""}`,date:t.date,time:r||void 0,meta:t})}});try{let t=to();if(t)if("same"===t.mode){let a=(t.origin||"").trim(),i=(t.destination||"").trim(),r=(t.departDate||"").trim(),n=(t.returnDate||"").trim();a&&i&&r&&e.push({type:"flight",label:`${eY("outboundFlight")}: ${r} • ${(t.departTime||"").trim()} • ${a} → ${i}${(t.departFlightNumber||"").trim()?` • ${t.departFlightNumber}`:""}`,date:r,time:t.departTime||void 0,meta:{leg:"outbound",origin:a,destination:i,date:r,departureTime:t.departTime||void 0,flightNumber:t.departFlightNumber||void 0}}),a&&i&&n&&e.push({type:"flight",label:`${eY("inboundFlight")}: ${n} • ${(t.returnTime||"").trim()} • ${i} → ${a}${(t.returnFlightNumber||"").trim()?` • ${t.returnFlightNumber}`:""}`,date:n,time:t.returnTime||void 0,meta:{leg:"inbound",origin:i,destination:a,date:n,departureTime:t.returnTime||void 0,flightNumber:t.returnFlightNumber||void 0}})}else{let a=t.outbound,i=t.inbound;a?.origin&&a?.destination&&a?.date&&e.push({type:"flight",label:`${eY("outboundFlight")}: ${a.date} • ${(a.time||"").trim()} • ${a.origin} → ${a.destination}${(a.flightNumber||"").trim()?` • ${a.flightNumber}`:""}`,date:a.date,time:a.time||void 0,meta:{leg:"outbound",origin:a.origin,destination:a.destination,date:a.date,departureTime:a.time||void 0,flightNumber:a.flightNumber||void 0}}),i?.origin&&i?.destination&&i?.date&&e.push({type:"flight",label:`${eY("inboundFlight")}: ${i.date} • ${(i.time||"").trim()} • ${i.origin} → ${i.destination}${(i.flightNumber||"").trim()?` • ${i.flightNumber}`:""}`,date:i.date,time:i.time||void 0,meta:{leg:"inbound",origin:i.origin,destination:i.destination,date:i.date,departureTime:i.time||void 0,flightNumber:i.flightNumber||void 0}})}}catch{}let o=localStorage.getItem("calentrip_trip_summary"),l=o?JSON.parse(o):null,s=Array.isArray(l?.cities)?l.cities:[];s.forEach((t,a)=>{let i=t.name||`${eY("cityGeneric")} ${a+1}`,r=t.address||eY("addressNotProvided");if(t.checkin){let n=0===a?"23:59":"17:00";try{0===a&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}e.push({type:"stay",label:`${eY("stayCheckinLabel")}: ${i} • ${eY("addressLabel")}: ${r}`,date:t.checkin,time:n,meta:{city:i,address:r,kind:"checkin"}})}t.checkout&&e.push({type:"stay",label:`${eY("stayCheckoutLabel")}: ${i} • ${eY("addressLabel")}: ${r}`,date:t.checkout,time:"08:00",meta:{city:i,address:r,kind:"checkout"}})});for(let t=0;t<s.length-1;t++){let a=s[t],i=s[t+1],r=a.transportToNext;if(r){let n=`${eY("transport")}: ${a.name||`${eY("cityGeneric")} ${t+1}`} → ${i?.name||`${eY("cityGeneric")} ${t+2}`} • ${(r.mode||"").toUpperCase()}`,o=a.checkout||i?.checkin||"",l=r.depTime||"11:00";e.push({type:"transport",label:n,date:o,time:l,meta:{...r,originAddress:a.address,originCity:a.name}})}}let d=localStorage.getItem("calentrip:entertainment:records");((d?JSON.parse(d):[])||[]).forEach(t=>{e.push({type:t.kind,label:"activity"===t.kind?`${eY("activityWord")}: ${t.title} (${t.cityName})`:`${eY("restaurantWord")}: ${t.title} (${t.cityName})`,date:t.date,time:t.time,meta:t})});let c=new Set,m=e.filter(e=>{let t="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!c.has(t)&&(c.add(t),!0)}),u=(e,t)=>{let a=(t||"00:00").padStart(5,"0"),i=`${(e||"").replace(/\//g,"-")}T${a}:00`,r=new Date(i);return Number.isNaN(r.getTime())?0:r.getTime()},p=[...m].sort((e,t)=>u(e.date,e.time)-u(t.date,t.time));I(p)}catch{}},[tl,eY]);(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:entertainment:records"),t=e?JSON.parse(e):[];if(Array.isArray(t)&&t.length){let e=t.map(e=>({type:e.kind,label:"activity"===e.kind?`Atividade: ${e.title} (${e.cityName})`:`Restaurante: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e}));I(t=>{let a=new Set;return[...t,...e].filter(e=>{let t=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!a.has(t)&&(a.add(t),!0)})})}}catch{}},[ts,eY]),(0,a.useEffect)(()=>{(async()=>{try{let e=!C.some(e=>"flight"===e.type),t=!C.some(e=>"stay"===e.type),a=!C.some(e=>"transport"===e.type);if(!(e||t||a))return;let i=[],r=to(),n=[];try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null;n=Array.isArray(t?.cities)?t.cities:[]}catch{}if(e){try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=(await (0,$.getSavedTrips)()).sort((e,t)=>Number(t.savedAt||0)-Number(e.savedAt||0))[0]||null,t=e?.flightNotes||[],a=new Set;if(t.forEach(e=>{let t="outbound"===e.leg?"Voo de ida":"Voo de volta",r=`${e.leg}|${e.origin}|${e.destination}|${e.date}`;if(!a.has(r)){a.add(r);let n=(e.departureTime||"").trim(),o=(e.arrivalTime||"").trim();i.push({type:"flight",label:`${t}: ${e.date} • ${n}${o?` → ${o}${e.arrivalNextDay?" (+1d)":""}`:""} • ${e.origin} → ${e.destination}${e.flightNumber?` • ${e.flightNumber}`:""}`,date:e.date,time:n||void 0,meta:e})}}),!i.some(e=>"flight"===e.type)){if(r)if("same"===r.mode){let e=(r.origin||"").trim(),t=(r.destination||"").trim(),a=(r.departDate||"").trim(),n=(r.returnDate||"").trim();e&&t&&a&&i.push({type:"flight",label:`Voo de ida: ${a}${(r.departTime||"").trim()?` • ${(r.departTime||"").trim()}`:""} • ${e} → ${t}${(r.departFlightNumber||"").trim()?` • ${r.departFlightNumber}`:""}`,date:a,time:r.departTime||void 0,meta:{leg:"outbound",origin:e,destination:t,date:a,departureTime:r.departTime||void 0,flightNumber:r.departFlightNumber||void 0}}),e&&t&&n&&i.push({type:"flight",label:`Voo de volta: ${n}${(r.returnTime||"").trim()?` • ${(r.returnTime||"").trim()}`:""} • ${t} → ${e}${(r.returnFlightNumber||"").trim()?` • ${r.returnFlightNumber}`:""}`,date:n,time:r.returnTime||void 0,meta:{leg:"inbound",origin:t,destination:e,date:n,departureTime:r.returnTime||void 0,flightNumber:r.returnFlightNumber||void 0}})}else{let e=r.outbound,t=r.inbound;e?.origin&&e?.destination&&e?.date&&i.push({type:"flight",label:`Voo de ida: ${e.date}${(e.time||"").trim()?` • ${(e.time||"").trim()}`:""} • ${e.origin} → ${e.destination}${(e.flightNumber||"").trim()?` • ${e.flightNumber}`:""}`,date:e.date,time:e.time||void 0,meta:{leg:"outbound",origin:e.origin,destination:e.destination,date:e.date,departureTime:e.time||void 0,flightNumber:e.flightNumber||void 0}}),t?.origin&&t?.destination&&t?.date&&i.push({type:"flight",label:`Voo de volta: ${t.date}${(t.time||"").trim()?` • ${(t.time||"").trim()}`:""} • ${t.origin} → ${t.destination}${(t.flightNumber||"").trim()?` • ${t.flightNumber}`:""}`,date:t.date,time:t.time||void 0,meta:{leg:"inbound",origin:t.origin,destination:t.destination,date:t.date,departureTime:t.time||void 0,flightNumber:t.flightNumber||void 0}})}else if(e&&(e.title||"").includes("→")&&(e.date||"").trim()){let[t,a]=(e.title||"").split("→").map(e=>e.trim()),o=t||"",l=a||"",s=(e.date||"").trim();i.push({type:"flight",label:`Voo de ida: ${s} • ${o} → ${l}`,date:s,meta:{leg:"outbound",origin:o,destination:l,date:s}});let d=(r?"same"===r.mode?(r.returnDate||"").trim():(r.inbound?.date||"").trim():"")||n.slice(-1)[0]?.checkout||"";(d||"").trim()&&i.push({type:"flight",label:`Voo de volta: ${(d||"").trim()} • ${l} → ${o}`,date:(d||"").trim(),meta:{leg:"inbound",origin:l,destination:o,date:(d||"").trim()}})}}}catch{}if(!i.some(e=>"flight"===e.type)&&r)if("same"===r.mode){let e=(r.origin||"").trim(),t=(r.destination||"").trim(),a=(r.departDate||"").trim(),n=(r.returnDate||"").trim();e&&t&&a&&i.push({type:"flight",label:`Voo de ida: ${a}${(r.departTime||"").trim()?` • ${(r.departTime||"").trim()}`:""} • ${e} → ${t}${(r.departFlightNumber||"").trim()?` • ${r.departFlightNumber}`:""}`,date:a,time:r.departTime||void 0,meta:{leg:"outbound",origin:e,destination:t,date:a,departureTime:r.departTime||void 0,flightNumber:r.departFlightNumber||void 0}}),e&&t&&n&&i.push({type:"flight",label:`Voo de volta: ${n}${(r.returnTime||"").trim()?` • ${(r.returnTime||"").trim()}`:""} • ${t} → ${e}${(r.returnFlightNumber||"").trim()?` • ${r.returnFlightNumber}`:""}`,date:n,time:r.returnTime||void 0,meta:{leg:"inbound",origin:t,destination:e,date:n,departureTime:r.returnTime||void 0,flightNumber:r.returnFlightNumber||void 0}})}else{let e=r.outbound,t=r.inbound;e?.origin&&e?.destination&&e?.date&&i.push({type:"flight",label:`Voo de ida: ${e.date}${(e.time||"").trim()?` • ${(e.time||"").trim()}`:""} • ${e.origin} → ${e.destination}${(e.flightNumber||"").trim()?` • ${e.flightNumber}`:""}`,date:e.date,time:e.time||void 0,meta:{leg:"outbound",origin:e.origin,destination:e.destination,date:e.date,departureTime:e.time||void 0,flightNumber:e.flightNumber||void 0}}),t?.origin&&t?.destination&&t?.date&&i.push({type:"flight",label:`Voo de volta: ${t.date}${(t.time||"").trim()?` • ${(t.time||"").trim()}`:""} • ${t.origin} → ${t.destination}${(t.flightNumber||"").trim()?` • ${t.flightNumber}`:""}`,date:t.date,time:t.time||void 0,meta:{leg:"inbound",origin:t.origin,destination:t.destination,date:t.date,departureTime:t.time||void 0,flightNumber:t.flightNumber||void 0}})}}if(i.length){let e=new Set,t=[...C,...i].filter(t=>{let a=`${t.type}|${t.label}|${(t.date||"").trim()}|${(t.time||"").trim()}`;return!e.has(a)&&(e.add(a),!0)}),a=(e,t)=>{let a=(t||"00:00").padStart(5,"0"),i=`${(e||"").replace(/\//g,"-")}T${a}:00`,r=new Date(i);return Number.isNaN(r.getTime())?0:r.getTime()};I([...t].sort((e,t)=>a(e.date,e.time)-a(t.date,t.time)))}}catch{}})()},[C]);let td=(0,a.useCallback)(()=>{try{let e=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),t=e?JSON.parse(e):null;if(!t)return;let a="same"===t.mode,i=a?t.origin||"":t.outbound?.origin||"",r=a?t.destination||"":t.outbound?.destination||"",n=a?t.departDate||"":t.outbound?.date||"",o=a?t.returnDate||"":t.inbound?.date||"",l=a?t.departTime||"":t.outbound?.time||"",s=a?t.returnTime||"":t.inbound?.time||"",d=i&&r&&n?`Voo de ida: ${n}${(l||"").trim()?` • ${(l||"").trim()}`:""} • ${i} → ${r}`:"",c=a?i&&r&&o?`Voo de volta: ${o}${(s||"").trim()?` • ${(s||"").trim()}`:""} • ${r} → ${i}`:"":t.inbound?.origin&&t.inbound?.destination&&o?`Voo de volta: ${o}${(s||"").trim()?` • ${(s||"").trim()}`:""} • ${t.inbound?.origin} → ${t.inbound?.destination}`:"",m=[];if(d&&m.push({type:"flight",label:d,date:n,time:l||void 0,meta:{leg:"outbound",origin:i,destination:r,date:n}}),c&&m.push({type:"flight",label:c,date:o,time:s||void 0,meta:{leg:"inbound",origin:a?r:t.inbound?.origin||"",destination:a?i:t.inbound?.destination||"",date:o}}),!m.length)return;I(e=>{let t=new Set;return[...e,...m].filter(e=>{let a=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)})})}catch{}},[eY]);async function tc(){try{A(!1);let e=[];try{let t=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),a=x(t);if(a){let t="same"===a.mode,i=t?a.origin||"":a.outbound?.origin||"",r=t?a.destination||"":a.outbound?.destination||"",n=t?a.departDate||"":a.outbound?.date||"",o=t?a.returnDate||"":a.inbound?.date||"",l=t?a.departTime||"":a.outbound?.time||"",s=t?a.returnTime||"":a.inbound?.time||"",d=i&&r&&n?`Voo de ida: ${n}${(l||"").trim()?` • ${(l||"").trim()}`:""} • ${i} → ${r}`:"",c=i&&r&&o?`Voo de volta: ${o}${(s||"").trim()?` • ${(s||"").trim()}`:""} • ${r} → ${i}`:"";d&&e.push({type:"flight",label:d,date:n,time:l||void 0,meta:{leg:"outbound",origin:i,destination:r,date:n}}),c&&e.push({type:"flight",label:c,date:o,time:s||void 0,meta:{leg:"inbound",origin:r,destination:i,date:o}})}}catch{}try{let t=localStorage.getItem("calentrip_trip_summary"),a=x(t),i=Array.isArray(a?.cities)?a.cities:[];eC(i),i.forEach((t,a)=>{let i=t.name||`Cidade ${a+1}`,r=t.address||"(endereço não informado)";if(t.checkin){let n=0===a?"23:59":"17:00";try{0===a&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}e.push({type:"stay",label:`Check-in hospedagem: ${i} • Endere\xe7o: ${r}`,date:t.checkin,time:n,meta:{city:i,address:r,kind:"checkin"}})}t.checkout&&e.push({type:"stay",label:`Checkout hospedagem: ${i} • Endere\xe7o: ${r}`,date:t.checkout,time:"08:00",meta:{city:i,address:r,kind:"checkout"}})});for(let t=0;t<i.length-1;t++){let a=i[t],r=i[t+1],n=a.transportToNext;if(n){let i=`${eY("transport")}: ${a.name||`${eY("cityGeneric")} ${t+1}`} → ${r?.name||`${eY("cityGeneric")} ${t+2}`} • ${(n.mode||"").toUpperCase()}`,o=a.checkout||r?.checkin||"",l=n.depTime||"11:00";e.push({type:"transport",label:i,date:o,time:l,meta:{...n,originAddress:a.address,originCity:a.name}})}}}catch{}try{let t=localStorage.getItem("calentrip:entertainment:records"),a=x(t)||[];(Array.isArray(a)?a:[]).filter(e=>e&&("activity"===e.kind||"restaurant"===e.kind)&&"string"==typeof e.title).forEach(t=>{e.push({type:t.kind,label:"activity"===t.kind?`Atividade: ${t.title} (${t.cityName})`:`Restaurante: ${t.title} (${t.cityName})`,date:t.date,time:t.time,meta:t})})}catch{}try{let t=new Set,a=e.filter(e=>{let a="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)});I(a),ea("Calendário recarregado do storage",{variant:"success",duration:2e3,sticky:!1})}catch{ea("Falha ao recarregar do storage",{variant:"error"})}}catch{ea("Falha ao recarregar do storage",{variant:"error"})}}async function tm(e){try{await tx(e)}catch{}try{if(!g())return;let e=C.map(e=>{var t;let a,i,r=(t=e.date,a=(e.time||"00:00").padStart(5,"0"),i=new Date(`${(t||"").replace(/\//g,"-")}T${a}:00`),Number.isNaN(i.getTime())?null:i),n=r?new Date(r.getTime()+36e5):void 0,o="";try{if("stay"===e.type){let t=e.meta;o=(t?.address||t?.city||"").trim()}else if("activity"===e.type||"restaurant"===e.type){let t=e.meta;o=(t?.address||t?.cityName||"").trim()}else if("transport"===e.type){let t=e.meta;o=(t?.originCity||"").trim()}else if("flight"===e.type){let t=e.meta;o=((t?.origin||"")+(t?.destination?` → ${t.destination}`:"")).trim()}}catch{}let l=[];return"flight"===e.type?l.push(1440,60):"transport"===e.type?l.push(120):("activity"===e.type||"restaurant"===e.type)&&l.push(60),{startISO:r?r.toISOString():new Date().toISOString(),endISO:n?n.toISOString():void 0,title:e.label,description:e.label,location:o,alarms:l}});try{await h.requestPermissions()}catch{}let t=await h.addEvents({events:e});t.ok&&t.added>0&&ea(eY("eventsAddedToCalendarMsg"),{variant:"success"})}catch{}}(0,a.useEffect)(()=>{td()},[td]),(0,a.useEffect)(()=>{(async()=>{try{await ts()}catch{}})()},[ts,eY]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,a=Array.isArray(t?.cities)?t.cities:[];if(!a.length)return;let i=[];a.forEach((e,t)=>{let a=e.name||`Cidade ${t+1}`,r=e.address||"(endereço não informado)";if(e.checkin){let n=0===t?"23:59":"17:00";try{0===t&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}i.push({type:"stay",label:`Check-in hospedagem: ${a} • Endere\xe7o: ${r}`,date:e.checkin,time:n,meta:{city:a,address:r,kind:"checkin"}})}e.checkout&&i.push({type:"stay",label:`Checkout hospedagem: ${a} • Endere\xe7o: ${r}`,date:e.checkout,time:"08:00",meta:{city:a,address:r,kind:"checkout"}})});for(let e=0;e<a.length-1;e++){let t=a[e],r=a[e+1],n=t.transportToNext;if(n){let a=`${eY("transport")}: ${t.name||`${eY("cityGeneric")} ${e+1}`} → ${r?.name||`${eY("cityGeneric")} ${e+2}`} • ${(n.mode||"").toUpperCase()}`,o=t.checkout||r?.checkin||"",l=n.depTime||"11:00";i.push({type:"transport",label:a,date:o,time:l,meta:{...n,originAddress:t.address,originCity:t.name}})}}try{let e=localStorage.getItem("calentrip:entertainment:records");((e?JSON.parse(e):[])||[]).forEach(e=>{i.push({type:e.kind,label:"activity"===e.kind?`Atividade: ${e.title} (${e.cityName})`:`Restaurante: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e})})}catch{}I(e=>{let t=new Set;return[...e,...i].filter(e=>{let a=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)})})}catch{}},[ts,eY]);let tu=(0,a.useCallback)(async()=>{try{if("android"!==p.Capacitor.getPlatform())return void ea(eY("androidOnlyMsg"),{variant:"info"});let e=await w.list();eZ(e?.files||[]),eJ(!0)}catch{eZ([]),eJ(!0)}},[ea,eY]);async function tp(e){try{let t=await w.read({name:e});if(!t?.ok||!t?.json)return void ea(eY("fileOpenError"),{variant:"error"});let a=JSON.parse(t.json);I(a.events||[]),eC(a.summaryCities||[]),eJ(!1),ea(eY("calendarLoadedMsg"),{variant:"success"})}catch{ea(eY("fileOpenError"),{variant:"error"})}}async function th(e){try{let t=await w.delete({name:e});if(t?.ok){let e=await w.list();eZ(e?.files||[])}else ea(eY("deleteErrorMsg"),{variant:"error"})}catch{ea(eY("deleteErrorMsg"),{variant:"error"})}}async function tg(e){try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}try{let t=(await (0,$.getSavedTrips)()).find(t=>t.id===e);t&&e8(t.savedCalendarName||"")}catch{}let t=await (0,$.getTripEvents)(String(e));if(Array.isArray(t)&&t.length){let a=[];try{let t=(await (0,$.getSavedTrips)()).find(t=>t.id===e);a=t?.flightNotes||[]}catch{}let i=t.map(e=>{let t="flight"===e.type||"activity"===e.type||"restaurant"===e.type||"transport"===e.type||"stay"===e.type?e.type:"activity",i="flight"===t?a.find(t=>t.date===e.date):void 0,r="flight"===t&&i?.departureTime?i.departureTime:e.time||void 0,n=e.label||e.name||"";return"flight"===t&&i?.flightNumber&&!n.includes(i.flightNumber)&&(n=`${n} • ${i.flightNumber}`),{type:t,label:n,date:e.date,time:r,meta:i}});return e1(String(e)),I(e=>{let t=new Set;return[...e,...i].filter(e=>{let a="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)})}),!0}return!1}catch{return!1}}(0,a.useEffect)(()=>{try{let e,t=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),a=t?JSON.parse(t):null;if(!a)return;let i="same"===a.mode,r=i?a.origin:a.outbound?.origin,n=i?a.destination:a.outbound?.destination,o=i?a.departDate:a.outbound?.date,l=(e=a.passengers||{},Number(e.adults||0)+Number(e.children||0)+Number(e.infants||0));if(!r||!n||!o)return;let s=`${r} → ${n}`;(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=(await (0,$.getSavedTrips)()).find(e=>e.title===s&&e.date===o&&Number(e.passengers||0)===l);e&&await (0,$.updateTrip)(e.id,{reachedFinalCalendar:!0})}catch{}})()}catch{}},[ts,tl,eY]),(0,a.useEffect)(()=>{(async()=>{try{if(!e0)return;let[e,t]=await Promise.all([(0,$.getTripAttachments)(e0,"outbound"),(0,$.getTripAttachments)(e0,"inbound")]);eD(e),eE(t)}catch{}})()},[e0]),(0,a.useEffect)(()=>{(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=await (0,$.getSavedTrips)(),t=null;try{let a=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),i=a?JSON.parse(a):null;if(i){let a,r="same"===i.mode,n=r?i.origin:i.outbound?.origin,o=r?i.destination:i.outbound?.destination,l=r?i.departDate:i.outbound?.date,s=(a=i.passengers||{},Number(a.adults||0)+Number(a.children||0)+Number(a.infants||0)),d=n&&o?`${n} → ${o}`:"";t=e.find(e=>e.title===d&&e.date===l&&Number(e.passengers||0)===s)||null}}catch{}if(t||(t=e.find(e=>e.reachedFinalCalendar)||(e.length?e[0]:null)),!t)return void await ts();e1(String(t.id));let a=await (0,$.getTripEvents)(String(t.id));if(Array.isArray(a)&&a.length){let e=t.flightNotes||[],i=a.map(t=>{let a,i,r="flight"===t.type||"activity"===t.type||"restaurant"===t.type||"transport"===t.type||"stay"===t.type?t.type:"activity",n=t.label||t.name||"";if("flight"===r){let i=n.startsWith("Voo de ida")?"outbound":n.startsWith("Voo de volta")?"inbound":void 0;a=e.find(e=>e.date===t.date&&(!i||e.leg===i)&&n.includes(e.origin)&&n.includes(e.destination))||e.find(e=>e.date===t.date&&(!i||e.leg===i))||e.find(e=>e.date===t.date)}if("flight"===r){if(!(i=a?.departureTime||t.time||(a?tl(a):void 0))&&n){let e=(n.split(" • ").slice(1)[0]||"").match(/\b(\d{2}:\d{2})\b/);e&&(i=e[1])}}else i=t.time||void 0;return"flight"===r&&a?.flightNumber&&!n.includes(a.flightNumber)&&(n=`${n} • ${a.flightNumber}`),{type:r,label:n,date:t.date,time:i,meta:a}}),r=new Set,n=[];try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,a=Array.isArray(t?.cities)?t.cities:[];a.forEach((e,t)=>{let a=e.name||`Cidade ${t+1}`,i=e.address||"(endereço não informado)";if(e.checkin){let r=0===t?"23:59":"17:00";try{0===t&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(r="14:00")}catch{}n.push({type:"stay",label:`Check-in hospedagem: ${a} • Endere\xe7o: ${i}`,date:e.checkin,time:r,meta:{city:a,address:i,kind:"checkin"}})}e.checkout&&n.push({type:"stay",label:`Checkout hospedagem: ${a} • Endere\xe7o: ${i}`,date:e.checkout,time:"08:00",meta:{city:a,address:i,kind:"checkout"}})});for(let e=0;e<a.length-1;e++){let t=a[e],i=a[e+1],r=t.transportToNext;if(r){let a=`${eY("transport")}: ${t.name||`${eY("cityGeneric")} ${e+1}`} → ${i?.name||`${eY("cityGeneric")} ${e+2}`} • ${(r.mode||"").toUpperCase()}`,o=t.checkout||i?.checkin||"",l=r.depTime||"11:00";n.push({type:"transport",label:a,date:o,time:l,meta:{...r,originAddress:t.address,originCity:t.name}})}}let i=localStorage.getItem("calentrip:entertainment:records");((i?JSON.parse(i):[])||[]).forEach(e=>n.push({type:e.kind,label:"activity"===e.kind?`Atividade: ${e.title} (${e.cityName})`:`Restaurante: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e}))}catch{}let o=[...i,...n].filter(e=>{let t="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!r.has(t)&&(r.add(t),!0)});I(o)}else{let e=t.flightNotes||[],a=[],i=new Set;e.forEach(e=>{let t="outbound"===e.leg?"Voo de ida":"Voo de volta",r=`${e.leg}|${e.origin}|${e.destination}|${e.date}`;if(!i.has(r)){i.add(r);let n=tl(e)||(e.departureTime||"").trim(),o=e.arrivalTime||"";a.push({type:"flight",label:`${t}: ${e.date} • ${n}${o?` → ${o}${e.arrivalNextDay?" (+1d)":""}`:""} • ${e.origin} → ${e.destination}${e.flightNumber?` • ${e.flightNumber}`:""}`,date:e.date,time:n||void 0,meta:e})}});try{let e=localStorage.getItem("calentrip_trip_summary"),t=e?JSON.parse(e):null,i=Array.isArray(t?.cities)?t.cities:[];i.forEach((e,t)=>{let i=e.name||`Cidade ${t+1}`,r=e.address||"(endereço não informado)";if(e.checkin){let n=0===t?"23:59":"17:00";try{0===t&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}a.push({type:"stay",label:`Check-in hospedagem: ${i} • Endere\xe7o: ${r}`,date:e.checkin,time:n,meta:{city:i,address:r,kind:"checkin"}})}e.checkout&&a.push({type:"stay",label:`Checkout hospedagem: ${i} • Endere\xe7o: ${r}`,date:e.checkout,time:"08:00",meta:{city:i,address:r,kind:"checkout"}})});for(let e=0;e<i.length-1;e++){let t=i[e],r=i[e+1],n=t.transportToNext;if(n){let i=`${eY("transport")}: ${t.name||`${eY("cityGeneric")} ${e+1}`} → ${r?.name||`${eY("cityGeneric")} ${e+2}`} • ${(n.mode||"").toUpperCase()}`,o=t.checkout||r?.checkin||"",l=n.depTime||"11:00";a.push({type:"transport",label:i,date:o,time:l,meta:{...n,originAddress:t.address,originCity:t.name}})}}let r=localStorage.getItem("calentrip:entertainment:records");((r?JSON.parse(r):[])||[]).forEach(e=>a.push({type:e.kind,label:"activity"===e.kind?`Atividade: ${e.title} (${e.cityName})`:`Restaurante: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e}))}catch{}let r=new Set,n=a.filter(e=>{let t="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!r.has(t)&&(r.add(t),!0)});n.length?I(e=>{let t=new Set;return[...e,...n].filter(e=>{let a="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)})}):await ts()}}catch{}})()},[ts,tl,eY]),(0,a.useEffect)(()=>{try{let e=setTimeout(()=>{try{(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}await ts()}catch{}})()}catch{}},600);return()=>{try{clearTimeout(e)}catch{}}}catch{}},[ts,tl,eY]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:open_calendar_help");"1"===e&&(e_(!0),localStorage.removeItem("calentrip:open_calendar_help"))}catch{}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:open_files_drawer");"1"===e&&(localStorage.removeItem("calentrip:open_files_drawer"),tu())}catch{}},[tu]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:open_saved_drawer");if("1"===e){localStorage.removeItem("calentrip:open_saved_drawer"),(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=await (0,$.getSavedTrips)();eL(e)}catch{eL([])}})();try{let e=localStorage.getItem("calentrip:saved_calendars_list"),t=e?JSON.parse(e):[];eV(t)}catch{eV([])}ez(!0)}}catch{}},[tu]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:auto_load_saved"),t=localStorage.getItem("calentrip:saved_calendar");if("1"===e&&t){let e=JSON.parse(t);e?.events&&e.events.length&&I(t=>{let a=new Set;return[...t,...e.events||[]].filter(e=>{let t=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!a.has(t)&&(a.add(t),!0)})}),localStorage.removeItem("calentrip:auto_load_saved")}}catch{}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:locConsent");"granted"===e||"denied"===e||"skipped"===e?eo(e):eo("default")}catch{eo("default")}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("calentrip:inspiration_mode");"1"===e&&e3(!0)}catch{}},[]),(0,a.useEffect)(()=>{try{if(!C.length)return;let e=(e,t)=>{let a=(t||"00:00").padStart(5,"0"),i=`${(e||"").replace(/\//g,"-")}T${a}:00`,r=new Date(i);return Number.isNaN(r.getTime())?0:r.getTime()},t=C.map(e=>`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`),a=[...C].sort((t,a)=>e(t.date,t.time)-e(a.date,a.time)),i=a.map(e=>`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`);if(!(t.length===i.length&&t.every((e,t)=>e===i[t]))){let e=new Set,t=a.filter(t=>{let a="stay"===t.type?`${t.type}|${t.label}|${(t.date||"").trim()}`:`${t.type}|${t.label}|${(t.date||"").trim()}|${(t.time||"").trim()}`;return!e.has(a)&&(e.add(a),!0)});I(t)}}catch{}},[C]);let tf=(0,a.useCallback)(()=>"granted"===en||(es(!0),!1),[en]),t$=(0,a.useMemo)(()=>{let e=e=>(e||"").replace(/\//g,"-"),t=[...C].map(e=>{if("activity"===e.type||"restaurant"===e.type){let t=e.meta,a=t?.cityName||"";if(a&&!e.label.includes(a)){let i="activity"===e.type?"Atividade":"Restaurante",r=(e.label.split(":").slice(1).join(":")||t?.title||"").trim(),n=`${i}: ${r} (${a})`;return{...e,label:n}}}return e}).sort((t,a)=>{let i=e(t.date),r=e(a.date);if(i!==r)return i.localeCompare(r);let n="flight"===t.type&&t.meta?.leg==="outbound",o="flight"===a.type&&a.meta?.leg==="outbound",l="stay"===t.type&&t.meta?.kind==="checkin",s="stay"===a.type&&a.meta?.kind==="checkin",d="flight"===t.type&&t.meta?.leg==="inbound",c="flight"===a.type&&a.meta?.leg==="inbound",m="stay"===t.type&&t.meta?.kind==="checkout",u="stay"===a.type&&a.meta?.kind==="checkout";return n&&s?-1:o&&l?1:m&&c?-1:u&&d||d&&!c?1:c&&!d?-1:(t.time||"00:00").padStart(5,"0").localeCompare((a.time||"00:00").padStart(5,"0"))}),a=-1;for(let e=0;e<t.length;e++){let i=t[e].meta;"flight"===t[e].type&&i?.leg==="inbound"&&(a=e)}if(a>=0&&a!==t.length-1){let[e]=t.splice(a,1);t.push(e)}return t},[C]);(0,a.useEffect)(()=>{(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=await (0,$.getSavedTrips)(),t=e.length?e[0]:null;if(!t)return;let a="demo@calentrip.com"===(eq?.user?.email||"").toLowerCase(),i=(0,o.isTripPremium)(t.id)||a;e1(t.id),e8(t.savedCalendarName||""),e3(i);try{let e=localStorage.getItem("calentrip:premium"),t=(e?JSON.parse(e):[]).find(e=>"global"===e.tripId&&e.expiresAt>Date.now());if(t){let e=new Date(t.expiresAt),a=String(e.getDate()).padStart(2,"0"),i=String(e.getMonth()+1).padStart(2,"0");e5(`${a}/${i}`)}else e5("")}catch{e5("")}"authenticated"!==eK?eX({show:!0,reason:"anon",tripId:t.id}):i?eX(null):eX({show:!0,reason:"noPremium",tripId:t.id})}catch{}})()},[eK,eq]);let ty=(0,a.useMemo)(()=>{let e="",t=-1/0;return C.forEach(a=>{let i=a.meta;if("flight"===a.type&&i?.leg==="inbound"&&a.date&&a.time){let r=new Date(`${a.date}T${(a.time||"00:00").padStart(5,"0")}:00`).getTime();r>t&&(t=r,e=`${i.origin}|${i.destination}|${a.date}|${a.time||""}`)}}),e},[C]);function tb(){try{let e="undefined"!=typeof navigator&&navigator.userAgent||"";if(/Android/.test(e)){try{window.location.href="intent://com.android.providers.downloads.ui#Intent;scheme=content;end"}catch{}setTimeout(()=>{try{window.open("file:///storage/emulated/0/Download/","_blank")}catch{}},600),ea(eY("openingDownloadsFolderInfo"),{variant:"info"})}else ea(eY("openDownloadsTapIcsInfo"),{variant:"info"})}catch{}}async function tx(e){try{!function(e,t){try{let a=e?"":prompt("Nome do calendário (apenas letras, até 9)")||"",i=(t||a||"").replace(/[^A-Za-zÀ-ÖØ-öø-ÿ]/g,"").slice(0,9).trim();if(!i)try{let e=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),t=e?JSON.parse(e):null;if(t){let e="same"===t.mode,a=(e?t.origin:t.outbound?.origin)||"",r=(e?t.destination:t.outbound?.destination)||"";i=`${String(a)}${String(r)}`.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ]/g,"").toUpperCase().slice(0,9)||"CALENDAR"}else i="CALENDAR"}catch{i="CALENDAR"}let r=C;if(!r.length){let e=[];try{let t=(0,f.getTrips)(),a=new Set;t.forEach(t=>{(t.flightNotes||[]).forEach(t=>{let i="outbound"===t.leg?"Voo de ida":"Voo de volta",r=`${t.leg}|${t.origin}|${t.destination}|${t.date}`;if(!a.has(r)){a.add(r);let n=tl(t)||(t.departureTime||"").trim();e.push({type:"flight",label:`${i}: ${t.date} • ${n?`${n} • `:""}${t.origin} → ${t.destination}${t.flightNumber?` • ${t.flightNumber}`:""}`,date:t.date,time:n||void 0,meta:t})}})})}catch{}try{let t=localStorage.getItem("calentrip_trip_summary"),a=t?JSON.parse(t):null,i=Array.isArray(a?.cities)?a.cities:[];i.forEach((t,a)=>{let i=t.name||`Cidade ${a+1}`,r=t.address||"(endereço não informado)";if(t.checkin){let n=0===a?"23:59":"17:00";try{0===a&&"true"===localStorage.getItem("calentrip:arrivalNextDay_outbound")&&(n="14:00")}catch{}e.push({type:"stay",label:`Check-in hospedagem: ${i} • Endere\xe7o: ${r}`,date:t.checkin,time:n,meta:{city:i,address:r,kind:"checkin"}})}t.checkout&&e.push({type:"stay",label:`Checkout hospedagem: ${i} • Endere\xe7o: ${r}`,date:t.checkout,time:"08:00",meta:{city:i,address:r,kind:"checkout"}})});for(let t=0;t<i.length-1;t++){let a=i[t],r=i[t+1],n=a.transportToNext;if(n){let i=`${eY("transport")}: ${a.name||`${eY("cityGeneric")} ${t+1}`} → ${r?.name||`${eY("cityGeneric")} ${t+2}`} • ${(n.mode||"").toUpperCase()}`,o=a.checkout||r?.checkin||"",l=n.depTime||"11:00";e.push({type:"transport",label:i,date:o,time:l,meta:{...n,originAddress:a.address,originCity:a.name}})}}}catch{}try{let t=localStorage.getItem("calentrip:entertainment:records");((t?JSON.parse(t):[])||[]).forEach(t=>e.push({type:t.kind,label:"activity"===t.kind?`Atividade: ${t.title} (${t.cityName})`:`Restaurante: ${t.title} (${t.cityName})`,date:t.date,time:t.time,meta:t}))}catch{}let t=new Set,a=e.filter(e=>{let a="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!t.has(a)&&(t.add(a),!0)});a.length&&(r=a,I(a))}let n={name:i,events:r};localStorage.setItem("calentrip:saved_calendar",JSON.stringify(n));try{let e=localStorage.getItem("calentrip:saved_calendars_list"),t=e?JSON.parse(e):[],a={name:i,events:r,savedAt:new Date().toISOString()},n=t.findIndex(e=>(e?.name||"")===i);n>=0?t[n]=a:t.push(a),localStorage.setItem("calentrip:saved_calendars_list",JSON.stringify(t))}catch{}(async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let e=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),t=e?JSON.parse(e):null,a=e0;if(!a){let e=await (0,$.getSavedTrips)();if(t){let i,r="same"===t.mode,n=r?t.origin:t.outbound?.origin,o=r?t.destination:t.outbound?.destination,l=r?t.departDate:t.outbound?.date,s=(i=t.passengers||{},Number(i.adults||0)+Number(i.children||0)+Number(i.infants||0)),d=n&&o?`${n} → ${o}`:"",c=e.find(e=>e.title===d&&e.date===l&&Number(e.passengers||0)===s)||null;c&&(a=c.id)}if(!a&&t){let e,r="same"===t.mode,n=r?t.origin:t.outbound?.origin,o=r?t.destination:t.outbound?.destination,l=r?t.departDate:t.outbound?.date,s=(e=t.passengers||{},Number(e.adults||0)+Number(e.children||0)+Number(e.infants||0)),d=String(Date.now());await (0,$.addTrip)({id:d,title:`${n} → ${o}`,date:l,passengers:s,reachedFinalCalendar:!0,savedCalendarName:i}),e1(d),a=d}}if(a){let e=r.map(e=>({name:e.label||"Evento",label:e.label||void 0,date:e.date,time:e.time||void 0,type:e.type}));await (0,$.saveCalendarEvents)(a,e),await (0,$.updateTrip)(a,{reachedFinalCalendar:!0,savedCalendarName:i})}}catch{}})(),e||ea(eY("savedInSearchesMsg"),{variant:"success"})}catch{return ea(eY("saveErrorMsg"),{variant:"error"}),!1}}(!0,e)}catch{}let t="undefined"!=typeof navigator&&navigator.userAgent||"",a=/Android/.test(t);function i(e){let t=String(e.getFullYear()),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return`${t}${a}${i}T${r}${n}${o}`}function r(e){let t=String(e.getUTCFullYear()),a=String(e.getUTCMonth()+1).padStart(2,"0"),i=String(e.getUTCDate()).padStart(2,"0"),r=String(e.getUTCHours()).padStart(2,"0"),n=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0");return`${t}${a}${i}T${r}${n}${o}Z`}function n(e){return e.replace(/\\/g,"\\\\").replace(/\r?\n/g,"\\n").replace(/;/g,"\\;").replace(/,/g,"\\,")}function o(e,t=320){return e&&e.length>t?e.slice(0,t-1)+"…":e}async function l(e){let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null}async function s(){let e,t,a,i,r,n,o,s,d,c,m,u;if(!eT.length)return null;let p=(await (0,$.getSavedTrips)()).flatMap(e=>e.flightNotes||[]).filter(e=>"inbound"===e.leg&&e.origin&&e.date&&e.departureTime);if(!p.length)return null;let h=[...p].sort((e,t)=>new Date(`${e.date}T${(e.departureTime||"00:00").padStart(5,"0")}:00`).getTime()-new Date(`${t.date}T${(t.departureTime||"00:00").padStart(5,"0")}:00`).getTime()).slice(-1)[0],g=await (0,y.findAirportByIata)(h.origin),f=eT[eT.length-1];if(!f?.address)return null;let b=await l(f.address),x=await l(g?`${g.name} (${g.iata})`:`${h.origin} airport`);if(b&&x){try{let e=`https://router.project-osrm.org/route/v1/driving/${b.lon},${b.lat};${x.lon},${x.lat}?overview=false`,a=await fetch(e),i=await a.json(),n=i?.routes?.[0];n&&(t=Math.round((n.duration??0)/60),r=Math.round((n.distance??0)/1e3),c=Math.round(6*(r||0)+3))}catch{}try{let t=`https://router.project-osrm.org/route/v1/walking/${b.lon},${b.lat};${x.lon},${x.lat}?overview=false`,a=await fetch(t),i=await a.json(),r=i?.routes?.[0];r&&(e=Math.round((r.duration??0)/60))}catch{}let l=t?Math.round(1.3*t):void 0;if(a=l?Math.round(1.8*l):void 0,i=l?Math.round(1.2*l):void 0,n=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(f.address)}&destination=${encodeURIComponent(g?`${g.name} (${g.iata})`:`${h.origin} airport`)}`,o=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${x.lat}&dropoff[longitude]=${x.lon}&dropoff[formatted_address]=${encodeURIComponent(g?`${g.name} (${g.iata})`:`${h.origin} airport`)}`,h.departureTime&&h.date){let[e,a]=(h.departureTime||"00:00").split(":"),i=new Date(`${h.date}T${e.padStart(2,"0")}:${a.padStart(2,"0")}:00`),r=240+(l??t??60),n=new Date(i.getTime()-60*r*1e3),o=new Date(n.getTime()-72e5),c=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;s=c(n),d=`${o.toLocaleDateString()} ${c(o)}`,m=n.toISOString(),u=o.toISOString()}}return{airportName:g?`${g.name} (${g.iata})`:`${h.origin} airport`,distanceKm:r,walkingMin:e,drivingMin:t,busMin:a,trainMin:i,priceEstimate:c,gmapsUrl:n,uberUrl:o,callTime:s,notifyAt:d,callAtISO:m,notifyAtISO:u}}let d=(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"Etc/UTC"}catch{return"Etc/UTC"}})(),c=!a,m=[];if(m.push("BEGIN:VCALENDAR"),m.push("VERSION:2.0"),m.push("PRODID:-//CalenTrip//Calendar Export//PT"),m.push("CALSCALE:GREGORIAN"),m.push("METHOD:PUBLISH"),m.push("X-WR-CALNAME:CalenTrip"),c){m.push(`X-WR-TIMEZONE:${d}`);let e=-new Date().getTimezoneOffset(),t=Math.abs(e),a=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0"),r=`${e>=0?"+":"-"}${a}${i}`;m.push("BEGIN:VTIMEZONE"),m.push(`TZID:${d}`),m.push("BEGIN:STANDARD"),m.push("DTSTART:19700101T000000"),m.push(`TZOFFSETFROM:${r}`),m.push(`TZOFFSETTO:${r}`),m.push("END:STANDARD"),m.push("END:VTIMEZONE")}let u=await s();for(let e=0;e<C.length;e++){let t=C[e],l=function(e,t){let a=(t||"00:00").padStart(5,"0"),i=new Date(`${(e||"").replace(/\//g,"-")}T${a}:00`);return Number.isNaN(i.getTime())?null:i}(t.date,t.time),s=l?new Date(l.getTime()+36e5):null,p=t.label,h=o(t.label,a?64:120),g=a?function(e){try{return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g," ").replace(/\s+/g," ").trim()}catch{return e.replace(/[^\x20-\x7E]/g," ").replace(/\s+/g," ").trim()}}(h):h;m.push("BEGIN:VEVENT");let f=`ev-${e}-${l?i(l):String(Date.now())}@calentrip`;l&&m.push(c?`DTSTART;TZID=${d}:${i(l)}`:`DTSTART:${r(l)}`),s&&m.push(c?`DTEND;TZID=${d}:${i(s)}`:`DTEND:${r(s)}`),m.push(`DTSTAMP:${r(new Date)}`),m.push(`UID:${f}`),m.push(`SUMMARY:${n(g)}`),m.push("TRANSP:OPAQUE"),m.push("SEQUENCE:0"),m.push("STATUS:CONFIRMED");let $=null;if("stay"===t.type&&t.meta?.kind==="checkout"&&e===C.reduce((e,t,a)=>"stay"===t.type&&t.meta?.kind==="checkout"?a:e,-1)){let e=[];e.push(p),u?.airportName&&e.push(`Destino: ${u.airportName}`),u?.distanceKm!==void 0&&e.push(`Dist\xe2ncia: ${u.distanceKm} km`);let t=[];u?.walkingMin&&t.push(`A p\xe9: ${u.walkingMin} min`),u?.busMin&&t.push(`\xd4nibus: ${u.busMin} min (estimado)`),u?.trainMin&&t.push(`Trem/Metro: ${u.trainMin} min (estimado)`),u?.drivingMin!==void 0&&t.push(`Uber/T\xe1xi: ${u.drivingMin} min${void 0!==u.priceEstimate?` • R$${u.priceEstimate}`:""}`),t.length&&e.push(t.join(" | "));let a=u?.gmapsUrl||null,i=u?.uberUrl||null;a&&e.push(`Google Maps: ${a}`),i&&e.push(`Uber: ${i}`),u?.callTime&&e.push(`Chamar Uber \xe0s: ${u.callTime}`),u?.notifyAt&&e.push(`Notifica\xe7\xe3o programada: ${u.notifyAt}`);let r=o(e.join("\n"),480);if(m.push(`DESCRIPTION:${n(r)}`),u?.callAtISO){let e=new Date(u.callAtISO),t=new Date(e.getTime()+18e5);$={callAt:e,callEnd:t,callTime:u.callTime,uberUrl:u.uberUrl,gmapsUrl:u.gmapsUrl}}}else if("transport"===t.type&&l){let e=`${t.date}|${t.time||""}`,i=null;try{let t=localStorage.getItem("calentrip:transport_notify");i=(t?JSON.parse(t):{})[e]||null}catch{}let r=[o(p,a?160:280)];for(let e of(i?.callTime&&r.push(`Chamar Uber \xe0s: ${i.callTime}`),i?.notifyAt&&r.push(`Notifica\xe7\xe3o programada: ${i.notifyAt}`),i?.uberUrl&&r.push(`Uber: ${i.uberUrl}`),i?.gmapsUrl&&r.push(`Google Maps: ${i.gmapsUrl}`),m.push(`DESCRIPTION:${n(r.join("\n"))}`),(0,b.alarmForEvent)(t.type,!!(t.time&&t.time.trim()),l)))m.push(e);if(i?.callAtISO){let e=new Date(i.callAtISO),t=new Date(e.getTime()+18e5);$={callAt:e,callEnd:t,callTime:i.callTime,uberUrl:i.uberUrl,gmapsUrl:i.gmapsUrl}}}else{let e=o(p,a?160:280);for(let a of(m.push(`DESCRIPTION:${n(e)}`),(0,b.alarmForEvent)(t.type,!!(t.time&&t.time.trim()),l)))m.push(a)}if(m.push("END:VEVENT"),$){let{callAt:t,callEnd:a,callTime:l,uberUrl:s,gmapsUrl:u}=$;m.push("BEGIN:VEVENT");let p=`call-${e}-${i(t)}@calentrip`;c?(m.push(`DTSTART;TZID=${d}:${i(t)}`),m.push(`DTEND;TZID=${d}:${i(a)}`)):(m.push(`DTSTART:${r(t)}`),m.push(`DTEND:${r(a)}`)),m.push("SUMMARY:Chamar Uber"),m.push(`UID:${p}`),m.push(`DTSTAMP:${r(new Date)}`),m.push("STATUS:CONFIRMED"),m.push("TRANSP:OPAQUE"),m.push("SEQUENCE:0");let h=[`Chamar Uber \xe0s: ${l}`];s&&h.push(`Uber: ${s}`),u&&h.push(`Google Maps: ${u}`),m.push(`DESCRIPTION:${n(o(h.join("\n"),240))}`),m.push("BEGIN:VALARM"),m.push("ACTION:DISPLAY"),m.push("DESCRIPTION:Lembrete de transporte"),m.push("TRIGGER:-PT0M"),m.push("END:VALARM"),m.push("END:VEVENT")}}m.push("END:VCALENDAR");let p=m.map(function(e){if(e.length<=74)return e;let t=[];for(let a=0;a<e.length;a+=74)t.push(e.slice(a,a+74));return t.join("\r\n ")}).join("\r\n")+"\r\n",h=new Blob([p],{type:"text/calendar;charset=utf-8"}),g=new File([p],"calentrip.ics",{type:"text/calendar;charset=utf-8"});try{let e=navigator;if("function"==typeof e.share){await e.share({files:[g],title:"CalenTrip"});let t="undefined"!=typeof navigator&&navigator.userAgent||"",a=/iPad|iPhone|iPod/.test(t)||t.includes("Macintosh")&&"ontouchend"in window,i=/Android/.test(t);a?ea(eY("iosCalendarSentMsg"),{variant:"success"}):i?ea(eY("androidCalendarSentMsg"),{variant:"success"}):ea(eY("systemCalendarSentMsg"),{variant:"success"});return}}catch{}let x=URL.createObjectURL(h),v=document.createElement("a");v.href=x,v.download="calentrip.ics",document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(x);try{tb()}catch{}ea(eY("icsDownloadedAndroidHelp"),{variant:"info"})}async function tv(e){if("flight"!==e.type)return;let t=e.meta;if(t&&t.origin&&t.date){R({originIata:t.origin,departureDate:t.date,departureTime:t.departureTime||""}),U(!0),z(!0);try{let a,i,r,n,o,l,s=await (0,y.findAirportByIata)(t.origin),d=s?`${s.name} (${s.iata})`:`${t.origin} airport`,c=await new Promise(e=>{(navigator.geolocation||e(null),tf())?navigator.geolocation.getCurrentPosition(t=>e(t),()=>e(null),{enableHighAccuracy:!0,timeout:1e4}):e(null)}),m=async e=>{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon)}:null},u=await m(d);if(c&&u){let e={lat:c.coords.latitude,lon:c.coords.longitude},t=`https://router.project-osrm.org/route/v1/driving/${e.lon},${e.lat};${u.lon},${u.lat}?overview=false`,n=await fetch(t),o=await n.json(),l=o?.routes?.[0];l&&(a=Math.round((l.distance??0)/1e3),i=Math.round((l.duration??0)/60)),r=`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${e.lat}&pickup[longitude]=${e.lon}&dropoff[latitude]=${u.lat}&dropoff[longitude]=${u.lon}&dropoff[formatted_address]=${encodeURIComponent(d)}`}let p=c?`https://www.google.com/maps/dir/?api=1&origin=${c.coords.latitude}%2C${c.coords.longitude}&destination=${encodeURIComponent(d)}`:`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(d)}`,h=v({originName:c?`${c.coords.latitude},${c.coords.longitude}`:"my location",destName:d,originLat:c?.coords.latitude,originLon:c?.coords.longitude,destLat:u?.lat,destLon:u?.lon,date:t.date,time:t.departureTime,lang:"pt-BR",currency:"BRL"});!r&&u&&(r=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${u.lat}&dropoff[longitude]=${u.lon}&dropoff[formatted_address]=${encodeURIComponent(d)}`);let g=i?Math.round(1.3*i):void 0;if(t.departureTime&&t.date){let[a,s]=(t.departureTime||"00:00").split(":"),d=new Date(`${t.date}T${a.padStart(2,"0")}:${s.padStart(2,"0")}:00`),c=new Date(d.getTime()-108e5),m=(g??i??60)*6e4,u=new Date(c.getTime()-m),h=new Date(u.getTime()-72e5),f=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;l=f(c),n=f(u),o=`${h.toLocaleDateString()} ${f(h)}`;try{if("undefined"!=typeof Notification&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission)){let e=h.getTime()-Date.now();e>0&&e<31536e6&&setTimeout(()=>{new Notification("Lembrete de transporte",{body:`Chame o Uber \xe0s ${n}.`})},e)}}catch{}try{let t=`${e.date}|${e.time||""}`,a=localStorage.getItem("calentrip:transport_notify"),i=a?JSON.parse(a):{};i[t]={callTime:n,notifyAt:o,callAtISO:u.toISOString(),uberUrl:r,gmapsUrl:p},localStorage.setItem("calentrip:transport_notify",JSON.stringify(i))}catch{}}_({distanceKm:a,durationMin:i,durationWithTrafficMin:g,gmapsUrl:p,r2rUrl:h,uberUrl:r,airportName:d,arrivalByTime:l,callTime:n,notifyAt:o});try{let e=(0,f.getTrips)().find(e=>(e.flightNotes||[]).some(e=>"outbound"===e.leg&&e.origin===t.origin&&e.destination===t.destination&&e.date===t.date)),a=(e?.attachments||[]).filter(e=>(e.leg??"outbound")==="outbound");eD(a)}catch{}}catch{let e=M?.originIata?`${M.originIata} airport`:"aeroporto",t=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(e)}`;_({distanceKm:void 0,durationMin:void 0,durationWithTrafficMin:void 0,gmapsUrl:t,r2rUrl:v({originName:"Origem",destName:e,lang:"pt-BR",currency:"BRL"}),uberUrl:`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(e)}`,airportName:e});try{er("Não foi possível calcular a rota detalhada. Usando links básicos.",{variant:"info"})}catch{}}finally{z(!1)}}}async function tN(e){if("transport"!==e.type)return;let t=e.meta,a=(t.originAddress||"").trim(),i=(t.dep||"").trim();if(!a||!i){J(null),L(!0);return}L(!0),V(!0);try{let r,n,o,l,s,d,c,m,u,p=async e=>{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null},h=await p(a),g=i,f=null,$=(t.originCity||a.split(",")[0]||i).trim(),b=(h?.display||"").split(",").slice(-1)[0]?.trim()||"",x=b?`${$} ${b}`:$;if(!/[,\d]/.test(i)&&!/(rodovi|terminal|est(a|ã)\w+|bus|gare|station)/i.test(i)&&x)try{let e=async(e,t=8)=>{let a=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=${t}`,i=await fetch(a,{headers:{Accept:"application/json"}});return(await i.json()).map(e=>({name:e.display_name,lat:Number(e.lat),lon:Number(e.lon)}))},t=await e(`rodovi\xe1ria ${x}`,6),a=await e(`bus station ${x}`,6),i=await e(`esta\xe7\xe3o de trem ${x}`,8),r=await e(`train station ${x}`,8),n=await e(`gare ${x}`,8),o=(await (0,y.searchAirportsAsync)($)).filter(e=>e.city.toLowerCase()===$.toLowerCase()).slice(0,6),l={};o.forEach((e,t)=>{l[`${e.city} – ${e.name} (${e.iata})`]=t});let s=o.map(e=>`${e.city} – ${e.name} (${e.iata})`),d=[];for(let e of s)try{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=(await a.json())[0];i&&d.push({name:i.display_name,lat:Number(i.lat),lon:Number(i.lon),pref:l[e]??999})}catch{}d.sort((e,t)=>(e.pref??999)-(t.pref??999));let c=new Set,m=[...t,...a].map(e=>({...e,kind:"bus"})),u=[...i,...r,...n].map(e=>({...e,kind:"train"})),p=d.map(e=>({name:e.name,lat:e.lat,lon:e.lon,kind:"air"})),h=[];[...m,...u,...p].forEach(e=>{let t=`${Math.round(1e4*e.lat)}|${Math.round(1e4*e.lon)}`;c.has(t)||(c.add(t),h.push(e))});let b=$.toLowerCase(),v={"são paulo":["tietê","terminal tietê"],"sao paulo":["tiete","terminal tiete"],"rio de janeiro":["novo rio"],porto:["campo 24 de agosto"]},N={firenze:["santa maria novella","smn"],florence:["santa maria novella","smn"],roma:["termini"],rome:["termini"],milano:["centrale"],milan:["centrale","central"],venezia:["santa lucia"],venice:["santa lucia"],napoli:["centrale"],naples:["centrale"],torino:["porta nuova"],turin:["porta nuova"],bologna:["centrale"],pisa:["centrale"],paris:["gare du nord","gare de lyon"],berlin:["hauptbahnhof","hbf"],munich:["hauptbahnhof","hbf"],münchen:["hauptbahnhof","hbf"],madrid:["atocha"],barcelona:["sants"]},w=e=>{let t=(e||"").toLowerCase(),a=100;for(let e of(t.includes(b)&&(a-=10),/(termini)/.test(t)&&(a-=50),/(centrale|central|hauptbahnhof|hbf)/.test(t)&&(a-=40),/(santa maria novella|smn)/.test(t)&&(a-=45),/(gare du nord|gare de lyon)/.test(t)&&(a-=35),/(rodovi|terminal|gare routière|autostazione)/.test(t)&&(a-=10),/(stazione|station|gare)/.test(t)&&(a-=10),v[b]||[]))t.includes(e)&&(a-=40);for(let e of N[b]||[])t.includes(e)&&(a-=50);return a};if(h.sort((e,t)=>w(e.name)-w(t.name)),h.length){let e=h.slice(0,10);Z(e);let t=localStorage.getItem("calentrip:departure_point_selection"),a=t?JSON.parse(t):{},i=a[$]||a[x],r=i?e.findIndex(e=>.001>Math.abs(e.lat-i.lat)&&.001>Math.abs(e.lon-i.lon)):-1,n=r>=0?e[r]:e[0];g=n.name,f={lat:n.lat,lon:n.lon},K(r>=0?r:0)}}catch{}let v=f?{lat:f.lat,lon:f.lon,display:g}:await p(i+(t.originCity?` ${t.originCity}`:""));if(v){let e=await new Promise(e=>{try{if(!tf())return void e(null);navigator.geolocation.getCurrentPosition(t=>e(t),()=>e(null),{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4})}catch{e(null)}});if(e){let t={lat:e.coords.latitude,lon:e.coords.longitude},a=`https://router.project-osrm.org/route/v1/driving/${t.lon},${t.lat};${v.lon},${v.lat}?overview=false`,d=await fetch(a),c=await d.json(),m=c?.routes?.[0];m&&(r=Math.round((m.distance??0)/1e3),n=Math.round((m.duration??0)/60));try{let e=`https://router.project-osrm.org/route/v1/walking/${t.lon},${t.lat};${v.lon},${v.lat}?overview=false`,a=await fetch(e),i=await a.json(),r=i?.routes?.[0];r&&(o=Math.round((r.duration??0)/60))}catch{}l=`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${t.lat}&pickup[longitude]=${t.lon}&dropoff[latitude]=${v.lat}&dropoff[longitude]=${v.lon}&dropoff[formatted_address]=${encodeURIComponent(g||i)}`,s=`https://www.google.com/maps/dir/?api=1&origin=${t.lat}%2C${t.lon}&destination=${encodeURIComponent(g||i)}`}else l=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${v.lat}&dropoff[longitude]=${v.lon}&dropoff[formatted_address]=${encodeURIComponent(g||i)}`,s=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(g||i)}`;if(h&&v){let e=[Math.min(h.lon,v.lon),Math.min(h.lat,v.lat),Math.max(h.lon,v.lon),Math.max(h.lat,v.lat)];c=`https://www.openstreetmap.org/export/embed.html?bbox=${e.join("%2C")}&layer=mapnik`}d=`https://www.rome2rio.com/s/${encodeURIComponent(a)}/${encodeURIComponent(g||i)}`}s||(s=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(g||i)}`),d||(d=`https://www.rome2rio.com/s/${encodeURIComponent(a)}/${encodeURIComponent(g||i)}`),l||(l=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(g||i)}`);let N=n?Math.round(1.3*n):void 0,w=N?Math.round(1.8*N):void 0,S=N?Math.round(1.2*N):void 0;if(e.date&&e.time){let[t,a]=(e.time||"00:00").split(":"),i=new Date(`${e.date}T${t.padStart(2,"0")}:${a.padStart(2,"0")}:00`),r=((N??n??30)+60)*6e4,o=new Date(i.getTime()-r),l=new Date(o.getTime()),s=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;m=s(o),u=`${l.toLocaleDateString()} ${s(l)}`;try{if("undefined"!=typeof Notification&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission)){let e=l.getTime()-Date.now();e>0&&e<31536e6&&setTimeout(()=>{new Notification("Lembrete de transporte",{body:`Chame o Uber \xe0s ${m}.`})},e)}}catch{}}J({origin:a,destination:g||i,distanceKm:r,drivingMin:N??n,walkingMin:o,busMin:w,trainMin:S,uberUrl:l,gmapsUrl:s,r2rUrl:d,mapUrl:c,callTime:m,notifyAt:u})}catch{let e=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(a)}&destination=${encodeURIComponent(i)}`,t=`https://www.rome2rio.com/s/${encodeURIComponent(a)}/${encodeURIComponent(i)}`,r=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(i)}`;J({origin:a,destination:i,gmapsUrl:e,r2rUrl:t,uberUrl:r});try{ea(eY("routeDetailedErrorUsingBasicLinks"),{variant:"info"})}catch{}}finally{V(!1)}}async function tw(e){if("stay"!==e.type)return;let t=e.meta;if(!t||"checkin"!==t.kind)return;X(!0),et(null);let a=async e=>{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null},i=await a(t.address||t.city||"");if(!i){let e=(t.address||t.city||"").trim(),a=e?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`:void 0,i=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent((t.address||t.city||"").trim())}`;et({city:t.city,address:t.address,gmapsUrl:a,uberUrl:i});try{er("Destino não geocodificado. Usando busca genérica.",{variant:"info"})}catch{}return}try{let e,a,r,n,o,l,s,d=await new Promise(e=>{try{if(!tf())return void e(null);navigator.geolocation.getCurrentPosition(t=>e(t),()=>e(null),{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4})}catch{e(null)}});if(!d){let e=(t.address||t.city||"").trim(),a=e?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(e)}`:void 0,r=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${i.lat}&dropoff[longitude]=${i.lon}&dropoff[formatted_address]=${encodeURIComponent(e)}`;et({city:t.city,address:t.address,gmapsUrl:a,uberUrl:r});try{er("Sem localização atual. Links básicos foram gerados.",{variant:"info"})}catch{}return}let c={lat:d.coords.latitude,lon:d.coords.longitude},m=`https://router.project-osrm.org/route/v1/driving/${c.lon},${c.lat};${i.lon},${i.lat}?overview=false`,u=await fetch(m),p=await u.json(),h=p?.routes?.[0],g=h?Math.round((h.duration??0)/60):void 0,f=`https://router.project-osrm.org/route/v1/walking/${c.lon},${c.lat};${i.lon},${i.lat}?overview=false`;try{let t=await fetch(f),a=await t.json(),i=a?.routes?.[0];e=i?Math.round((i.duration??0)/60):void 0}catch{}let $=g?Math.round(1.3*g):void 0,y=$?Math.round(1.8*$):void 0,b=$?Math.round(1.2*$):void 0,x=`https://www.google.com/maps/dir/?api=1&origin=${c.lat}%2C${c.lon}&destination=${encodeURIComponent(t.address||t.city||"")}`,v=`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${c.lat}&pickup[longitude]=${c.lon}&dropoff[latitude]=${i.lat}&dropoff[longitude]=${i.lon}&dropoff[formatted_address]=${encodeURIComponent(t.address||t.city||"")}`,N=(r=(a=e=>e*Math.PI/180)(i.lat-c.lat),n=a(i.lon-c.lon),o=a(c.lat),l=a(i.lat),s=Math.sin(r/2)**2+Math.cos(o)*Math.cos(l)*Math.sin(n/2)**2,Math.round(12742*Math.asin(Math.sqrt(s)))),w=Math.round(6*(N||0)+3);et({city:t.city,address:t.address,distanceKm:N,walkingMin:e,drivingMin:$??g,busMin:y,trainMin:b,priceEstimate:w,uberUrl:v,gmapsUrl:x})}catch{let e=(t.address||t.city||"").trim(),a=e?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`:void 0,i=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(e)}`;et({city:t.city,address:t.address,gmapsUrl:a,uberUrl:i});try{er("Erro ao calcular rota. Usando links básicos.",{variant:"info"})}catch{}}}async function tS(e){if("activity"!==e.type&&"restaurant"!==e.type)return;let t=e.meta;eN(t),ef(!0),ey(!0);try{let e,a,i,r,n,o,l,s=async e=>{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null},d=`${t.address||`${t.title} ${t.cityName}`}`.trim(),c=await s(d),m=await new Promise(e=>{(navigator.geolocation||e(null),tf())?navigator.geolocation.getCurrentPosition(t=>e(t),()=>e(null),{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4}):e(null)});if(c&&m){let t={lat:m.coords.latitude,lon:m.coords.longitude},s=`https://router.project-osrm.org/route/v1/driving/${t.lon},${t.lat};${c.lon},${c.lat}?overview=false`,u=await fetch(s),p=await u.json(),h=p?.routes?.[0];h&&(a=Math.round((h.duration??0)/60),l=Math.round((h.distance??0)/1e3));try{let a=`https://router.project-osrm.org/route/v1/walking/${t.lon},${t.lat};${c.lon},${c.lat}?overview=false`,i=await fetch(a),r=await i.json(),n=r?.routes?.[0];n&&(e=Math.round((n.duration??0)/60))}catch{}let g=a?Math.round(1.3*a):void 0;n=g?Math.round(1.8*g):void 0,o=g?Math.round(1.2*g):void 0;let f=Math.round(6*(l||0)+3);i=`https://www.google.com/maps/dir/?api=1&origin=${t.lat}%2C${t.lon}&destination=${encodeURIComponent(d)}`,r=`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${t.lat}&pickup[longitude]=${t.lon}&dropoff[latitude]=${c.lat}&dropoff[longitude]=${c.lon}&dropoff[formatted_address]=${encodeURIComponent(d)}`,ex({destination:d,distanceKm:l,walkingMin:e,drivingMin:g??a,busMin:n,trainMin:o,priceEstimate:f,uberUrl:r,gmapsUrl:i})}else if(c&&!m){i=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(d)}`,r=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${c.lat}&dropoff[longitude]=${c.lon}&dropoff[formatted_address]=${encodeURIComponent(d)}`,ex({destination:d,gmapsUrl:i,uberUrl:r});try{ea(eY("noCurrentLocationUsingBasicLinks"),{variant:"info"})}catch{}}else{i=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(d)}`,r=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(d)}`,ex({destination:d,gmapsUrl:i,uberUrl:r});try{ea(eY("destNotGeocodedGenericSearch"),{variant:"info"})}catch{}}}catch{let e=`${t.title} ${t.cityName}`.trim(),a=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e)}`,i=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(e)}`;ex({destination:e,gmapsUrl:a,uberUrl:i});try{er("Erro ao calcular rota. Usando links básicos.",{variant:"info"})}catch{}}finally{ey(!1)}}return(0,a.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("calentrip:saved_calendar");if(e)try{let t=JSON.parse(e);if(t?.events&&t.events.length){let e=t.events;I(t=>{let a=new Set;return[...t,...e].filter(e=>{let t=`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!a.has(t)&&(a.add(t),!0)})})}}catch{}let t=await (0,$.getSavedTrips)(),a=[],i=null;try{let e=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch");if(i=e?JSON.parse(e):null){let e,r="same"===i.mode,n=r?i.origin:i.outbound?.origin,o=r?i.destination:i.outbound?.destination,l=r?i.departDate:i.outbound?.date,s=(e=i.passengers||{},Number(e.adults||0)+Number(e.children||0)+Number(e.infants||0)),d=n&&o?`${n} → ${o}`:"",c=t.findIndex(e=>e.title===d&&e.date===l&&e.passengers===s);c>=0&&(a=[t[c]])}}catch{}if(!a.length){let e=t.filter(e=>e.reachedFinalCalendar);a=e.length?[e[e.length-1]]:t.length?[t[t.length-1]]:[]}let r=[],n=new Set;if(a.forEach(e=>{e.flightNotes&&e.flightNotes.length&&e.flightNotes.forEach(e=>{let t="outbound"===e.leg?"Voo de ida":"Voo de volta",a=`${e.leg}|${e.origin}|${e.destination}|${e.date}`;n.has(a)||(n.add(a),r.push({type:"flight",label:`${t}: ${e.date} • ${(e.departureTime||"").trim()}${e.arrivalTime?` → ${e.arrivalTime}${e.arrivalNextDay?" (+1d)":""}`:""} • ${e.origin} → ${e.destination}${e.flightNumber?` • ${e.flightNumber}`:""}`,date:e.date,time:e.departureTime||void 0,meta:e}))})}),!r.some(e=>"flight"===e.type)&&i){if("same"===i.mode){let e=i.origin?.trim(),t=i.destination?.trim(),a=i.departDate?.trim(),n=i.returnDate?.trim();e&&t&&a&&r.push({type:"flight",label:`Voo de ida: ${e} → ${t}${i.departFlightNumber?` • ${i.departFlightNumber}`:""}`,date:a,time:i.departTime||void 0,meta:{leg:"outbound",origin:e,destination:t,date:a,departureTime:i.departTime||void 0,flightNumber:i.departFlightNumber||void 0}}),e&&t&&n&&r.push({type:"flight",label:`Voo de volta: ${t} → ${e}${i.returnFlightNumber?` • ${i.returnFlightNumber}`:""}`,date:n,time:i.returnTime||void 0,meta:{leg:"inbound",origin:t,destination:e,date:n,departureTime:i.returnTime||void 0,flightNumber:i.returnFlightNumber||void 0}})}else if(i?.outbound&&i?.inbound){let e=i.outbound,t=i.inbound;e?.origin&&e?.destination&&e?.date&&r.push({type:"flight",label:`Voo de ida: ${e.origin} → ${e.destination}${e.flightNumber?` • ${e.flightNumber}`:""}`,date:e.date,time:e.time||void 0,meta:{leg:"outbound",origin:e.origin,destination:e.destination,date:e.date,departureTime:e.time||void 0,flightNumber:e.flightNumber||void 0}}),t?.origin&&t?.destination&&t?.date&&r.push({type:"flight",label:`Voo de volta: ${t.origin} → ${t.destination}${t.flightNumber?` • ${t.flightNumber}`:""}`,date:t.date,time:t.time||void 0,meta:{leg:"inbound",origin:t.origin,destination:t.destination,date:t.date,departureTime:t.time||void 0,flightNumber:t.flightNumber||void 0}})}}let o=localStorage.getItem("calentrip_trip_summary"),l=o?JSON.parse(o):null,s=Array.isArray(l?.cities)?l.cities:[];eC(s),s.forEach((e,t)=>{let a=e.name||`Cidade ${t+1}`,i=e.address||"(endereço não informado)";e.checkin&&r.push({type:"stay",label:`Check-in hospedagem: ${a} • Endere\xe7o: ${i}`,date:e.checkin,time:"14:00",meta:{city:a,address:i,kind:"checkin"}}),e.checkout&&r.push({type:"stay",label:`Checkout hospedagem: ${a} • Endere\xe7o: ${i}`,date:e.checkout,time:"11:00",meta:{city:a,address:i,kind:"checkout"}})});for(let e=0;e<s.length-1;e++){let t=s[e],a=s[e+1],i=t.transportToNext;if(i){let n=`${eY("transport")}: ${t.name||`${eY("cityGeneric")} ${e+1}`} → ${a?.name||`${eY("cityGeneric")} ${e+2}`} • ${(i.mode||"").toUpperCase()}`,o=t.checkout||a?.checkin||"",l=i.depTime||"11:00";r.push({type:"transport",label:n,date:o,time:l,meta:{...i,originAddress:t.address,originCity:t.name}})}}let d=localStorage.getItem("calentrip:entertainment:records");((d?JSON.parse(d):[])||[]).forEach(e=>r.push({type:e.kind,label:"activity"===e.kind?`Atividade: ${e.title} (${e.cityName})`:`Restaurante: ${e.title} (${e.cityName})`,date:e.date,time:e.time,meta:e}));let c=new Set,m=r.filter(e=>{let t="stay"===e.type?`${e.type}|${e.label}|${(e.date||"").trim()}`:`${e.type}|${e.label}|${(e.date||"").trim()}|${(e.time||"").trim()}`;return!c.has(t)&&(c.add(t),!0)});D||I(m)}catch{}})()},[D,eY]),(0,a.useEffect)(()=>{let e=C.filter(e=>{if("stay"!==e.type)return!1;let t=e.meta;return t?.kind==="checkin"});if(!e.length)return;let t=async e=>{let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null},a=async()=>"undefined"!=typeof Notification&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission);return e.forEach(async e=>{let i=e.meta,r=i?.city||"",n=i?.address||"",o=`${r}-${n}`;if(W.current[o])return;let l=await t(n||r);if(!l)return;let s=await a();if(!tf())return;let d=navigator.geolocation.watchPosition(async e=>{let t,a,i,d={lat:e.coords.latitude,lon:e.coords.longitude},c=(a=(t=e=>e*Math.PI/180)(l.lat-d.lat),i=t(l.lon-d.lon),12742*Math.asin(Math.sqrt(Math.sin(a/2)**2+Math.cos(t(d.lat))*Math.cos(t(l.lat))*Math.sin(i/2)**2)));if(c<=3&&!Y.current[o]){if(Y.current[o]=!0,s){try{new Notification(`Bem-vindo(a) a ${r}`,{body:`Voc\xea est\xe1 a ~${Math.round(c)} km do destino.`})}catch{}try{ea(`Bem-vindo(a) a ${r}`,{variant:"success"})}catch{}}setTimeout(async()=>{try{let e,t=`https://router.project-osrm.org/route/v1/driving/${d.lon},${d.lat};${l.lon},${l.lat}?overview=false`,a=await fetch(t),i=await a.json(),o=i?.routes?.[0],m=o?Math.round((o.duration??0)/60):void 0,u=`https://router.project-osrm.org/route/v1/walking/${d.lon},${d.lat};${l.lon},${l.lat}?overview=false`;try{let t=await fetch(u),a=await t.json(),i=a?.routes?.[0];e=i?Math.round((i.duration??0)/60):void 0}catch{}let p=m?Math.round(1.3*m):void 0,h=p?Math.round(1.8*p):void 0,g=p?Math.round(1.2*p):void 0,f=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${l.lat}&dropoff[longitude]=${l.lon}&dropoff[formatted_address]=${encodeURIComponent(n||r)}`,$=`https://www.google.com/maps/dir/?api=1&origin=${d.lat}%2C${d.lon}&destination=${encodeURIComponent(n||r)}`;if(s){let t=[`Dist\xe2ncia: ${Math.round(c)} km`,`A p\xe9: ${e?`${e} min`:"—"}`,`\xd4nibus: ${h?`${h} min`:"—"}`,`Trem/Metro: ${g?`${g} min`:"—"}`,`Uber/T\xe1xi: ${p??m??"—"} min • R$${Math.round(6*(c||0)+3)}`,`Uber: ${f}`,`Maps: ${$}`];try{new Notification(`Op\xe7\xf5es de deslocamento at\xe9 a hospedagem`,{body:t.join("\n")})}catch{}try{eU.current.arrival||(er("Opções de deslocamento disponíveis",{variant:"info"}),eU.current.arrival=!0)}catch{}}et({city:r,address:n||r,distanceKm:Math.round(c),walkingMin:e,drivingMin:p??m,busMin:h,trainMin:g,uberUrl:f,gmapsUrl:$}),X(!0)}catch{}},6e4)}},()=>{},{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4});W.current[o]=d}),()=>{Object.values(W.current).forEach(e=>{try{navigator.geolocation.clearWatch(e)}catch{}}),W.current={}}},[C,tf,ea,er]),(0,t.jsxs)("div",{className:"min-h-screen pl-14 pr-4 py-6 space-y-6",children:[el?(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl p-5 space-y-3",children:[(0,t.jsx)(m.DialogHeader,{children:"Permitir localização"}),(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:"A localização é usada para estimar rotas, tempo e opções de transporte até sua hospedagem e aeroporto."}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>{try{localStorage.setItem("calentrip:locConsent","skipped")}catch{}eo("skipped"),es(!1)},children:"Pular"}),(0,t.jsx)(s.Button,{type:"button",onClick:()=>{try{if(!navigator.geolocation){try{localStorage.setItem("calentrip:locConsent","denied")}catch{}eo("denied"),es(!1);return}navigator.geolocation.getCurrentPosition(()=>{try{localStorage.setItem("calentrip:locConsent","granted")}catch{}eo("granted"),es(!1)},()=>{try{localStorage.setItem("calentrip:locConsent","denied")}catch{}eo("denied"),es(!1)},{enableHighAccuracy:!0,timeout:1e4})}catch{try{localStorage.setItem("calentrip:locConsent","denied")}catch{}eo("denied"),es(!1)}},children:"Ativar localização"})]})]})}):null,eQ?.show?(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl p-5 space-y-3",children:[(0,t.jsx)(m.DialogHeader,{children:"anon"===eQ.reason?eY("loginUnlockTitle"):eY("subscriptionNeededTitle")}),(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:"anon"===eQ.reason?(0,t.jsx)("div",{children:eY("loginUnlockText")}):(0,t.jsx)("div",{children:eY("subMonthlyText")})}),(0,t.jsx)("div",{className:"flex gap-2 mt-2",children:"anon"===eQ.reason?(0,t.jsx)(s.Button,{type:"button",onClick:()=>(0,i.signIn)("google"),children:eY("signInWithGoogle")}):(0,t.jsx)(s.Button,{type:"button",onClick:async()=>{try{if(!eQ?.tripId)return;let t=eq?.user?.email||eq?.user?.name||void 0,a=await e.A(50131),i=await a.completePurchaseForTrip(eQ.tripId,t);if(i?.ok)e3(!0),eX(null),ea(eY("purchaseSuccess"),{variant:"success"});else{let e=i?.error==="billing"?"Disponível no app Android. Instale via Google Play.":i?.error==="product"?"Produto não encontrado no Google Play.":i?.error==="purchase"?"Compra cancelada ou falhou.":i?.error==="token"?"Token de compra não recebido.":i?.error==="verify"?"Falha ao verificar a compra.":i?.error==="ack"?"Falha ao confirmar a compra.":i?.error==="store"?"Falha ao salvar assinatura.":"Falha na compra";if(ea(e,{variant:"error"}),i?.error==="billing")try{window.location.href="/profile"}catch{}}}catch{ea(eY("purchaseError"),{variant:"error"})}},children:eY("subscribeMonthlyButton")})})]})}):null,(0,t.jsxs)("div",{className:eM?"fixed left-0 top-0 bottom-0 z-40 w-56 border-r border-zinc-200 bg-white dark:border-zinc-800 dark:bg-black transition-all":"fixed left-0 top-0 bottom-0 z-40 w-14 border-r border-zinc-200 bg-white dark:border-zinc-800 dark:bg-black transition-all",children:[(0,t.jsxs)("div",{className:"h-14 flex items-center justify-center border-b border-zinc-200 dark:border-zinc-800",children:[(0,t.jsx)("button",{type:"button",className:"rounded-md p-2",onClick:()=>eR(e=>!e),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[24px]",children:"menu"})}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:tc,children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"refresh"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:"Recarregar do storage"}):null]})]}),(0,t.jsxs)("div",{className:"p-2 space-y-2",children:[(0,t.jsx)("div",{className:"rounded-md border border-zinc-200 dark:border-zinc-800 p-2",children:"authenticated"===eK?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[eq?.user?.image?(0,t.jsx)(r.default,{src:eq.user.image,alt:"avatar",width:32,height:32,className:"h-8 w-8 rounded-full object-cover"}):(0,t.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black text-xs",children:(eq?.user?.name||eq?.user?.email||"PF").slice(0,2).toUpperCase()}),eM?(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:eq?.user?.name||"Usuário"}),(0,t.jsx)("div",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:eq?.user?.email||""}),(0,t.jsxs)("div",{className:"mt-1 text-[10px] text-zinc-500",children:["Idioma: ",eW.toUpperCase()]}),(0,t.jsxs)("div",{className:"mt-1 text-[10px] text-zinc-500",children:[eY("planWord"),": ",e2?`${eY("premiumWord")}${e6?` ${eY("untilWord")} ${e6}`:""}`:eY("freeWord")]}),!e2&&e0?(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(s.Button,{type:"button",onClick:async()=>{try{let t=eq?.user?.email||eq?.user?.name||void 0,a=await e.A(50131),i=await a.completePurchaseForTrip(e0,t);i?.ok?(e3(!0),ea(eY("purchaseSuccess"),{variant:"success"})):ea(eY("purchaseFail"),{variant:"error"})}catch{ea(eY("purchaseError"),{variant:"error"})}},children:eY("activatePremiumButton")})}):null,(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"underline text-xs",onClick:()=>{try{window.location.href="/profile"}catch{}},children:eY("viewProfile")}),(0,t.jsx)("button",{type:"button",className:"text-xs",onClick:()=>(0,i.signOut)(),children:eY("signOut")})]})]}):null]}):(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black text-xs",children:"PF"}),eM?(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Entrar"}),(0,t.jsxs)("div",{className:"mt-1 text-[10px] text-zinc-500",children:["Idioma: ",eW.toUpperCase()]}),(0,t.jsx)("div",{className:"mt-2 flex items-center gap-2",children:(0,t.jsx)("button",{type:"button",className:"text-xs",onClick:()=>(0,i.signIn)("google",{callbackUrl:"/profile",redirect:!0}),children:"Google"})})]}):null]})}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{try{localStorage.removeItem("calentrip_trip_summary"),localStorage.removeItem("calentrip:entertainment:records"),localStorage.removeItem("calentrip:tripSearch"),localStorage.removeItem("calentrip:arrivalNextDay_outbound"),localStorage.removeItem("calentrip:arrivalNextDay_inbound"),I([])}catch{}try{window.location.href="/flights/search"}catch{}},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"travel_explore"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:"Iniciar nova pesquisa"}):null]}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{try{let e=(0,f.getTrips)();eL(e)}catch{eL([])}try{let e=localStorage.getItem("calentrip:saved_calendars_list"),t=e?JSON.parse(e):[];eV(t)}catch{eV([])}ez(!0)},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"lists"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:"Pesquisas salvas"}):null]}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{try{window.location.href="/calendar/final"}catch{}},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"list_alt"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:"Calendário em lista"}):null]}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{ek(""),eS(!0)},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"bookmark_add"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:eY("saveCalendarButton")}):null]}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{let e=encodeURIComponent("Calendário da viagem"),t=encodeURIComponent(C.map(e=>`${e.date} ${e.time||""} • ${e.label}`).join("\n")),a=document.createElement("a");a.href=`mailto:?subject=${e}&body=${t}`,a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),ea(eY("openingEmailMsg"),{variant:"info"})},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px] text-[#007AFF]",children:"mail"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:"Enviar por e-mail"}):null]}),!1,(0,t.jsx)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:async()=>{function e(e){let t=String(e.getFullYear()),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}${a}${i}T${r}${n}00`}function t(e){let t=String(e.getUTCFullYear()),a=String(e.getUTCMonth()+1).padStart(2,"0"),i=String(e.getUTCDate()).padStart(2,"0"),r=String(e.getUTCHours()).padStart(2,"0"),n=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0");return`${t}${a}${i}T${r}${n}${o}Z`}function a(e,t){let a=(t||"00:00").padStart(5,"0"),i=new Date(`${(e||"").replace(/\//g,"-")}T${a}:00`);return Number.isNaN(i.getTime())?null:i}async function i(e){let t=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1`,a=await fetch(t,{headers:{Accept:"application/json"}}),i=await a.json();return i[0]?{lat:Number(i[0].lat),lon:Number(i[0].lon),display:i[0].display_name}:null}async function r(){let e,t,a,r,n,o,l,s,d,c,m,u;if(!eT.length)return null;let p=(0,f.getTrips)().flatMap(e=>e.flightNotes||[]).filter(e=>"inbound"===e.leg&&e.origin&&e.date&&e.departureTime);if(!p.length)return null;let h=[...p].sort((e,t)=>new Date(`${e.date}T${(e.departureTime||"00:00").padStart(5,"0")}:00`).getTime()-new Date(`${t.date}T${(t.departureTime||"00:00").padStart(5,"0")}:00`).getTime()).slice(-1)[0],g=await (0,y.findAirportByIata)(h.origin),$=eT[eT.length-1];if(!$?.address)return null;let b=await i($.address),x=await i(g?`${g.name} (${g.iata})`:`${h.origin} airport`);if(b&&x){let i=`https://router.project-osrm.org/route/v1/driving/${b.lon},${b.lat};${x.lon},${x.lat}?overview=false`;try{let e=await fetch(i),a=await e.json(),r=a?.routes?.[0];r&&(t=Math.round((r.duration??0)/60),n=Math.round((r.distance??0)/1e3),c=Math.round(6*(n||0)+3))}catch{}try{let t=`https://router.project-osrm.org/route/v1/walking/${b.lon},${b.lat};${x.lon},${x.lat}?overview=false`,a=await fetch(t),i=await a.json(),r=i?.routes?.[0];r&&(e=Math.round((r.duration??0)/60))}catch{}let m=t?Math.round(1.3*t):void 0;if(a=m?Math.round(1.8*m):void 0,r=m?Math.round(1.2*m):void 0,o=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent($.address)}&destination=${encodeURIComponent(g?`${g.name} (${g.iata})`:`${h.origin} airport`)}`,l=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${x.lat}&dropoff[longitude]=${x.lon}&dropoff[formatted_address]=${encodeURIComponent(g?`${g.name} (${g.iata})`:`${h.origin} airport`)}`,h.departureTime&&h.date){let[e,a]=(h.departureTime||"00:00").split(":"),i=new Date(`${h.date}T${e.padStart(2,"0")}:${a.padStart(2,"0")}:00`),r=240+(m??t??60),n=new Date(i.getTime()-60*r*1e3),o=new Date(n.getTime()-72e5),l=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;s=l(n),d=`${o.toLocaleDateString()} ${l(o)}`;try{if("undefined"!=typeof Notification&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission)){let e=o.getTime()-Date.now();e>0&&e<31536e6&&setTimeout(()=>{try{new Notification("Lembrete de transporte",{body:`Chame o Uber \xe0s ${s}.`})}catch{}},e)}}catch{}}}return{airportName:g?`${g.name} (${g.iata})`:`${h.origin} airport`,distanceKm:n,walkingMin:e,drivingMin:t,busMin:a,trainMin:r,priceEstimate:c,gmapsUrl:o,uberUrl:l,callTime:s,notifyAt:d,callAtISO:m,notifyAtISO:u}}let n=[],o="undefined"!=typeof navigator&&navigator.userAgent||"",l=/Android/.test(o);n.push("BEGIN:VCALENDAR"),n.push("VERSION:2.0"),n.push("PRODID:-//CalenTrip//Calendar Export//PT"),n.push("CALSCALE:GREGORIAN"),n.push("METHOD:PUBLISH"),n.push("X-WR-CALNAME:CalenTrip");let s=(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"Etc/UTC"}catch{return"Etc/UTC"}})();if(!/Android/.test("undefined"!=typeof navigator&&navigator.userAgent||"")){n.push(`X-WR-TIMEZONE:${s}`);let e=-new Date().getTimezoneOffset(),t=Math.abs(e),a=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0"),r=`${e>=0?"+":"-"}${a}${i}`;n.push("BEGIN:VTIMEZONE"),n.push(`TZID:${s}`),n.push("BEGIN:STANDARD"),n.push("DTSTART:19700101T000000"),n.push(`TZOFFSETFROM:${r}`),n.push(`TZOFFSETTO:${r}`),n.push("END:STANDARD"),n.push("END:VTIMEZONE")}function d(e){return e.replace(/\\/g,"\\\\").replace(/\r?\n/g,"\\n").replace(/;/g,"\\;").replace(/,/g,"\\,")}function c(e){try{return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g," ").replace(/\s+/g," ").trim()}catch{return e.replace(/[^\x20-\x7E]/g," ").replace(/\s+/g," ").trim()}}function m(e,t=320){return e&&e.length>t?e.slice(0,t-1)+"…":e}function u(e){if(e.length<=74)return e;let t=[];for(let a=0;a<e.length;a+=74)t.push(e.slice(a,a+74));return t.join("\r\n ")}let p=await r(),$=!l;if(g()){let e=C.map(e=>{let t=a(e.date,e.time),i=t?new Date(t.getTime()+36e5):null;return{startISO:t?t.toISOString():new Date().toISOString(),endISO:i?i.toISOString():void 0,title:e.label,description:e.label}});try{let t=await h.requestPermissions();if(t?.granted){let t=await h.addEvents({events:e});if(t.ok&&t.added>0)return void ea(eY("eventsAddedToCalendarMsg"),{variant:"success"})}}catch{}}C.forEach((i,r)=>{let o=a(i.date,i.time),u=o?new Date(o.getTime()+36e5):null;if("flight"===i.type){let e=i.meta;if(e&&(o=a(e.date,e.departureTime||i.time),e.arrivalTime)){let t=a(e.date,e.arrivalTime);if(t){let a=864e5*!!e.arrivalNextDay;u=new Date(t.getTime()+a)}}}let h=i.label;n.push("BEGIN:VEVENT");let g=`ev-${r}-${o?e(o):String(Date.now())}@calentrip`,f=l?m(i.label,64):m(i.label,120),y=l?c(f):f;o&&n.push($?`DTSTART;TZID=${s}:${e(o)}`:`DTSTART:${t(o)}`),u&&n.push($?`DTEND;TZID=${s}:${e(u)}`:`DTEND:${t(u)}`),n.push(`DTSTAMP:${t(new Date)}`),n.push(`UID:${g}`),n.push(`SUMMARY:${d(y)}`);let b=null;if("flight"===i.type){let e=i.meta;e?.leg==="outbound"&&(b=`${e?.origin||""} airport`)}else if("transport"===i.type){let e=i.meta,t=(e?.originAddress||"").trim(),a=(e?.dep||"").trim();(t||a)&&(b=`${t||""}${t||a?" → ":""}${a||""}`.trim())}else if("stay"===i.type){let e=i.meta;e?.kind==="checkin"&&(b=(e.address||e.city||"").trim())}else if("activity"===i.type||"restaurant"===i.type){let e=i.meta;b=`${e?.title||""} ${e?.cityName||""}`.trim()}b&&n.push(`LOCATION:${d(b)}`),n.push("TRANSP:OPAQUE"),n.push("SEQUENCE:0"),n.push("STATUS:CONFIRMED");let x=null;if("stay"!==i.type||i.meta?.kind!=="checkout"||r!==C.reduce((e,t,a)=>"stay"===t.type&&t.meta?.kind==="checkout"?a:e,-1)){if(1){let e=[];if(e.push(h),"flight"===i.type){let t=i.meta,a=(t?.departureTime||i.time||"").trim(),r=(t?.arrivalTime||"").trim(),n=t?.arrivalNextDay?" (+1d)":"";if(e.push(`Voo: ${t?.origin||""} → ${t?.destination||""}`),a&&e.push(`Partida: ${a}`),r&&e.push(`Chegada: ${r}${n}`),t?.flightNumber&&e.push(`N\xfamero/Localizador: ${t.flightNumber}`),t?.leg==="outbound"){let a=`${t?.origin||""} airport`,i=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(a)}`,r=v({originName:"my location",destName:a,lang:"pt-BR",currency:"BRL"});e.push(`Destino: ${a}`),e.push(`Google Maps: ${i}`),e.push(`Rome2Rio: ${r}`),e.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location"),e.push("Chegar no aeroporto: 3h antes do voo.")}}else if("transport"===i.type){let t=i.meta,a=(t?.originAddress||"").trim(),r=(t?.dep||"").trim();if(a||r){let t=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(a)}&destination=${encodeURIComponent(r)}`,i=v({originName:a,destName:r,lang:"pt-BR",currency:"BRL"});e.push(`Origem: ${a||"—"}`),e.push(`Destino: ${r||"—"}`),e.push(`Google Maps: ${t}`),e.push(`Rome2Rio: ${i}`),e.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}}else if("stay"===i.type){let t=i.meta;if(t?.kind==="checkin"){let a=(t.address||t.city||"").trim(),i=a?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(a)}`:"";e.push(`Destino: ${a||"—"}`),i&&e.push(`Google Maps: ${i}`),e.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}}else if("activity"===i.type||"restaurant"===i.type){let t=i.meta,a=`${t?.title||""} ${t?.cityName||""}`.trim(),r=a?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(a)}`:"";e.push(`Destino: ${a||"—"}`),r&&e.push(`Google Maps: ${r}`),e.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}let t=l?m(e.join("\n"),320):m(e.join("\n"),600);n.push(`DESCRIPTION:${d(t)}`)}}else{let e=[];e.push(h),p?.airportName&&e.push(`Destino: ${p.airportName}`),p?.distanceKm!==void 0&&e.push(`Dist\xe2ncia: ${p.distanceKm} km`);let t=[];p?.walkingMin&&t.push(`A p\xe9: ${p.walkingMin} min`),p?.busMin&&t.push(`\xd4nibus: ${p.busMin} min (estimado)`),p?.trainMin&&t.push(`Trem/Metro: ${p.trainMin} min (estimado)`),p?.drivingMin!==void 0&&t.push(`Uber/T\xe1xi: ${p.drivingMin} min${void 0!==p.priceEstimate?` • R$${p.priceEstimate}`:""}`),t.length&&e.push(t.join(" | "));let a=p?.gmapsUrl||null,i=p?.uberUrl||null;{a&&e.push(`Google Maps: ${a}`),i&&e.push(`Uber: ${i}`),p?.callTime&&e.push(`Chamar Uber \xe0s: ${p.callTime}`),p?.notifyAt&&e.push(`Notifica\xe7\xe3o programada: ${p.notifyAt}`);let t=m(e.join("\n"),480);n.push(`DESCRIPTION:${d(t)}`)}if(p?.callAtISO){let e=new Date(p.callAtISO),t=new Date(e.getTime()+18e5);x={callAt:e,callEnd:t,callTime:p.callTime,uberUrl:p.uberUrl,gmapsUrl:p.gmapsUrl}}}if(l||("flight"===i.type?(n.push("BEGIN:VALARM"),n.push("ACTION:DISPLAY"),n.push("DESCRIPTION:Lembrete do voo"),n.push("TRIGGER:-P1D"),n.push("END:VALARM"),n.push("BEGIN:VALARM"),n.push("ACTION:DISPLAY"),n.push("DESCRIPTION:Lembrete do voo"),n.push("TRIGGER:-PT60M"),n.push("END:VALARM")):("activity"===i.type||"restaurant"===i.type)&&(n.push("BEGIN:VALARM"),n.push("ACTION:DISPLAY"),n.push("DESCRIPTION:Lembrete do evento"),n.push("TRIGGER:-PT60M"),n.push("END:VALARM"))),n.push("END:VEVENT"),x){let{callAt:a,callEnd:i,callTime:o,uberUrl:c,gmapsUrl:u}=x;n.push("BEGIN:VEVENT");let p=`call-${r}-${e(a)}@calentrip`;$?(n.push(`DTSTART;TZID=${s}:${e(a)}`),n.push(`DTEND;TZID=${s}:${e(i)}`)):(n.push(`DTSTART:${t(a)}`),n.push(`DTEND:${t(i)}`)),n.push("SUMMARY:Chamar Uber"),n.push(`UID:${p}`),n.push(`DTSTAMP:${t(new Date)}`),n.push("STATUS:CONFIRMED"),n.push("TRANSP:OPAQUE"),n.push("SEQUENCE:0");{let e=[`Chamar Uber \xe0s: ${o}`];c&&e.push(`Uber: ${c}`),u&&e.push(`Google Maps: ${u}`),n.push(`DESCRIPTION:${d(m(e.join("\n"),240))}`)}l||(n.push("BEGIN:VALARM"),n.push("ACTION:DISPLAY"),n.push("DESCRIPTION:Lembrete de transporte"),n.push("TRIGGER:-PT120M"),n.push("END:VALARM")),n.push("END:VEVENT")}}),n.push("END:VCALENDAR");let b=n.map(u).join("\r\n")+"\r\n",x=new Blob([b],{type:"text/calendar;charset=utf-8"}),N=new File([b],"calentrip.ics",{type:"text/calendar;charset=utf-8"});async function w(){return C.map((i,r)=>{let n=a(i.date,i.time),o=n?new Date(n.getTime()+36e5):null,p=l?m(i.label,64):m(i.label,120),h=l?c(p):p,g=[];g.push("BEGIN:VCALENDAR"),g.push("VERSION:2.0"),g.push("PRODID:-//CalenTrip//Calendar Export//PT"),g.push("BEGIN:VEVENT"),n&&g.push($?`DTSTART;TZID=${s}:${e(n)}`:`DTSTART:${t(n)}`),o&&g.push($?`DTEND;TZID=${s}:${e(o)}`:`DTEND:${t(o)}`),g.push(`SUMMARY:${d(h)}`);let f=null;if("flight"===i.type){let e=i.meta;e?.leg==="outbound"&&(f=`${e?.origin||""} airport`)}else if("transport"===i.type){let e=i.meta,t=(e?.originAddress||"").trim(),a=(e?.dep||"").trim();(t||a)&&(f=`${t||""}${t||a?" → ":""}${a||""}`.trim())}else if("stay"===i.type){let e=i.meta;e?.kind==="checkin"&&(f=(e.address||e.city||"").trim())}else if("activity"===i.type||"restaurant"===i.type){let e=i.meta;f=`${e?.title||""} ${e?.cityName||""}`.trim()}f&&g.push(`LOCATION:${d(f)}`),g.push(`UID:ev-${r}-${n?e(n):String(Date.now())}@calentrip`),g.push(`DTSTAMP:${t(new Date)}`),g.push("STATUS:CONFIRMED"),g.push("TRANSP:OPAQUE"),g.push("SEQUENCE:0");let y=[];if(y.push(i.label),"flight"===i.type){let e=i.meta;if(e?.leg==="outbound"){let t=`${e?.origin||""} airport`,a=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t)}`,i=v({originName:"my location",destName:t,lang:"pt-BR",currency:"BRL"});y.push(`Destino: ${t}`),y.push(`Google Maps: ${a}`),y.push(`Rome2Rio: ${i}`),y.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location"),l||y.push("Chegar no aeroporto: 3h antes do voo."),e?.flightNumber&&y.push(`N\xfamero/Localizador: ${e.flightNumber}`)}}else if("transport"===i.type){let e=i.meta,t=(e?.originAddress||"").trim(),a=(e?.dep||"").trim();if(t||a){let e=`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(t)}&destination=${encodeURIComponent(a)}`,i=v({originName:t,destName:a,lang:"pt-BR",currency:"BRL"});y.push(`Origem: ${t||"—"}`),y.push(`Destino: ${a||"—"}`),y.push(`Google Maps: ${e}`),y.push(`Rome2Rio: ${i}`),y.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}}else if("stay"===i.type){let e=i.meta;if(e?.kind==="checkin"){let t=(e.address||e.city||"").trim(),a=t?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t)}`:"";y.push(`Destino: ${t||"—"}`),a&&y.push(`Google Maps: ${a}`),y.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}}else if("activity"===i.type||"restaurant"===i.type){let e=i.meta,t=`${e?.title||""} ${e?.cityName||""}`.trim(),a=t?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t)}`:"";y.push(`Destino: ${t||"—"}`),a&&y.push(`Google Maps: ${a}`),y.push("Uber: https://m.uber.com/ul/?action=setPickup&pickup=my_location")}let b=l?m(y.join("\n"),280):m(y.join("\n"),600);return g.push(`DESCRIPTION:${d(b)}`),g.push("END:VEVENT"),g.push("END:VCALENDAR"),new File([g.map(u).join("\r\n")+"\r\n"],`calentrip-${String(r+1).padStart(2,"0")}.ics`,{type:"text/calendar;charset=utf-8"})})}try{let e=navigator;if(l&&"function"==typeof e.share){let t=await w();try{await e.share({files:t,title:"CalenTrip — eventos (Android)"}),ea(eY("eventsSentToCalendarAndroidMsg"),{variant:"success"});return}catch{for(let a of t)try{await e.share({files:[a],title:a.name})}catch{}ea(eY("eventsSentIndividuallyAndroidMsg"),{variant:"success"});return}}if("function"==typeof e.share){try{await e.share({files:[N],title:"CalenTrip"})}catch{}let t="undefined"!=typeof navigator&&navigator.userAgent||"",a=/iPad|iPhone|iPod/.test(t)||t.includes("Macintosh")&&"ontouchend"in window,i=/Android/.test(t);a?ea(eY("iosCalendarSentMsg"),{variant:"success"}):i?ea(eY("androidCalendarSentMsg"),{variant:"success"}):ea(eY("systemCalendarSentMsg"),{variant:"success"});return}}catch{}let S=URL.createObjectURL(x);try{let e="undefined"!=typeof navigator&&navigator.userAgent||"",t=/iPad|iPhone|iPod/.test(e)||e.includes("Macintosh")&&"ontouchend"in window,a=/Android/.test(e);if(t||a){window.open(S,"_blank"),setTimeout(()=>{try{URL.revokeObjectURL(S)}catch{}},3e4),t?ea(eY("importOpenedIosMsg"),{variant:"success"}):ea(eY("importOpenedAndroidMsg"),{variant:"success"});return}}catch{}let j=document.createElement("a");j.href=S,j.download="calentrip.ics",document.body.appendChild(j),j.click(),j.remove(),URL.revokeObjectURL(S);try{tb()}catch{}ea(eY("icsDownloadedAndroidHelp"),{variant:"info"})}}),(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-md px-3 h-10 hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{try{window.location.href="/profile"}catch{}},children:[(0,t.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-800",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[22px]",children:"account_circle"})}),eM?(0,t.jsx)("span",{className:"text-sm font-medium",children:eY("profile")}):null]})]})]}),eM?(0,t.jsx)("div",{className:"fixed top-0 right-0 bottom-0 left-56 z-30 bg-black/10",onClick:()=>eR(!1)}):null,(0,t.jsxs)("div",{className:"container-page",children:[(0,t.jsxs)("h1",{className:"mb-1 text-2xl font-semibold text-[var(--brand)]",children:[eY("calendarFinalTitle"),e4?(0,t.jsx)("span",{className:"ml-2 text-xs rounded px-2 py-0.5 bg-zinc-100 text-zinc-700 border border-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:border-zinc-700",children:e4}):null]}),(0,t.jsx)("p",{className:"text-sm text-zinc-600",children:"Veja todas as atividades em ordem cronológica."})]}),(0,t.jsxs)("div",{className:"container-page",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-2 flex-wrap",children:[(N="undefined"!=typeof navigator&&navigator.userAgent||"",/Android/.test(N))?(0,t.jsxs)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>{try{try{let e="undefined"!=typeof navigator&&navigator.userAgent||"",t=/Android/.test(e),a=/iPad|iPhone|iPod/.test(e)||e.includes("Macintosh")&&"ontouchend"in window,i="https://play.google.com/store/apps/details?id=com.google.android.calendar";if(t){try{window.location.href="market://details?id=com.google.android.calendar"}catch{}setTimeout(()=>{try{window.open(i,"_blank")}catch{}},600),ea(eY("openingGoogleCalendarPlayStore"),{variant:"info"})}else if(a){try{window.open("https://apps.apple.com/app/google-calendar/id909319292","_blank")}catch{}ea(eY("openingGoogleCalendarAppStore"),{variant:"info"})}else{try{window.open(i,"_blank")}catch{}ea(eY("openingGoogleCalendarStore"),{variant:"info"})}}catch{}}catch{}},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"android"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Instalar GC"})]}):null,(0,t.jsxs)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>{ek(""),eS(!0)},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"save"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:eY("saveLabel")})]}),(0,t.jsxs)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>{try{localStorage.setItem("calentrip:saved_calendar",JSON.stringify({events:C})),localStorage.setItem("calentrip:auto_load_saved","1")}catch{}try{window.location.href="/calendar/month"}catch{}},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"calendar_month"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:eY("calendarMonth")})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:eY("eventsTitle")})}),(0,t.jsxs)(l.CardContent,{children:[(0,t.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:tc,children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"refresh"})})}),t$.length?(0,t.jsx)("ul",{className:"space-y-3 text-sm",children:t$.map((a,i)=>{let r="flight"===a.type?"border-l-[#007AFF]":"stay"===a.type?"border-l-[#febb02]":"transport"===a.type?"border-l-[#007AFF]":"border-l-[#34c759]",n="flight"===a.type?"local_airport":"stay"===a.type?"home":"transport"===a.type?"transfer_within_a_station":"event",o=a.meta?.kind,l="stay"===a.type?"checkin"===o?"14:00":"checkout"===o?"11:00":a.time||"":"flight"===a.type?`${a.meta?.departureTime||a.time||""}${a.meta?.arrivalTime?` → ${a.meta?.arrivalTime}${a.meta?.arrivalNextDay?" (+1d)":""}`:""}`:a.time||"",d=(()=>{let e=a.meta;if(!e)return[];let t=eT.find(t=>{let a=t.name&&e.city&&t.name===e.city,i=t.address&&e.address&&t.address===e.address;return!!(a||i)});return t?.stayFiles||[]})();return(0,t.jsxs)("li",{className:`rounded-lg border border-zinc-200 bg-white p-3 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 flex items-start justify-between gap-3 border-l-4 ${r}`,children:[(0,t.jsxs)("div",{className:"leading-relaxed",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-zinc-600 dark:text-zinc-400",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:n}),(0,t.jsxs)("span",{children:[a.date," ",l]})]}),(0,t.jsx)("div",{className:"mt-1",children:a.label})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:["flight"===a.type&&a.meta?.leg==="outbound"?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>tv(a),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"local_taxi"})}):null,"flight"===a.type&&a.meta?.leg==="outbound"?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",disabled:!eI.length,onClick:async()=>{eu(eY("outboundFlight"));let t=await e.A(10202);eh(await Promise.all(eI.map(async e=>{if(!e.dataUrl&&e.id){let a=await t.getObjectUrl(e.id);return{...e,dataUrl:a||void 0}}return e}))),ec(!0)},children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"description"})}):null,"flight"===a.type&&a.meta?.leg==="inbound"?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>tv(a),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"local_taxi"})}):null,"flight"===a.type&&a.meta?.leg==="inbound"&&`${a.meta.origin}|${a.meta.destination}|${a.date}|${a.time||""}`===ty?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:async()=>{eu(eY("inboundFlight"));let t=await e.A(10202);eh(await Promise.all(eA.map(async e=>{if(!e.dataUrl&&e.id){let a=await t.getObjectUrl(e.id);return{...e,dataUrl:a||void 0}}return e}))),ec(!0)},children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"description"})}):null,"transport"===a.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>tN(a),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] text-[#febb02]",children:"map"})}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:async()=>{try{let t=a.meta,i=`${(t.originCity||"").trim()} -> ${(t.arr||"").trim()} @ ${(a.date||"").trim()}`;if(!e0){eu("Documentos do transporte"),eh([]),ec(!0);return}let r=await (0,$.getRefAttachments)(e0,"transport",i),n=await e.A(10202),o=await Promise.all((r||[]).map(async e=>{if(!e.dataUrl&&e.id){let t=await n.getObjectUrl(e.id);return{...e,dataUrl:t||void 0}}return e}));eu("Documentos do transporte"),eh(o),ec(!0)}catch{eu("Documentos do transporte"),eh([]),ec(!0)}},children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"description"})})]}):null,"stay"===a.type&&a.meta?.kind==="checkin"?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>tw(a),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"home"})}):null,"stay"===a.type&&a.meta?.kind==="checkin"&&d.length?(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:async()=>{let t=a.meta;eu(t?.city||t?.address||eY("accommodationDialogTitle"));let i=await e.A(10202);eh(await Promise.all(d.map(async e=>{if(!e.dataUrl&&e.id){let t=await i.getObjectUrl(e.id);return{...e,dataUrl:t||void 0}}return e}))),ec(!0)},children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"description"})}):null,"activity"===a.type||"restaurant"===a.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",disabled:!e2,className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>{tt(i),ti(a.date),tn(a.time||""),e9(!0)},children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"edit"})}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:()=>tS(a),children:(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"directions_car"})})]}):null,("activity"===a.type||"restaurant"===a.type)&&a.meta?.files&&a.meta?.files.length?(0,t.jsxs)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs rounded-md gap-1",onClick:async()=>{let t=a.meta;eu(t.title);try{let a=await e.A(10202),i=await Promise.all((t.files||[]).map(async e=>{if(!e.dataUrl&&e.id){let t=await a.getObjectUrl(e.id);return{...e,dataUrl:t||void 0}}return e}));eh(i)}catch{eh(t.files||[])}ec(!0)},children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"description"}),(0,t.jsx)("span",{children:"Docs"})]}):null]})]},`ev-${i}`)})}):(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Nenhum evento encontrado."})]})]})]}),(0,t.jsxs)(m.Dialog,{open:eO,onOpenChange:e_,placement:"bottom",disableBackdropClose:!0,children:[(0,t.jsx)(m.DialogHeader,{children:"Salvar no seu celular"}),(0,t.jsx)("div",{className:"space-y-2 text-sm",children:(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(s.Button,{type:"button",onClick:()=>tm(),children:"Salvar"})})}),(0,t.jsx)(m.DialogFooter,{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>e_(!1),children:eY("close")})})]}),ew&&(0,t.jsxs)(m.Dialog,{open:ew,onOpenChange:eS,placement:"bottom",children:[(0,t.jsx)(m.DialogHeader,{children:"Qual o nome do calendário?"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Nome"}),(0,t.jsx)(d.Input,{value:ej,onChange:e=>ek(e.target.value)})]}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(s.Button,{type:"button",onClick:async()=>{let e=(ej||"").replace(/[^A-Za-zÀ-ÖØ-öø-ÿ]/g,"").slice(0,9).trim();if(!e)try{let t=sessionStorage.getItem("calentrip:tripSearch")||localStorage.getItem("calentrip:tripSearch"),a=t?JSON.parse(t):null;if(a){let t="same"===a.mode,i=t?a.origin||"":a.outbound?.origin||"",r=t?a.destination||"":a.outbound?.destination||"";e=`${String(i)}${String(r)}`.replace(/[^A-Za-zÀ-ÖØ-öø-ÿ]/g,"").toUpperCase().slice(0,9)||"CALENDAR"}else e="CALENDAR"}catch{e="CALENDAR"}await tm(e),eS(!1),ea(`salvo com o nome ${e}`,{variant:"success",duration:3e3,sticky:!1})},children:eY("saveLabel")})})]}),(0,t.jsx)(m.DialogFooter,{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>eS(!1),children:eY("close")})})]}),(0,t.jsxs)(m.Dialog,{open:e7,onOpenChange:e9,placement:"bottom",children:[(0,t.jsx)(m.DialogHeader,{children:eY("editActivityTitle")}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Data"}),(0,t.jsx)(d.Input,{type:"date",value:ta,onChange:e=>ti(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm",children:"Hora"}),(0,t.jsx)(d.Input,{type:"time",value:tr,onChange:e=>tn(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>{try{if(null===te)return;I(e=>e.filter((e,t)=>t!==te)),e9(!1),tt(null),ea(eY("activityDeletedMsg"),{variant:"success"})}catch{ea(eY("deleteErrorMsg"),{variant:"error"})}},children:"Excluir"}),(0,t.jsx)(s.Button,{type:"button",onClick:()=>{try{if(null===te)return;I(e=>e.map((e,t)=>{if(t!==te)return e;let a=e.meta;return{...e,date:ta,time:tr,meta:a}})),e9(!1),tt(null),ea(eY("activityUpdatedMsg"),{variant:"success"})}catch{ea(eY("saveErrorMsg"),{variant:"error"})}},children:eY("saveLabel")})]})]}),(0,t.jsx)(m.DialogFooter,{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>e9(!1),children:eY("close")})})]}),E&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{U(!1),_(null)}}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:eY("returnDrawerTitle")}),(0,t.jsx)("div",{className:"space-y-3 text-sm",children:P?(0,t.jsx)("div",{children:"Calculando…"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:["Destino: ",M?.originIata||"—"]}),(0,t.jsxs)("div",{children:["Distância (a partir da sua localização): ",O?.distanceKm?`${O.distanceKm} km`:"—"]}),O?.distanceKm||"granted"===en?null:(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Ative a localização para calcular a distância."}),(0,t.jsxs)("div",{children:["Tempo estimado (com trânsito): ",O?.durationWithTrafficMin?`${O.durationWithTrafficMin} min`:O?.durationMin?`${O.durationMin} min`:"—"]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("a",{className:"underline",href:O?.gmapsUrl,target:"_blank",rel:"noopener noreferrer",children:"Veja no Google Maps"})}),(0,t.jsx)("div",{children:(0,t.jsxs)("a",{className:"underline flex items-center gap-1",href:O?.r2rUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] text-[#febb02]",children:"alt_route"}),(0,t.jsx)("span",{children:"Opções de rota (Rome2Rio)"})]})}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:O?.uberUrl,target:"_blank",rel:"noopener noreferrer",children:"Uber"})}),(0,t.jsx)("div",{className:"mt-2",children:"Chegar no aeroporto: 3h antes do voo."}),eI.length?(0,t.jsx)("div",{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:async()=>{eu(O?.airportName||"Voo de ida");let t=await e.A(10202);eh(await Promise.all(eI.map(async e=>{if(!e.dataUrl&&e.id){let a=await t.getObjectUrl(e.id);return{...e,dataUrl:a||void 0}}return e}))),ec(!0)},children:"Documentos salvos"})}):null,(0,t.jsxs)("div",{children:["Chamar Uber às: ",O?.callTime||"—"]}),(0,t.jsxs)("div",{children:["Notificação programada: ",O?.notifyAt?`\xe0s ${O.notifyAt}`:"—"]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>{U(!1),_(null)},children:eY("close")})})]})})]})]}),eP&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>ez(!1)}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:"Pesquisas e calendários salvos"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"rounded border p-3",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:eY("savedCalendarsTitle")}),eB.length?(0,t.jsx)("ul",{className:"space-y-2",children:eB.map((e,a)=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.name}),(eF.find(e=>e.id===e0)?.savedCalendarName||e4||"")===(e.name||"")?(0,t.jsx)("span",{className:"ml-1 rounded px-2 py-0.5 text-[11px] bg-[#007AFF]/10 text-[#007AFF] border border-[#007AFF]/30",children:"Atual"}):null]}),(0,t.jsxs)("div",{className:"text-xs text-zinc-600",children:[(e.events||[]).length," eventos"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:async()=>{try{await (0,$.initDatabase)();try{await (0,$.migrateFromLocalStorage)()}catch{}let t=(await (0,$.getSavedTrips)()).find(t=>(t.savedCalendarName||"")===(e.name||""));if(t&&await tg(t.id))return void ez(!1)}catch{}I(e.events),ez(!1)},children:eY("loadLabel")}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>{try{if(!confirm(`Deseja excluir o calend\xe1rio "${e.name}"?`)||!confirm("Tem certeza? Esta ação não pode ser desfeita."))return;let t=localStorage.getItem("calentrip:saved_calendars_list"),a=(t?JSON.parse(t):[]).filter(t=>(t?.name||"")!==(e?.name||""));localStorage.setItem("calentrip:saved_calendars_list",JSON.stringify(a)),eV(a);try{let t=localStorage.getItem("calentrip:saved_calendar"),a=t?JSON.parse(t):null;(a?.name||"")===(e?.name||"")&&localStorage.removeItem("calentrip:saved_calendar")}catch{}ea(eY("calendarDeletedMsg"),{variant:"success"})}catch{ea(eY("deleteErrorMsg"),{variant:"error"})}},children:eY("deleteLabel")})]})]},`${e.name}-${a}`))}):(0,t.jsx)("div",{className:"text-zinc-600",children:eY("noSavedCalendarsLabel")})]}),(0,t.jsxs)("div",{className:"rounded border p-3",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:eY("savedSearchesTitle")}),eF.length?(0,t.jsx)("ul",{className:"space-y-2",children:eF.map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.title}),e.id===e0?(0,t.jsx)("span",{className:"ml-1 rounded px-2 py-0.5 text-[11px] bg-[#007AFF]/10 text-[#007AFF] border border-[#007AFF]/30",children:"Atual"}):null]}),(0,t.jsxs)("div",{className:"text-xs text-zinc-600",children:[e.date," • ",e.passengers," pax",e.savedCalendarName?` • ${e.savedCalendarName}`:""]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>{alert((e.flightNotes||[]).map(e=>`${"outbound"===e.leg?"Ida":"Volta"}: ${e.origin} → ${e.destination} • ${e.date} ${e.departureTime||""}`).join("\n"))},children:eY("viewLabel")}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:async()=>{await tg(e.id)&&ez(!1)},children:eY("loadLabel")})]})]},e.id))}):(0,t.jsx)("div",{className:"text-zinc-600",children:eY("noSavedSearchesLabel")})]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>ez(!1),children:eY("close")})})]})]})]}),eG&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>eJ(!1)}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:eY("savedFilesTitle")}),(0,t.jsxs)("div",{className:"space-y-3 text-sm max-h-[60vh] overflow-y-auto",children:[eH.length?(0,t.jsx)("ul",{className:"space-y-2",children:eH.map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2 rounded border p-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-zinc-600",children:e.size?`${Math.round(e.size/1024)} KB`:""})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>tp(e.name),children:eY("loadLabel")}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50",onClick:()=>th(e.name),children:eY("deleteLabel")})]})]},e.name))}):(0,t.jsx)("div",{className:"text-zinc-600",children:eY("noSavedFilesLabel")}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>eJ(!1),children:eY("close")})})]})]})]}),Q&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{X(!1),et(null)}}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:"Chegada e deslocamento até hospedagem"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{children:[eY("cityLabel"),": ",ee?.city||"—"]}),(0,t.jsxs)("div",{children:["Destino: ",ee?.address||"—"]}),(0,t.jsxs)("div",{children:["Distância (a partir da sua localização): ",ee?.distanceKm?`${ee.distanceKm} km`:"—"]}),ee?.distanceKm||"granted"===en?null:(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Ative a localização para calcular a distância."}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:ee?.gmapsUrl,target:"_blank",rel:"noopener noreferrer",children:"Abrir rota no Google Maps"})}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:ee?.uberUrl,target:"_blank",rel:"noopener noreferrer",children:"Chamar Uber"})}),(S=eT.find(e=>{let t=e.name&&ee?.city&&e.name===ee.city,a=e.address&&ee?.address&&e.address===ee.address;return!!(t||a)})?.stayFiles||[]).length?(0,t.jsx)("div",{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:async()=>{eu(ee?.city||ee?.address||eY("accommodationDialogTitle"));let t=await e.A(10202);eh(await Promise.all(S.map(async e=>{if(!e.dataUrl&&e.id){let a=await t.getObjectUrl(e.id);return{...e,dataUrl:a||void 0}}return e}))),ec(!0)},children:"Documentos anexos"})}):null,(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>{X(!1),et(null)},children:eY("close")})})]})]})]}),eg&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{ef(!1),ex(null),eN(null)}}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:"Como ir até o destino"}),(0,t.jsx)("div",{className:"space-y-3 text-sm",children:e$?(0,t.jsx)("div",{children:"Calculando…"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:["Destino: ",eb?.destination||"—"]}),(0,t.jsxs)("div",{children:["Distância (a partir da sua localização): ",eb?.distanceKm?`${eb.distanceKm} km`:"—"]}),eb?.distanceKm||"granted"===en?null:(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Ative a localização para calcular a distância."}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:eb?.gmapsUrl,target:"_blank",rel:"noopener noreferrer",children:"Abrir rota no Google Maps"})}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:eb?.uberUrl,target:"_blank",rel:"noopener noreferrer",children:"Chamar Uber"})}),ev?.files&&ev.files.length?(0,t.jsx)("div",{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:async()=>{eu(ev.title);let t=await e.A(10202);eh(await Promise.all((ev.files||[]).map(async e=>{if(!e.dataUrl&&e.id){let a=await t.getObjectUrl(e.id);return{...e,dataUrl:a||void 0}}return e}))),ec(!0)},children:"Arquivos salvos"})}):null,(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>{ef(!1),ex(null),eN(null)},children:eY("close")})})]})})]})]}),F&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{L(!1),J(null)}}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsx)(m.DialogHeader,{children:"Como chegar da hospedagem de checkout até o transporte para a próxima cidade"}),(0,t.jsx)("div",{className:"space-y-3 text-sm",children:B?(0,t.jsx)("div",{children:"Calculando…"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:["Origem: ",G?.origin||"—"]}),(0,t.jsxs)("div",{children:["Destino: ",G?.destination||"—"]}),H.length>1?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-600",children:eY("transportOriginLabel")}),(0,t.jsx)(c.Select,{className:"mt-1",value:String(q??0),onChange:async e=>{let t=Number(e.target.value),a=H[t];K(t);try{let e,t,i,r,n,o,l,s=await new Promise(e=>{try{if(!tf())return void e(null);navigator.geolocation.getCurrentPosition(t=>e(t),()=>e(null),{enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4})}catch{e(null)}}),d=(G?.origin||"").split(",")[0]||"";if(s){let o={lat:s.coords.latitude,lon:s.coords.longitude},l=`https://router.project-osrm.org/route/v1/driving/${o.lon},${o.lat};${a.lon},${a.lat}?overview=false`,d=await fetch(l),c=await d.json(),m=c?.routes?.[0];m&&(i=Math.round((m.distance??0)/1e3),r=Math.round((m.duration??0)/60));try{let e=await fetch(`https://router.project-osrm.org/route/v1/walking/${o.lon},${o.lat};${a.lon},${a.lat}?overview=false`),t=await e.json(),i=t?.routes?.[0];i&&(n=Math.round((i.duration??0)/60))}catch{}e=`https://www.google.com/maps/dir/?api=1&origin=${o.lat}%2C${o.lon}&destination=${encodeURIComponent(a.name)}`,t=`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${o.lat}&pickup[longitude]=${o.lon}&dropoff[latitude]=${a.lat}&dropoff[longitude]=${a.lon}&dropoff[formatted_address]=${encodeURIComponent(a.name)}`}else e=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(a.name)}`,t=`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${a.lat}&dropoff[longitude]=${a.lon}&dropoff[formatted_address]=${encodeURIComponent(a.name)}`;let c=r?Math.round(1.3*r):void 0;if(null!==te){let e=C[te],[t,i]=(e?.time||"00:00").split(":"),n=new Date(`${e?.date}T${t.padStart(2,"0")}:${i.padStart(2,"0")}:00`),s=((c??r??30)+60)*6e4,m=new Date(n.getTime()-s),u=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;o=u(m),l=`${m.toLocaleDateString()} ${u(m)}`;try{let e="calentrip:departure_point_selection",t=localStorage.getItem(e),i=t?JSON.parse(t):{};i[d]={name:a.name,lat:a.lat,lon:a.lon},localStorage.setItem(e,JSON.stringify(i))}catch{}}J(s=>({...s||{},destination:a.name,distanceKm:i,drivingMin:c??r,walkingMin:n,gmapsUrl:e,uberUrl:t,callTime:o,notifyAt:l}))}catch{}},children:H.map((e,a)=>{let i="air"===e.kind?`${eY("airport")}: ${e.name}`:"train"===e.kind?`${eY("trainStation")}: ${e.name}`:`${eY("busStation")}: ${e.name}`;return(0,t.jsx)("option",{value:String(a),children:i},`opt-${a}`)})})]}):null,(0,t.jsxs)("div",{children:["Distância (a partir da sua localização): ",G?.distanceKm?`${G.distanceKm} km`:"—"]}),G?.distanceKm||"granted"===en?null:(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Ative a localização para calcular a distância."}),G?.mapUrl?(0,t.jsx)("iframe",{title:"map",src:G.mapUrl,className:"mt-2 h-40 w-full rounded-md border"}):null,(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("a",{className:"underline",href:G?.gmapsUrl,target:"_blank",rel:"noopener noreferrer",children:"Abrir rota no Google Maps"})}),(0,t.jsx)("div",{children:(0,t.jsxs)("a",{className:"underline flex items-center gap-1",href:G?.r2rUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-[16px] text-[#febb02]",children:"alt_route"}),(0,t.jsx)("span",{children:"Opções de rota (Rome2Rio)"})]})}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:G?.uberUrl,target:"_blank",rel:"noopener noreferrer",children:"Chamar Uber"})}),(j=null!==te?C[te]:null,T=(k=j?.meta)?`${(k.originCity||"").trim()} -> ${(k.arr||"").trim()} @ ${(j?.date||"").trim()}`:void 0,e0&&T?(0,t.jsx)("div",{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",className:"px-2 py-1 text-xs",onClick:async()=>{try{let t=await (0,$.getRefAttachments)(e0,"transport",T),a=await e.A(10202),i=await Promise.all((t||[]).map(async e=>{if(!e.dataUrl&&e.id){let t=await a.getObjectUrl(e.id);return{...e,dataUrl:t||void 0}}return e}));eu("Documentos do transporte"),eh(i),ec(!0)}catch{eu("Documentos do transporte"),eh([]),ec(!0)}},children:"Documentos salvos"})}):null),(0,t.jsxs)("div",{className:"mt-2",children:["Chamar Uber às: ",G?.callTime||"—"]}),(0,t.jsxs)("div",{children:["Notificação programada: ",G?.notifyAt?`\xe0s ${G.notifyAt}`:"—"]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>{L(!1),J(null)},children:eY("close")})})]})})]})]}),ed&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{ec(!1),eh([])}}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 w-full rounded-t-2xl border border-zinc-200 bg-white p-5 md:p-6 shadow-xl dark:border-zinc-800 dark:bg-black",children:[(0,t.jsxs)(m.DialogHeader,{children:["Documentos: ",em]}),(0,t.jsxs)("div",{className:"space-y-3 text-sm max-h-[60vh] overflow-y-auto",children:[ep.length?(0,t.jsx)("ul",{className:"space-y-2",children:ep.map((e,a)=>(0,t.jsxs)("li",{className:"rounded border p-2",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-xs",children:[e.type," • ",Math.round(e.size/1024)," KB"]}),e.dataUrl&&(0,t.jsxs)("div",{className:"mt-2 space-y-2",children:[e.type.startsWith("image/")?(0,t.jsx)("div",{className:"relative h-48 w-full",children:(0,t.jsx)(r.default,{src:e.dataUrl||"",alt:e.name,fill:!0,sizes:"(max-width: 768px) 100vw, 50vw",className:"object-contain rounded border"})}):"application/pdf"===e.type?(0,t.jsx)("iframe",{src:e.dataUrl,title:e.name,className:"w-full h-48 rounded border"}):(0,t.jsx)("div",{className:"text-xs text-zinc-600",children:"Arquivo disponível no dispositivo."}),(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"underline",href:e.dataUrl,children:"Abrir no dispositivo"})})]})]},`df-${a}`))}):(0,t.jsx)("div",{className:"text-zinc-600",children:"Nenhum documento salvo."}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)(s.Button,{type:"button",className:"h-10 rounded-lg font-semibold tracking-wide",onClick:()=>{ec(!1),eh([])},children:eY("close")})})]})]})]})]})}let w=(0,p.registerPlugin)("StorageFiles");e.s(["default",()=>N],33023)}]);