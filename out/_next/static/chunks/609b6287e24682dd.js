(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74870,e=>{"use strict";let t="calentrip:premium";function r(e){let r=function(){try{let e=localStorage.getItem(t),r=e?JSON.parse(e):[],i=Date.now();return r.filter(e=>e.expiresAt>i).map(e=>e.tripId)}catch{return[]}}();return r.includes("global")||r.includes(e)}function i(e){var r="global";try{let i=localStorage.getItem(t),o=(i?JSON.parse(i):[]).filter(e=>e.tripId!==r);o.push({tripId:r,expiresAt:e}),localStorage.setItem(t,JSON.stringify(o))}catch{}}e.s(["isTripPremium",()=>r,"setGlobalPremium",()=>i])},46588,e=>{"use strict";var t=e.i(47167),r=e.i(82568),i=e.i(74870);let o=(0,r.registerPlugin)("Billing");async function a(){if("android"!==r.Capacitor.getPlatform())return!1;try{let e=await o.isReady();return!!e?.ready}catch{return!1}}async function n(e="premium_subscription_01"){if("android"!==r.Capacitor.getPlatform())return null;try{let t=await o.queryProduct({productId:e});return t?.found?t:null}catch{return null}}async function u(e="premium_subscription_01"){if("android"!==r.Capacitor.getPlatform())return{code:-1};try{return await o.purchaseTripPremium({productId:e})}catch{return{code:-1}}}async function l(e=15e3){return"android"!==r.Capacitor.getPlatform()?null:await new Promise(async t=>{let r=!1;o.addListener("purchase",e=>{r||(r=!0,t(e?.token||null))});try{let e=await o.getLastToken();if(!r&&e?.token){r=!0,t(e.token);return}}catch{}setTimeout(()=>{r||t(null)},e)})}async function c(e,r){let o=t.default.env.NEXT_PUBLIC_GOOGLE_PLAY_PRODUCT_ID||"premium_subscription_01";if(!await a()){if((r||"").toLowerCase().includes("demo")){let e=Date.now()+864e5;return(0,i.setGlobalPremium)(e),{ok:!0}}return{ok:!1,error:"billing"}}if(!await n(o))return{ok:!1,error:"product"};let c=await u(o);if("number"==typeof c?.code&&0!==c.code)return{ok:!1,error:"purchase"};let s=await l();if(!s)return{ok:!1,error:"token"};try{let t=await fetch("/api/entitlements/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:e,userId:r,purchaseToken:s,productId:o})}),a=await t.json();if(!a?.ok)return{ok:!1,error:"verify"};let n=await fetch("/api/entitlements/ack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({purchaseToken:s,productId:o})}),u=await n.json();if(!u?.ok)return{ok:!1,error:"ack"};let l=Date.now()+2592e6,c=await fetch("/api/entitlements/store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:"global",userId:r,expiresAt:l,orderId:a?.orderId||null,source:"google_play"})}),p=await c.json();if(!p?.ok)return{ok:!1,error:"store"};return(0,i.setGlobalPremium)(l),{ok:!0}}catch{return{ok:!1,error:"network"}}}e.s(["awaitPurchaseToken",()=>l,"completePurchaseForTrip",()=>c,"ensureProduct",()=>n,"isBillingReady",()=>a,"purchaseTripPremium",()=>u])}]);