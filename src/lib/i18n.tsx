"use client";
import { createContext, useContext, useMemo, useState, ReactNode } from "react";

type Lang = "pt" | "en" | "es";

const dict: Record<Lang, Record<string, string>> = {
  pt: {
    appName: "CalenTrip",
    language: "Idioma",
    yourTrips: "Suas viagens",
    profile: "Perfil",
    savedTrips: "Viagens salvas",
    signInToViewTrips: "Entre para ver suas viagens",
    remove: "Remover",
    signInGoogle: "Entrar com Google",
    signInCredentials: "Entrar com credenciais",
    close: "Fechar",
    signOut: "Sair",
    viewProfile: "Ver perfil",
    searchFlightsTitle: "Definir datas e destino",
    welcomeSearch: "Encontre a opção ideal para suas datas e preferências.",
    origin: "Aeroporto de Origem",
    destination: "Aeroporto de Destino",
    departDate: "Data de Ida",
    returnDate: "Data de Volta",
    passengers: "Passageiros",
    adults: "Adultos",
    children: "Crianças",
    infants: "Bebês",
    ageNotePassengers: "Idades consideradas: Adultos (12+), Crianças (2–11) e Bebês (0–1). As faixas podem variar conforme a companhia aérea.",
    confirmInfo: "Confirmar Informações",
    outboundFlight: "Voo de Ida",
    inboundFlight: "Voo de Volta",
    date: "Data",
    saveTrip: "Salvar Viagem",
    advanceToStay: "Avançar para Hospedagem",
    proceedToAccommodation: "Prosseguir para escolha da acomodação",
    searchFlights: "Pesquisar Voos",
    linksSuggested: "Links sugeridos",
    departureTime: "Hora da Partida",
    arrivalTime: "Hora de Chegada",
    flightNumberOptional: "Número do voo ou localizador (opcional)",
    flightNotesTitle: "Anotações de Voo",
    attachProofButton: "Anexar comprovante (foto ou arquivo)",
    attachProofHelp: "Use a câmera, documentos ou galeria para anexar a passagem ou o localizador.",
    summarySearch: "Resumo da Busca",
    bookFlightsTitle: "Buscar e comprar voo",
    bookFlightsSubtitle: "Escolha uma plataforma ou companhia aérea para concluir a compra.",
    bookLinksAggregators: "Plataformas de busca",
    bookAirlinesSuggested: "Companhias sugeridas",
    bookLinksDifferentMode: "Para aeroportos diferentes, utilize as plataformas abaixo para pesquisar cada trecho.",
    bookAirlinesNote: "Os links de companhias podem abrir páginas genéricas; o preenchimento automático varia conforme a companhia.",
    arrivalTipTitle: "Chegada e check-in",
    arrivalTipLine: "Verifique o horário de chegada; a maior parte dos check-ins ocorre após as 14:00.",
    arrivalTipLine2: "Se chegar muito cedo, pode ser necessário circular com a bagagem ou utilizar guarda-volumes. Considere combinar early check-in ou guarda de bagagem com a acomodação.",
    arrivalNextDayLabel: "Chega no dia seguinte",
    arrivalNextDayHelp: "Nota: este voo chega no dia seguinte à partida. Por padrão, o check-in da hospedagem permanece na data da partida. Avalie, conforme o horário de chegada ao destino, se mantém a acomodação assim ou se prefere ajustar o check-in para o dia seguinte. Lembre-se: o check-in normalmente começa às 14:00; confirme as regras da hospedagem escolhida.",
    arrivalNextDayAsk: "Hora de chegada menor que a de partida. Se o voo chega no dia seguinte, marque o checkbox.",
    arrivalNextDayWarn: "Hora de chegada menor que a de partida. Se o voo chega no dia seguinte, marque o checkbox.",
    tableOrigin: "Origem",
    tableDestination: "Destino",
    tableDate: "Data",
    tablePassengers: "Passageiros",
    noTrips: "Nenhuma viagem salva ainda.",
    editSearchTitle: "Editar busca",
    apply: "Aplicar",
    navExplore: "Explorar",
    navTrips: "Voos",
    navStays: "Estadias",
    navProfile: "Perfil",
    modeLabel: "Modo de busca",
    searchModeSame: "Mesmos aeroportos",
    searchModeDifferent: "Aeroportos diferentes",
    required: "Obrigatório",
    minPassengers: "Mínimo 1 passageiro",
    searchTabSame: "Ida/Volta mesmos aeroportos",
    searchTabDifferent: "Ida/Volta aeroportos diferentes",
    typeCityAirport: "Digite cidade ou aeroporto",
    stayDetailsTitle: "Informar dados da hospedagem",
    stayAddressLabel: "Endereço da hospedagem",
    stayAddressPlaceholder: "Rua, número, bairro, cidade",
    stayAddressNote: "Este endereço será utilizado na agenda para geolocalização e busca de transportes.",
    attachStayHelp: "Use a câmera, documentos ou galeria para anexar a reserva ou comprovante. Um link direto ficará disponível no calendário no dia da viagem.",
    saveStay: "Salvar hospedagem",
    stayRouteTitle: "Chegada até a hospedagem",
    stayRouteDistance: "Distância",
    stayRouteDuration: "Tempo estimado",
    stayRouteMap: "Ver percurso no mapa",
    transportOptionsTitle: "Opções de transporte",
    transportDisclaimer: "Estimativas obtidas de serviços públicos na internet. Podem conter variações ou erros; confirme com os fornecedores antes de viajar.",
    stayRouteFromAirportLabel: "Origem",
    stayRouteToAddressLabel: "Destino",
    calendarList: "Calendário em lista",
    calendarMonth: "Calendário mensal",
    stayCheckinNextDayNote: "ATENÇÃO: seu voo chega ao destino no dia seguinte. Avalie se deseja manter a hospedagem a partir do dia da saída (com check-in no dia seguinte em qualquer horário permitido) ou ajustar a busca para iniciar a hospedagem no dia seguinte à partida. Essa opção pode economizar uma diária. Lembre-se: o check-in normalmente começa às 14:00; confirme as regras da hospedagem escolhida.",
  },
  en: {
    appName: "CalenTrip",
    language: "Language",
    yourTrips: "Your trips",
    profile: "Profile",
    savedTrips: "Saved trips",
    signInToViewTrips: "Sign in to view your trips",
    remove: "Remove",
    signInGoogle: "Sign in with Google",
    signInCredentials: "Sign in with credentials",
    close: "Close",
    signOut: "Sign out",
    viewProfile: "View profile",
    searchFlightsTitle: "Search flights and set destination",
    welcomeSearch: "Find the best option for your dates and preferences.",
    origin: "Origin airport",
    destination: "Destination airport",
    departDate: "Departure date",
    returnDate: "Return date",
    passengers: "Passengers",
    adults: "Adults",
    children: "Children",
    infants: "Infants",
    ageNotePassengers: "Age ranges: Adults (12+), Children (2–11) and Infants (0–1). Ranges may vary by airline.",
    confirmInfo: "Confirm information",
    outboundFlight: "Outbound flight",
    inboundFlight: "Return flight",
    date: "Date",
    saveTrip: "Save Trip",
    advanceToStay: "Continue to Accommodation",
    proceedToAccommodation: "Proceed to accommodation selection",
    searchFlights: "Search Flights",
    linksSuggested: "Suggested links",
    departureTime: "Departure time",
    arrivalTime: "Arrival time",
    flightNumberOptional: "Flight number or locator (optional)",
    flightNotesTitle: "Flight Notes",
    attachProofButton: "Attach proof (photo or file)",
    attachProofHelp: "Use camera, documents or gallery to attach the ticket or locator.",
    summarySearch: "Search Summary",
    bookFlightsTitle: "Search and buy flight",
    bookFlightsSubtitle: "Choose a platform or airline to complete your purchase.",
    bookLinksAggregators: "Search platforms",
    bookAirlinesSuggested: "Suggested airlines",
    bookLinksDifferentMode: "For different airports, use platforms below to search each leg.",
    bookAirlinesNote: "Airline links may open generic pages; auto-fill varies by airline.",
    arrivalTipTitle: "Arrival and check-in",
    arrivalTipLine: "Check your arrival time; most accommodations offer check-in from 2:00 PM.",
    arrivalTipLine2: "Arriving early may require carrying luggage or using storage. Consider arranging early check-in or luggage drop with your accommodation.",
    arrivalNextDayLabel: "Arrives the next day",
    arrivalNextDayHelp: "Note: this flight arrives the day after departure. By default, accommodation check-in remains on the departure date. Based on your arrival time, decide whether to keep it or adjust check-in to the next day. Reminder: check-in typically starts at 2:00 PM; confirm the property’s rules.",
    arrivalNextDayAsk: "Arrival time is earlier than departure. If the flight arrives the next day, check the box.",
    arrivalNextDayWarn: "Arrival time is earlier than departure. If the flight arrives the next day, check the box.",
    tableOrigin: "Origin",
    tableDestination: "Destination",
    tableDate: "Date",
    tablePassengers: "Passengers",
    noTrips: "No trips saved yet.",
    editSearchTitle: "Edit search",
    apply: "Apply",
    navExplore: "Explore",
    navTrips: "Flights",
    navStays: "Stays",
    navProfile: "Profile",
    modeLabel: "Search mode",
    searchModeSame: "Same airports",
    searchModeDifferent: "Different airports",
    required: "Required",
    minPassengers: "Minimum 1 passenger",
    searchTabSame: "Round trip same airports",
    searchTabDifferent: "Round trip different airports",
    typeCityAirport: "Type city or airport",
    stayDetailsTitle: "Provide accommodation details",
    stayAddressLabel: "Accommodation address",
    stayAddressPlaceholder: "Street, number, district, city",
    stayAddressNote: "This address will be used in the agenda for geolocation and transport search.",
    attachStayHelp: "Use camera, documents or gallery to attach the booking or receipt. A direct link will be available in the calendar on the travel day.",
    saveStay: "Save accommodation",
    stayRouteTitle: "Route to accommodation",
    stayRouteDistance: "Distance",
    stayRouteDuration: "Estimated time",
    stayRouteMap: "View route on map",
    transportOptionsTitle: "Transport options",
    transportDisclaimer: "Estimates are sourced from public internet services and may vary or be inaccurate. Confirm with providers before traveling.",
    stayRouteFromAirportLabel: "Origin",
    stayRouteToAddressLabel: "Destination",
    calendarList: "List calendar",
    calendarMonth: "Monthly calendar",
    stayCheckinNextDayNote: "As the flight arrives the day after departure, the accommodation check-in is set to the day after the flight’s departure date.",
  },
  es: {
    appName: "CalenTrip",
    language: "Idioma",
    yourTrips: "Tus viajes",
    profile: "Perfil",
    savedTrips: "Viajes guardados",
    signInToViewTrips: "Inicia sesión para ver tus viajes",
    remove: "Eliminar",
    signInGoogle: "Iniciar con Google",
    signInCredentials: "Iniciar con credenciales",
    close: "Cerrar",
    signOut: "Salir",
    viewProfile: "Ver perfil",
    searchFlightsTitle: "Buscar vuelos y definir destino",
    welcomeSearch: "Encuentra la mejor opción para tus fechas y preferencias.",
    origin: "Aeropuerto de origen",
    destination: "Aeropuerto de destino",
    departDate: "Fecha de ida",
    returnDate: "Fecha de vuelta",
    passengers: "Pasajeros",
    adults: "Adultos",
    children: "Niños",
    infants: "Bebés",
    ageNotePassengers: "Rangos de edad: Adultos (12+), Niños (2–11) y Bebés (0–1). Los rangos pueden variar según la aerolínea.",
    confirmInfo: "Confirmar información",
    outboundFlight: "Vuelo de ida",
    inboundFlight: "Vuelo de vuelta",
    date: "Fecha",
    saveTrip: "Guardar viaje",
    advanceToStay: "Continuar a Alojamiento",
    proceedToAccommodation: "Continuar a la selección de alojamiento",
    searchFlights: "Buscar vuelos",
    linksSuggested: "Enlaces sugeridos",
    departureTime: "Hora de salida",
    arrivalTime: "Hora de llegada",
    flightNumberOptional: "Número de vuelo o localizador (opcional)",
    flightNotesTitle: "Notas de vuelo",
    attachProofButton: "Adjuntar comprobante (foto o archivo)",
    attachProofHelp: "Usa la cámara, documentos o galería para adjuntar el billete o localizador.",
    summarySearch: "Resumen de búsqueda",
    bookFlightsTitle: "Buscar y comprar vuelo",
    bookFlightsSubtitle: "Elige una plataforma o aerolínea para completar la compra.",
    bookLinksAggregators: "Plataformas de búsqueda",
    bookAirlinesSuggested: "Aerolíneas sugeridas",
    bookLinksDifferentMode: "Para aeropuertos diferentes, usa las plataformas para buscar cada tramo.",
    bookAirlinesNote: "Los enlaces de aerolíneas pueden abrir páginas genéricas; el autocompletado varía por aerolínea.",
    arrivalTipTitle: "Llegada y check-in",
    arrivalTipLine: "Verifica la hora de llegada; la mayoría de los check-ins son después de las 14:00.",
    arrivalTipLine2: "Si llegas muy temprano, podrías tener que llevar el equipaje o usar consigna. Considera acordar early check-in o depósito de equipaje con tu alojamiento.",
    arrivalNextDayLabel: "Llega al día siguiente",
    arrivalNextDayHelp: "Nota: este vuelo llega al día siguiente de la salida. Por defecto, el check-in del alojamiento se mantiene en la fecha de salida. Según tu hora de llegada, decide si mantenerlo o ajustar el check-in para el día siguiente. Recuerda: el check-in suele iniciar a las 14:00; confirma las reglas del alojamiento elegido.",
    arrivalNextDayAsk: "La hora de llegada es menor que la de salida. Si el vuelo llega al día siguiente, marca la casilla.",
    arrivalNextDayWarn: "La hora de llegada es menor que la de salida. Si el vuelo llega al día siguiente, marca la casilla.",
    tableOrigin: "Origen",
    tableDestination: "Destino",
    tableDate: "Fecha",
    tablePassengers: "Pasajeros",
    noTrips: "Aún no hay viajes guardados.",
    editSearchTitle: "Editar búsqueda",
    apply: "Aplicar",
    navExplore: "Explorar",
    navTrips: "Vuelos",
    navStays: "Estancias",
    navProfile: "Perfil",
    modeLabel: "Modo de búsqueda",
    searchModeSame: "Mismos aeropuertos",
    searchModeDifferent: "Aeropuertos diferentes",
    required: "Obligatorio",
    minPassengers: "Mínimo 1 pasajero",
    searchTabSame: "Ida y vuelta mismos aeropuertos",
    searchTabDifferent: "Ida y vuelta aeropuertos diferentes",
    typeCityAirport: "Escribe ciudad o aeropuerto",
    stayDetailsTitle: "Informar datos del alojamiento",
    stayAddressLabel: "Dirección del alojamiento",
    stayAddressPlaceholder: "Calle, número, barrio, ciudad",
    stayAddressNote: "Esta dirección se utilizará en la agenda para geolocalización y búsqueda de transportes.",
    stayCheckinNextDayNote: "Como el vuelo llega al día siguiente de la salida, el check-in del alojamiento se configuró para el día posterior a la fecha de salida del vuelo.",
    attachStayHelp: "Usa la cámara, documentos o galería para adjuntar la reserva o comprobante. Habrá un enlace directo en el calendario el día del viaje.",
    saveStay: "Guardar alojamiento",
    stayRouteTitle: "Llegada al alojamiento",
    stayRouteDistance: "Distancia",
    stayRouteDuration: "Tiempo estimado",
    stayRouteMap: "Ver ruta en el mapa",
    transportOptionsTitle: "Opciones de transporte",
    transportDisclaimer: "Estimaciones obtenidas de servicios públicos en internet. Pueden variar o contener errores; confirma con los proveedores antes de viajar.",
    stayRouteFromAirportLabel: "Origen",
    stayRouteToAddressLabel: "Destino",
    calendarList: "Calendario en lista",
    calendarMonth: "Calendario mensual",
  },
};

type Ctx = { lang: Lang; setLang: (l: Lang) => void; t: (k: string) => string };
const I18nCtx = createContext<Ctx | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const initial = (() => {
    try {
      const raw = typeof window !== "undefined" ? localStorage.getItem("calentrip:lang") : null;
      if (raw === "pt" || raw === "en" || raw === "es") return raw as Lang;
    } catch {}
    return "pt" as Lang;
  })();
  const [lang, setLangState] = useState<Lang>(initial);
  function setLang(l: Lang) {
    setLangState(l);
    try {
      localStorage.setItem("calentrip:lang", l);
    } catch {}
  }
  const t = useMemo(() => (k: string) => dict[lang][k] ?? dict.pt[k] ?? k, [lang]);
  return <I18nCtx.Provider value={{ lang, setLang, t }}>{children}</I18nCtx.Provider>;
}

export function useI18n() {
  const v = useContext(I18nCtx);
  if (!v) throw new Error("I18n fora do contexto");
  return v;
}
